<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2026 æˆ°ç•¥å°èˆªï½œä¸€èµ·å‡ºä¾†ç©</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background:#0b0e14;
      color:#e2e8f0;
      font-family: system-ui,-apple-system;
    }
    .glass {
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.08);
    }
    .bazi-char {
      font-size:1.8rem;
      font-weight:900;
      line-height:1.1;
    }
    .wuxing-æœ¨{background:#2ecc71}
    .wuxing-ç«{background:#e74c3c}
    .wuxing-åœŸ{background:#f1c40f}
    .wuxing-é‡‘{background:#ced4da}
    .wuxing-æ°´{background:#3498db}
  </style>
</head>

<body class="p-4">
  <h1 class="text-3xl font-black text-center mb-6">2026 æµå¹´æˆ°ç•¥å ±å‘Š</h1>

  <!-- è¼¸å…¥å€ -->
  <div class="glass p-6 rounded-xl max-w-xl mx-auto mb-10">
    <div class="grid grid-cols-3 gap-2 mb-3">
      <select id="birthYear" class="bg-black/40 p-2 rounded"></select>
      <select id="birthMonth" class="bg-black/40 p-2 rounded"></select>
      <select id="birthDay" class="bg-black/40 p-2 rounded"></select>
    </div>
    <div class="grid grid-cols-2 gap-2 mb-4">
      <select id="birthHour" class="bg-black/40 p-2 rounded"></select>
      <select id="birthMinute" class="bg-black/40 p-2 rounded"></select>
    </div>
  <div class="grid grid-cols-2 gap-2 mb-4">
    <select id="birthHour" class="bg-black/40 p-2 rounded"></select>
    <select id="birthMinute" class="bg-black/40 p-2 rounded"></select>
  </div>

  <!-- âœ… æ–°å¢ï¼šæ€§åˆ¥ï¼ˆçµ¦ç´«å¾®ç”¨ï¼‰ -->
  <div class="mb-4">
    <select id="gender" class="bg-black/40 p-2 rounded w-full">
      <option value="male">ç”Ÿç†ç”·</option>
      <option value="female">ç”Ÿç†å¥³</option>
    </select>
  </div>

  <button id="btnLaunch" class="w-full bg-amber-500 text-black py-3 rounded font-black">
    ç”Ÿæˆæˆ‘çš„ 2026 æˆ°ç•¥
  </button>


    <button id="btnLaunch" class="w-full bg-amber-500 text-black py-3 rounded font-black">
      ç”Ÿæˆæˆ‘çš„ 2026 æˆ°ç•¥
    </button>

    <p id="hint" class="text-xs text-slate-400 mt-3 italic"></p>
  </div>

  <!-- å ±å‘Šå€ -->
  <div id="report" class="hidden max-w-xl mx-auto space-y-10">

    <!-- å››æŸ± -->
    <div class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">å››æŸ±ï¼ˆé¡¯ç¤ºç”¨ï¼‰</h2>
      <div class="grid grid-cols-4 text-center">
        <div>
          <div id="yG" class="bazi-char"></div>
          <div id="yZ" class="text-sm text-slate-300"></div>
        </div>
        <div>
          <div id="mG" class="bazi-char"></div>
          <div id="mZ" class="text-sm text-slate-300"></div>
        </div>
        <div>
          <div id="dG" class="bazi-char text-amber-400"></div>
          <div id="dZ" class="text-sm text-slate-300"></div>
        </div>
        <div>
          <div id="hG" class="bazi-char"></div>
          <div id="hZ" class="text-sm text-slate-300"></div>
        </div>
      </div>
    </div>

    <!-- äº”è¡Œ -->
    <div class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">äº”è¡Œèƒ½é‡</h2>
      <div class="text-xs text-slate-400 mb-2">è¡¨å±¤ï¼ˆå¤©å¹²è¨ˆæ•¸ï¼‰</div>
      <div id="surfaceWx" class="space-y-2 mb-5"></div>

      <div class="text-xs text-slate-400 mb-2">å¯¦æˆ°ï¼ˆå¤©å¹²+è—å¹²+æœˆä»¤åŠ æ¬Šï¼‰</div>
      <div id="strategicWx" class="space-y-2"></div>
    </div>

    <!-- æµæœˆ -->
    <div class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">2026 æµæœˆç¯€å¥</h2>
      <div id="monthGrid" class="space-y-2"></div>
      <p class="text-[11px] text-slate-500 mt-2 italic">
        â€» æ¡ç¯€æ°£æœˆå€é–“ï¼ˆç”±å¾Œç«¯æ¼”ç®—æ³•è¨ˆç®—ï¼‰
      </p>
    </div>

    <!-- æˆ°ç•¥è§£è®€ï¼ˆAI æ•˜äº‹ï¼‰ -->
    <div class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">æˆ°ç•¥è§£è®€</h2>
      <div id="analysisBox" class="space-y-2 text-sm text-slate-200"></div>
      <button
        id="btnCopy"
        class="mt-4 inline-block bg-slate-100 text-slate-900 text-xs px-3 py-2 rounded-full font-bold"
      >
        è¤‡è£½é€™ä»½æˆ°ç•¥æ–‡å­—
      </button>
      <span id="copyHint" class="text-[11px] text-emerald-300 ml-2 hidden">å·²è¤‡è£½ âœ…</span>
    </div>
  <!-- ç´«å¾®ï¼šæˆ°ç•¥ç‰¹å¾µ -->
  <div id="ziweiBlock" class="glass p-6 rounded-xl hidden">
    <h2 class="font-black mb-3">ç´«å¾®å‘½ç›¤ï¼æˆ°ç•¥ç‰¹å¾µ</h2>
    <div id="ziweiSummary" class="space-y-2 text-sm text-slate-200"></div>
  </div>
</div> <!-- report çµå°¾ -->


    <!-- è«®è©¢é–‰ç’° -->
    <div class="glass p-6 rounded-xl text-center">
      <h2 class="font-black mb-3">éœ€è¦ä¸€èµ·æ ¡æº– 2026 å—ï¼Ÿ</h2>
      <p class="text-sm text-slate-300 mb-4">
        å¦‚æœä½ å¸Œæœ›æˆ‘æŠŠä½ çš„å‘½æ ¼çµ„æˆã€äººç”Ÿå¤§é‹ã€æµå¹´æµæœˆã€ç”Ÿæ¶¯è¦åŠƒå’Œæœ€é©åˆè‡ªå·±çš„äººç”Ÿç¯€å¥åšæˆå¯ä¿ç”¨ä¸€ç”Ÿçš„50é äººç”Ÿä½¿ç”¨èªªæ˜æ›¸ï¼Œæ­¡è¿é ç´„ç·šä¸Šè«®è©¢ã€‚
      </p>
      <a
        href="https://forms.gle/UVCSq1udEC549gzYA"
        target="_blank"
        class="inline-block bg-emerald-400 text-black font-black px-6 py-3 rounded-full text-sm shadow hover:brightness-110"
      >
        èˆ‡æä¼¯å½¥è€å¸«è«®è©¢ â†’
      </a>
    </div>

  </div>

<script>
/* ========= åŸºæœ¬è¨­å®š ========= */
const API_BASE = "https://17gonplay-api.billeetw.workers.dev";

/* ========= å·¥å…· ========= */
function renderBar(id, data, max) {
  const box = document.getElementById(id);
  if (!box) return;
  box.innerHTML = "";
  ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => {
    const v = Number(data?.[e] || 0);
    const w = max ? Math.max(2, (v / max) * 100) : 0;
    box.innerHTML += `
      <div class="mb-1">
        <div class="flex justify-between text-xs">
          <span>${e}</span>
          <span>${v.toFixed(1)}</span>
        </div>
        <div class="h-2 bg-white/10 rounded overflow-hidden">
          <div class="h-full wuxing-${e}" style="width:${w}%"></div>
        </div>
      </div>
    `;
  });
}

/* ========= ä¸»æµç¨‹ï¼šåªæ‰“ /compute/allï¼ˆå…«å­— + ç´«å¾®ï¼‰ ========= */
async function calculate() {
  const vy   = parseInt(document.getElementById("birthYear")?.value, 10);
  const vm   = parseInt(document.getElementById("birthMonth")?.value, 10);
  const vd   = parseInt(document.getElementById("birthDay")?.value, 10);
  const vh   = parseInt(document.getElementById("birthHour")?.value, 10);
  const vmin = parseInt(document.getElementById("birthMinute")?.value, 10);
  const gender = (document.getElementById("gender")?.value || "male");

  try {
    if (![vy, vm, vd, vh, vmin].every(n => Number.isFinite(n))) {
      throw new Error("è«‹å…ˆé¸å¥½å‡ºç”Ÿå¹´æœˆæ—¥èˆ‡æ™‚é–“");
    }

    const resp = await fetch(`${API_BASE}/compute/all`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        year: vy,
        month: vm,
        day: vd,
        hour: vh,
        minute: vmin,
        gender, // âœ… ç´«å¾®éœ€è¦
      }),
    });

    if (!resp.ok) {
      const txt = await resp.text().catch(() => "");
      throw new Error(`API HTTP ${resp.status} ${txt || ""}`.trim());
    }

    const payload = await resp.json();
    if (!payload?.ok) throw new Error(payload?.error || "API error");

    // âœ… debug ç”¨ï¼šä½ å¯ä»¥åœ¨ console çœ‹ window.__contract / __ziwei
    window.__payload  = payload;
    window.__contract = payload.features;
    window.__ziwei    = payload.features?.ziwei;

    const contract = payload.features;
    if (!contract || contract.version !== "strategic_features_v1") {
      throw new Error("contract æ ¼å¼ä¸æ­£ç¢ºï¼ˆfeatures.version != strategic_features_v1ï¼‰");
    }

    const bazi = contract.bazi;
    if (!bazi) throw new Error("contract.bazi ä¸å­˜åœ¨ï¼ˆå¾Œç«¯ Phase 0 æ‡‰è©²ä¸€å®šè¦æœ‰ï¼‰");

    /* === 1) å››æŸ±ï¼šåƒ bazi.display === */
    const disp = bazi.display;
    document.getElementById("yG").innerText = disp.yG || "";
    document.getElementById("yZ").innerText = disp.yZ || "";
    document.getElementById("mG").innerText = disp.mG || "";
    document.getElementById("mZ").innerText = disp.mZ || "";
    document.getElementById("dG").innerText = disp.dG || "";
    document.getElementById("dZ").innerText = disp.dZ || "";
    document.getElementById("hG").innerText = disp.hG || "";
    document.getElementById("hZ").innerText = disp.hZ || "";

    /* === 2) äº”è¡Œï¼šå®Œå…¨åƒ contract.bazi.wuxing === */
    if (!bazi.wuxing?.surface || !bazi.wuxing?.strategic) {
      throw new Error("bazi.wuxing ç¼ºè³‡æ–™");
    }
    renderBar("surfaceWx",   bazi.wuxing.surface,   4);
    renderBar("strategicWx", bazi.wuxing.strategic, bazi.wuxing.maxStrategic || 1);

    /* === 3) æµæœˆï¼šåƒ contract.bazi.liuyue2026.bounds === */
    const bounds = bazi.liuyue2026?.bounds || [];
    const mGrid  = document.getElementById("monthGrid");
    mGrid.innerHTML = "";

    const redMonths = [];
    if (bounds.length) {
      bounds.forEach(b => {
        const isRed = b.light === "RED";
        if (isRed) redMonths.push(b.gz);
        mGrid.innerHTML += `
          <div class="p-3 rounded border-l-4 ${isRed ? "border-red-500 bg-red-500/10" : "border-emerald-500 bg-emerald-500/10"}">
            <div class="font-bold">
              ${b.gz}
              <span class="text-xs text-slate-400 ml-1">${b.range || ""}</span>
            </div>
            <div class="text-xs text-slate-300 mt-1">
              ${isRed ? "ğŸ”´ å£“åŠ›" : "ğŸŸ¢ ç©©é€²"} ï½œ æœ¬æ°£ï¼š${b.ssBranch || ""}
            </div>
          </div>
        `;
      });
    } else {
      mGrid.innerHTML = `<div class="text-xs text-slate-400 italic">ï¼ˆæš«ç„¡æµæœˆè³‡æ–™ï¼‰</div>`;
    }

    /* === 4) å…«å­—æˆ°ç•¥è§£è®€ï¼ˆfallbackï¼‰ === */
    const analysisBox = document.getElementById("analysisBox");
    const dominant = (bazi.tenGod?.dominant || "").trim() || "æœªå®š";
    const dmElement = bazi.dmElement || "ç«";

    const redText = redMonths.length
      ? `å£“åŠ›æœˆï¼š${redMonths.join("ã€")}ï¼ˆé€™äº›æœˆå…ˆå®ˆè¦å‰‡ï¼Œä¸è¦ç¡¬è¡ï¼‰ã€‚`
      : "ä»Šå¹´å£“åŠ›æœˆåå°‘ï¼Œå¯ä»¥ç©©ç©©æ¨é€²ã€‚";

    analysisBox.innerHTML = `
      <p>ä½ çš„æ—¥ä¸»äº”è¡Œä¸»å ´æ˜¯ã€Œ${dmElement}ã€ï¼Œ2026 å¹´åº¦ä¸»è»¸åå‘ã€Œ${dominant}ã€ã€‚</p>
      <p>${redText}</p>
      <p>ç­–ç•¥ï¼šæŠŠè¡Œå‹•æ‹†å°ã€ç›®æ¨™è®Šå°‘ã€ç¯€å¥å›ºå®šï¼Œå£“åŠ›æœˆå„ªå…ˆå®ˆä½ç¾æœ‰ç›¤é¢ã€‚</p>
      <p class="text-[11px] text-slate-400 mt-2">
        ï¼ˆä¹‹å¾Œ Phase 1 æœƒæ”¹ç”¨ /render/report æŠŠé€™æ®µæ›æˆå®Œæ•´ AI æ•˜äº‹ï¼‰
      </p>
    `;

    /* === 5) ç´«å¾®ï¼šå¦‚æœæœ‰ features.ziwei å°±é¡¯ç¤º === */
    const ziwei       = contract.ziwei;
    const ziweiBlock  = document.getElementById("ziweiBlock");
    const ziweiSummary = document.getElementById("ziweiSummary");

    if (ziwei && ziweiBlock && ziweiSummary) {
      const core = ziwei.core || {};
      const ms   = ziwei.mainStars || {};
      const t    = ziwei.tendencies || {};

      const mingStars   = (ms.minggong || []).join("ã€") || "ï¼ˆç„¡ä¸»è¦æ˜Ÿï¼‰";
      const careerStars = (ms.career   || []).join("ã€") || "ï¼ˆç„¡ä¸»è¦æ˜Ÿï¼‰";
      const wealthStars = (ms.wealth   || []).join("ã€") || "ï¼ˆç„¡ä¸»è¦æ˜Ÿï¼‰";

      const riskMap = {
        high: "é«˜é¢¨éšªï½œæ•¢è¡æ•¢æ‹šï¼Œé©åˆåœ¨å¯æ§é¢¨éšªå…§åšå¤§å¹…èª¿æ•´ã€‚",
        mid:  "ä¸­é¢¨éšªï½œæœƒè©•ä¼°å¾Œå‡ºæ‰‹ï¼Œé©åˆæ»¾å‹•ä¿®æ­£ã€‚",
        low:  "ä½é¢¨éšªï½œåä¿å®ˆç©©å¥ï¼Œé©åˆé•·ç·šç¶“ç‡Ÿã€‚",
      };
      const authMap = {
        strong: "æ¬Šå¨æ„Ÿå¼·ï½œé©åˆå¸¶åœ˜éšŠã€æŒæ§è³‡æºèˆ‡ç¯€å¥ã€‚",
        mid:    "æ¬Šå¨æ„Ÿä¸­ï½œéœ€è¦ç”¨å°ˆæ¥­èˆ‡ç©©å®šåº¦ç´¯ç©ä¿¡ä»»ã€‚",
        weak:   "æ¬Šå¨æ„Ÿå¼±ï½œé©åˆæ‰®æ¼”é¡§å•ã€å¹•åƒšã€æ™ºå›Šè§’è‰²ã€‚",
      };
      const mobMap = {
        high: "æµå‹•æ€§é«˜ï½œé©åˆè·¨åŸå¸‚ã€è·¨é ˜åŸŸæˆ–å½ˆæ€§å·¥ä½œå‹æ…‹ã€‚",
        mid:  "æµå‹•æ€§ä¸­ï½œå¯ä»¥é©åº¦è½‰æ›è·‘é“ï¼Œä½†è¦æ³¨æ„ç¯€å¥ã€‚",
        low:  "æµå‹•æ€§ä½ï½œé©åˆåœ¨å›ºå®šå ´åŸŸæ·±è€•ï¼Œç©©å®šç¶“ç‡Ÿäººè„ˆèˆ‡è³‡æºã€‚",
      };

      const riskText = riskMap[t.risk] || "";
      const authText = authMap[t.authority] || "";
      const mobText  = mobMap[t.mobility] || "";

      ziweiSummary.innerHTML = `
        <p>å‘½å®®è½åœ¨ã€Œ${core.minggong || "æœªçŸ¥"}ã€ï¼Œèº«å®®åœ¨ã€Œ${core.shengong || "æœªçŸ¥"}ã€ï¼Œäº”è¡Œå±€å±¬æ–¼ã€Œ${core.wuxingju || "æœªçŸ¥"}ã€ã€‚</p>
        <p>å‘½å®®ä¸»æ˜Ÿçµ„åˆï¼š${mingStars}</p>
        <p>äº‹æ¥­å®®ä¸»æ˜Ÿçµ„åˆï¼š${careerStars}</p>
        <p>è²¡å¸›å®®ä¸»æ˜Ÿçµ„åˆï¼š${wealthStars}</p>
        <hr class="border-slate-700 my-2" />
        <p>${riskText}</p>
        <p>${authText}</p>
        <p>${mobText}</p>
        <p class="text-[11px] text-slate-400 mt-2">
          ï¼ˆé€™ä¸€å¡Šçµ¦ä½ ä¸€çœ¼çœ‹å‡ºï¼šä½ æ¯”è¼ƒé©åˆæ€éº¼é…ç½®ã€Œæ¬ŠåŠ›ã€é¢¨éšªã€ç§»å‹•æ€§ã€ã€‚ï¼‰
        </p>
      `;

      ziweiBlock.classList.remove("hidden");
    } else if (ziweiBlock) {
      ziweiBlock.classList.add("hidden");
    }

    // é¡¯ç¤ºå ±å‘Š
    document.getElementById("report").classList.remove("hidden");
    document.getElementById("report").scrollIntoView({ behavior:"smooth", block:"start" });

  } catch (e) {
    console.error(e);
    alert("è¨ˆç®—å¤±æ•—ï¼š" + (e?.message || e));
  }
}

/* ========= UIï¼šæ—¥æœŸé¸å–® ========= */
function initSelectors() {
  const y   = document.getElementById("birthYear");
  const m   = document.getElementById("birthMonth");
  const d   = document.getElementById("birthDay");
  const h   = document.getElementById("birthHour");
  const min = document.getElementById("birthMinute");
  if (!y || !m || !d || !h || !min) return;

  for (let i = 2026; i >= 1940; i--) {
    y.add(new Option(i + " å¹´", i));
  }
  for (let i = 1; i <= 12; i++) {
    m.add(new Option(i + " æœˆ", i));
  }
  for (let i = 0; i < 24; i++) {
    const label = String(i).padStart(2,"0") + " æ™‚";
    h.add(new Option(label, i));
  }
  ["00","15","30","45"].forEach(v => {
    min.add(new Option(v + " åˆ†", v));
  });

  y.value   = "1990";
  m.value   = "1";
  h.value   = "12";
  min.value = "00";

  updateDays();

  const btn = document.getElementById("btnLaunch");
  if (btn) btn.addEventListener("click", () => { calculate(); });
}

function updateDays() {
  const y = document.getElementById("birthYear");
  const m = document.getElementById("birthMonth");
  const d = document.getElementById("birthDay");
  if (!y || !m || !d) return;

  const year  = parseInt(y.value, 10);
  const month = parseInt(m.value, 10);
  const current = d.value;

  d.innerHTML = "";
  const days = new Date(year, month, 0).getDate();
  for (let i = 1; i <= days; i++) {
    const opt = new Option(i + " æ—¥", i);
    if (String(i) === String(current) || (!current && i === 1)) opt.selected = true;
    d.add(opt);
  }
}

document.addEventListener("DOMContentLoaded", initSelectors);
</script>


</body>
</html>


