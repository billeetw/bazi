<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸€èµ·å‡ºä¾†ç© Â· 2026 æˆ°ç•¥å°èˆª</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/iztro/dist/index.min.js"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      color: #e2e8f0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Noto Sans TC",sans-serif;
    }
    .glass {
      background: rgba(15,23,42,0.9);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(148,163,184,0.35);
      border-radius: 1.25rem;
    }
    .bazi-char {
      font-size: 1.8rem;
      font-weight: 900;
      line-height: 1.1;
    }
    /* äº”è¡Œé¡è‰²å®šç¾© */
    .wuxing-æœ¨{background:#22c55e} .wuxing-ç«{background:#ef4444}
    .wuxing-åœŸ{background:#eab308} .wuxing-é‡‘{background:#e5e7eb}
    .wuxing-æ°´{background:#3b82f6}

    /* ====== Nav Bar ====== */
    .nav-bar {
      background: linear-gradient(90deg, #ef4444, #f97316, #ef4444);
      color: #fff;
      padding: 10px 16px;
      position: sticky;
      top: 0;
      z-index: 40;
      box-shadow: 0 4px 20px rgba(220,38,38,0.6);
    }
    .nav-bar-title {
      font-weight: 900;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-size: 11px;
      color: #fee2e2;
    }

    /* ====== ç´«å¾® 12å®®æ ¼æ¨£å¼ ====== */
    .zw-grid-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 8px;
      width: 100%;
      max-width: 520px;
      aspect-ratio: 1/1;
      margin: 0 auto;
    }
    .zw-palace {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      border-radius: 0.85rem;
      padding: 8px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .zw-palace:hover {
      transform: translateY(-2px);
      border-color: rgba(248,250,252,0.8);
      box-shadow: 0 10px 30px rgba(15,23,42,0.7);
    }

    /* å®®ä½ç™¼å…‰ç‰¹æ•ˆ */
    .zw-palace::before {
      content: ''; position: absolute; top: 50%; left: 50%; width: 150%; height: 150%;
      transform: translate(-50%, -50%); opacity: 0; transition: opacity 0.5s ease;
      z-index: -1; pointer-events: none;
    }
    [class*="palace-glow-"]::before { opacity: 1; }
    .palace-glow-æœ¨::before { background: radial-gradient(circle, rgba(34,197,94,0.18) 0%, transparent 70%); }
    .palace-glow-ç«::before { background: radial-gradient(circle, rgba(239,68,68,0.20) 0%, transparent 70%); }
    .palace-glow-åœŸ::before { background: radial-gradient(circle, rgba(234,179,8,0.20) 0%, transparent 70%); }
    .palace-glow-é‡‘::before { background: radial-gradient(circle, rgba(248,250,252,0.18) 0%, transparent 70%); }
    .palace-glow-æ°´::before { background: radial-gradient(circle, rgba(59,130,246,0.20) 0%, transparent 70%); }

    .zw-palace-key {
      border-color: rgba(251, 191, 36, 0.8);
      box-shadow: inset 0 0 16px rgba(251, 191, 36, 0.25);
    }
    .zw-center-block {
      grid-area: 2 / 2 / 4 / 4;
      background: radial-gradient(circle, #1e293b 35%, #020617 100%);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      border-radius: 1.1rem;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      text-align: center; padding: 12px; z-index: 10;
    }
    /* æ˜Ÿæ›œæ–‡å­—äº”è¡Œè‰² */
    .star-wx-æœ¨ { color: #86efac; text-shadow: 0 0 5px rgba(34,197,94,0.5); }
    .star-wx-ç« { color: #fca5a5; text-shadow: 0 0 5px rgba(239,68,68,0.5); }
    .star-wx-åœŸ { color: #fde047; text-shadow: 0 0 5px rgba(234,179,8,0.5); }
    .star-wx-é‡‘ { color: #e2e8f0; text-shadow: 0 0 5px rgba(255,255,255,0.5); }
    .star-wx-æ°´ { color: #93c5fd; text-shadow: 0 0 5px rgba(59,130,246,0.5); }
  </style>
</head>

<body class="min-h-screen">
  <div class="nav-bar">
    <div class="max-w-4xl mx-auto flex items-center justify-between">
      <div>
        <div class="nav-bar-title">YIQICHULA I PLAY Â· 2026 STRATEGIC MAP</div>
        <div class="text-sm font-bold">ä¸€èµ·å‡ºä¾†ç© Â· 2026 æˆ°ç•¥å°èˆª</div>
      </div>
      <a href="#consult" class="text-xs underline underline-offset-4">é ç´„è«®è©¢</a>
    </div>
  </div>

  <main class="max-w-4xl mx-auto p-4 md:p-8 space-y-8">
    <section class="space-y-2">
      <h1 class="text-3xl md:text-4xl font-black tracking-tight">ä½ çš„ 2026 ç”Ÿå­˜æˆ°ç•¥åœ°åœ–</h1>
      <p class="text-slate-400 text-sm">å…«å­— + ç´«å¾®å‘½ç›¤ï¼šäº”è¡Œèƒ½é‡ã€æµæœˆç´…ç¶ ç‡ˆã€èˆ‡äººç”Ÿå»ºè­°ã€‚</p>
    </section>

    <section class="glass p-6 md:p-7 space-y-4">
      <h2 class="text-sm font-bold text-slate-300 tracking-[0.2em] uppercase">Step 1 Â· å¡«å…¥å‡ºç”Ÿæ™‚é–“</h2>
      <div class="grid grid-cols-3 gap-2">
        <select id="birthYear" class="bg-slate-900/70 border border-slate-700 rounded-xl px-3 py-2 text-sm"></select>
        <select id="birthMonth" class="bg-slate-900/70 border border-slate-700 rounded-xl px-3 py-2 text-sm"></select>
        <select id="birthDay" class="bg-slate-900/70 border border-slate-700 rounded-xl px-3 py-2 text-sm"></select>
      </div>
      <div class="grid grid-cols-2 gap-2">
        <select id="birthHour" class="bg-slate-900/70 border border-slate-700 rounded-xl px-3 py-2 text-sm"></select>
        <select id="birthMinute" class="bg-slate-900/70 border border-slate-700 rounded-xl px-3 py-2 text-sm"></select>
      </div>
      <button id="btnLaunch" class="w-full mt-2 bg-gradient-to-r from-amber-400 to-yellow-500 text-slate-950 py-3 rounded-xl font-black tracking-widest text-sm" onclick="calculate()">ç”Ÿæˆæˆ‘çš„ 2026 æˆ°ç•¥</button>
      <p id="hint" class="text-xs text-center text-slate-500 italic"></p>
    </section>

    <section id="report" class="space-y-8 hidden">
      <div class="grid md:grid-cols-[1.1fr,1.1fr] gap-6">
        <div class="glass p-6 space-y-4">
          <h3 class="text-sm font-bold text-slate-300 tracking-[0.25em] uppercase">å…«å­— Â· æ²³åœ–åº§æ¨™</h3>
          <div class="grid grid-cols-4 text-center gap-2">
            <div><div class="text-[10px] text-slate-500 mb-1">å¹´</div><div id="yG" class="bazi-char"></div><div id="yZ" class="text-sm text-slate-300"></div></div>
            <div><div class="text-[10px] text-slate-500 mb-1">æœˆ</div><div id="mG" class="bazi-char"></div><div id="mZ" class="text-sm text-slate-300"></div></div>
            <div><div class="text-[10px] text-amber-400 mb-1">æ—¥</div><div id="dG" class="bazi-char text-amber-400"></div><div id="dZ" class="text-sm text-amber-200"></div></div>
            <div><div class="text-[10px] text-slate-500 mb-1">æ™‚</div><div id="hG" class="bazi-char"></div><div id="hZ" class="text-sm text-slate-300"></div></div>
          </div>
        </div>
        <div class="glass p-6 space-y-4">
          <h3 class="text-sm font-bold text-slate-300 tracking-[0.25em] uppercase">äº”è¡Œèƒ½é‡å„€è¡¨æ¿</h3>
          <div id="surfaceWx" class="space-y-1.5"></div>
          <div id="strategicWx" class="space-y-1.5"></div>
        </div>
      </div>

      <div class="glass p-6 space-y-4">
        <h3 class="text-sm font-bold text-slate-300 tracking-[0.25em] uppercase">ç´«å¾® Â· å‘½ç›¤ 12 å®®</h3>
        <div id="ziweiGrid" class="zw-grid-container"></div>
      </div>

      <div class="glass p-6 space-y-3">
        <h3 class="text-sm font-bold text-slate-300 tracking-[0.25em] uppercase">2026 æµæœˆç´…ç¶ ç‡ˆ</h3>
        <div id="monthGrid" class="space-y-2"></div>
      </div>

      <div class="glass p-6 space-y-3">
        <h3 class="text-sm font-bold text-slate-300 tracking-[0.25em] uppercase">æˆ°ç•¥è§£è®€</h3>
        <div id="analysisBox" class="space-y-2 text-sm text-slate-200"></div>
      </div>

      <div id="consult" class="glass p-6 space-y-3 border border-amber-400/40">
        <h3 class="text-lg font-black text-amber-300">æƒ³æŠŠé€™ä»½æˆ°ç•¥åœ–ï¼Œè®Šæˆä½ çš„ 50 é äººç”Ÿèªªæ˜æ›¸ï¼Ÿ</h3>
        <p class="text-sm text-slate-200 leading-relaxed">æä¾›ä¿ç”¨ä¸€ç”Ÿçš„ 50 é äººç”Ÿæˆ°ç•¥å ±å‘Šï¼Œæ­¡è¿é ç´„æä¼¯å½¥è€å¸«ç·šä¸Šè«®è©¢ã€‚</p>
        <a href="https://forms.gle/UVCSq1udEC549gzYA" target="_blank" class="inline-flex items-center justify-center px-4 py-3 rounded-xl bg-gradient-to-r from-amber-400 to-yellow-500 text-slate-950 text-sm font-black">å‰å¾€é ç´„ç·šä¸Šè«®è©¢</a>
      </div>
    </section>
  </main>

  <script>
    const API_BASE = "https://17gonplay-api.billeetw.workers.dev";
    const PALACE_ORDER = ["å‘½å®®","å…„å¼Ÿ","å¤«å¦»","å­å¥³","è²¡å¸›","ç–¾å„","é·ç§»","åƒ•å½¹","å®˜ç¥¿","ç”°å®…","ç¦å¾·","çˆ¶æ¯"];
    const gridAreas = ["1/1/2/2","1/2/2/3","1/3/2/4","1/4/2/5","2/4/3/5","3/4/4/5","4/4/5/5","4/3/5/4","4/2/5/3","4/1/5/2","3/1/4/2","2/1/3/2"];
    const STAR_WUXING_MAP = {"ç´«å¾®":"åœŸ","å¤©æ©Ÿ":"æœ¨","å¤ªé™½":"ç«","æ­¦æ›²":"é‡‘","å¤©åŒ":"æ°´","å»‰è²":"ç«","å¤©åºœ":"åœŸ","å¤ªé™°":"æ°´","è²ªç‹¼":"æœ¨","å·¨é–€":"æ°´","å¤©ç›¸":"æ°´","å¤©æ¢":"åœŸ","ä¸ƒæ®º":"é‡‘","ç ´è»":"æ°´"};

    // æ¸²æŸ“äº”è¡Œ
    function renderBar(id, data, max) {
      const box = document.getElementById(id);
      if (!box) return;
      box.innerHTML = `<div class="text-[11px] text-slate-400 mb-1">${id==='surfaceWx'?'è¡¨å±¤çµæ§‹':'å¯¦æˆ°åŠ æ¬Š'}</div>`;
      ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => {
        const v = Number(data?.[e] || 0);
        const w = max ? Math.max(4, (v / max) * 100) : 0;
        box.innerHTML += `<div class="mb-1"><div class="flex justify-between text-[11px]"><span>${e}</span><span>${v.toFixed(1)}</span></div><div class="h-1.5 bg-slate-800 rounded-full overflow-hidden"><div class="h-full wuxing-${e}" style="width:${w}%"></div></div></div>`;
      });
    }

    // æ¸²æŸ“ç´«å¾®
    function renderZiwei(ziwei) {
      const container = document.getElementById("ziweiGrid");
      if (!container) return;
      container.innerHTML = "";
      PALACE_ORDER.forEach((name, idx) => {
        const stars = ziwei.mainStars?.[name] || [];
        const isKey = ["å‘½å®®","å®˜ç¥¿","è²¡å¸›"].includes(name);
        let palaceMainElement = "";
        let starsHtml = stars.length ? stars.map((s, i) => {
          const wx = STAR_WUXING_MAP[s] || "";
          if (i === 0) palaceMainElement = wx;
          return `<span class="star-wx-${wx}">${s}</span>`;
        }).join("<br>") : '<span class="text-slate-600 italic">ç©ºå®®</span>';
        container.innerHTML += `<div class="zw-palace ${isKey?'zw-palace-key':''} palace-glow-${palaceMainElement}" style="grid-area:${gridAreas[idx]}"><div class="text-[9px] font-bold text-slate-500 mb-1">${name}</div><div class="text-[12px] font-black leading-tight">${starsHtml}</div></div>`;
      });
      container.innerHTML += `<div class="zw-center-block"><div class="zw-center-block-badge mb-1">Destiny Core</div><div class="text-amber-400 font-black text-xl">${ziwei.core?.minggong || "â€”"}</div><div class="text-[10px] text-slate-400 mt-1">èº«ï¼š${ziwei.core?.shengong || "â€”"}</div><div class="text-[10px] text-slate-400">${ziwei.core?.wuxingju || "â€”"}å±€</div></div>`;
    }

    // æ•´åˆ iztro é‹ç®—
    function buildZiweiFeaturesLocal(vy, vm, vd, vh, vmin) {
      try {
        const astrolabe = iztro.astrolabe.fromSolar(`${vy}-${vm}-${vd}`, vh, vmin, 'male', true);
        const palaceMap = {};
        astrolabe.palaces.forEach(p => palaceMap[p.name] = p.majorStars.map(s => s.name));
        return { version: "ziwei_features_v1", core: { minggong: astrolabe.palaces.find(p=>p.isTaiWei)?.name || "å‘½å®®", shengong: astrolabe.bodyPalace.name, wuxingju: astrolabe.fiveElementsClass }, mainStars: palaceMap };
      } catch (e) { console.error(e); return null; }
    }

    async function calculate() {
      const vy=Number(document.getElementById("birthYear").value), vm=Number(document.getElementById("birthMonth").value), vd=Number(document.getElementById("birthDay").value), vh=Number(document.getElementById("birthHour").value), vmin=Number(document.getElementById("birthMinute").value);
      const hint=document.getElementById("hint");
      try {
        hint.innerText = "æ­£åœ¨åŒæ­¥æ˜Ÿç›¤èˆ‡æˆ°ç•¥æ•¸æ“š...";
        const ziweiLocal = buildZiweiFeaturesLocal(vy, vm, vd, vh, vmin);
        const resp = await fetch(`${API_BASE}/compute/all`, { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({year:vy, month:vm, day:vd, hour:vh, minute:vmin, ziwei:ziweiLocal}) });
        const payload = await resp.json();
        if (!payload.ok) throw new Error(payload.error);
        const { bazi, ziwei } = payload.features;

        // å…«å­—æ¸²æŸ“
        const d = bazi.display;
        document.getElementById("yG").innerText=d.yG; document.getElementById("yZ").innerText=d.yZ;
        document.getElementById("mG").innerText=d.mG; document.getElementById("mZ").innerText=d.mZ;
        document.getElementById("dG").innerText=d.dG; document.getElementById("dZ").innerText=d.dZ;
        document.getElementById("hG").innerText=d.hG; document.getElementById("hZ").innerText=d.hZ;
        document.getElementById("baziDmTag").innerText = `æ—¥ä¸»ï¼š${bazi.dmElement}`;

        renderBar("surfaceWx", bazi.wuxing.surface, 4);
        renderBar("strategicWx", bazi.wuxing.strategic, bazi.wuxing.maxStrategic);
        renderZiwei(ziwei || ziweiLocal);

        // æµæœˆèˆ‡è§£è®€
        const monthGrid = document.getElementById("monthGrid"); monthGrid.innerHTML = "";
        const redMonths = [];
        bazi.liuyue2026.bounds.forEach(b => {
          if (b.light === "RED") redMonths.push(b.gz);
          monthGrid.innerHTML += `<div class="flex items-center justify-between p-3 rounded-xl border-l-4 ${b.light==='RED'?'border-red-500 bg-red-500/10':'border-emerald-400 bg-emerald-500/10'}"><div><div class="text-sm font-bold">${b.gz} <span class="text-[11px] text-slate-300 ml-1">${b.range}</span></div><div class="text-[11px] text-slate-300 mt-0.5">æœ¬æ°£ï¼š${b.ssBranch}</div></div><div class="text-[11px] font-bold px-2 py-1 rounded-lg bg-slate-900/80 text-slate-50">${b.light==='RED'?'ğŸ”´ å£“åŠ›':'ğŸŸ¢ ç©©é€²'}</div></div>`;
        });

        document.getElementById("analysisBox").innerHTML = `<p>å¹´åº¦ä¸»è»¸ï¼š${bazi.tenGod.dominant}ã€‚${redMonths.length?'å£“åŠ›æœˆï¼š'+redMonths.join('ã€')+'ï¼Œè«‹æ”¶æ–‚è¡Œå‹•ã€‚':'ä»Šå¹´æ•´é«”ç¯€å¥ç©©å¥ã€‚'}</p>`;
        document.getElementById("report").classList.remove("hidden");
        hint.innerText = "";
        document.getElementById("report").scrollIntoView({ behavior:"smooth" });
      } catch (e) { alert("è¨ˆç®—å¤±æ•—ï¼š" + e.message); hint.innerText = ""; }
    }

    // åˆå§‹åŒ–é¸å–®
    function initSelectors() {
      const y=document.getElementById("birthYear"), m=document.getElementById("birthMonth"), d=document.getElementById("birthDay"), h=document.getElementById("birthHour"), min=document.getElementById("birthMinute");
      for(let i=2026;i>=1940;i--) y.add(new Option(i+" å¹´", i));
      for(let i=1;i<=12;i++) m.add(new Option(i+" æœˆ", i));
      for(let i=0;i<24;i++) h.add(new Option(String(i).padStart(2,"0")+" æ™‚", i));
      ["00","15","30","45"].forEach(v => min.add(new Option(v+" åˆ†", v)));
      y.value="1990"; m.value="1"; h.value="12"; min.value="00";
      const updateDays = () => {
        const year=Number(y.value), month=Number(m.value), cur=d.value; d.innerHTML = "";
        const days = new Date(year, month, 0).getDate();
        for(let i=1;i<=days;i++) { const opt=new Option(i+" æ—¥",i); if(String(i)===cur) opt.selected=true; d.add(opt); }
      };
      y.onchange = m.onchange = updateDays; updateDays();
    }
    document.addEventListener("DOMContentLoaded", initSelectors);
  </script>
</body>
</html>
