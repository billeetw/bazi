<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2026 æˆ°ç•¥å°èˆªï½œä¸€èµ·å‡ºä¾†ç©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#0b0e14; color:#e2e8f0; font-family: system-ui,-apple-system; }
    .glass { background: rgba(255,255,255,.04); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,.08); }
    .bazi-char { font-size:1.8rem; font-weight:900; line-height:1.1; }
    .wuxing-æœ¨{background:#2ecc71}.wuxing-ç«{background:#e74c3c}
    .wuxing-åœŸ{background:#f1c40f}.wuxing-é‡‘{background:#ced4da}
    .wuxing-æ°´{background:#3498db}

    /* ===== ç´«å¾® 12 å®®æ ¼ ===== */
    .zw-grid-container{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      grid-template-rows:repeat(4,1fr);
      gap:8px;
      width:100%;
      max-width:520px;
      aspect-ratio:1/1;
      margin:0 auto;
    }
    .zw-palace{
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 14px;
      padding: 8px;
      position: relative;
      overflow: hidden;
    }
    .zw-palace-key{
      border-color: rgba(251,191,36,0.55);
      box-shadow: inset 0 0 18px rgba(251,191,36,0.08);
    }
    .zw-center-block{
      grid-area: 2 / 2 / 4 / 4;
      background: radial-gradient(circle, rgba(30,41,59,0.85) 10%, rgba(2,6,23,0.95) 70%);
      border: 1px dashed rgba(148,163,184,0.35);
      border-radius: 18px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 10px;
    }
    .star-wx-æœ¨{ color:#86efac; text-shadow:0 0 5px rgba(34,197,94,0.45); }
    .star-wx-ç«{ color:#fca5a5; text-shadow:0 0 5px rgba(239,68,68,0.45); }
    .star-wx-åœŸ{ color:#fde047; text-shadow:0 0 5px rgba(234,179,8,0.45); }
    .star-wx-é‡‘{ color:#e2e8f0; text-shadow:0 0 5px rgba(255,255,255,0.35); }
    .star-wx-æ°´{ color:#93c5fd; text-shadow:0 0 5px rgba(59,130,246,0.45); }
    .zw-palace::before{
      content:"";
      position:absolute; inset:-25%;
      opacity:0; transition:opacity .3s ease;
      pointer-events:none;
    }
    [class*="palace-glow-"]::before{ opacity:1; }
    .palace-glow-æœ¨::before{ background: radial-gradient(circle, rgba(34,197,94,0.14) 0%, transparent 62%); }
    .palace-glow-ç«::before{ background: radial-gradient(circle, rgba(239,68,68,0.14) 0%, transparent 62%); }
    .palace-glow-åœŸ::before{ background: radial-gradient(circle, rgba(234,179,8,0.14) 0%, transparent 62%); }
    .palace-glow-é‡‘::before{ background: radial-gradient(circle, rgba(255,255,255,0.10) 0%, transparent 62%); }
    .palace-glow-æ°´::before{ background: radial-gradient(circle, rgba(59,130,246,0.14) 0%, transparent 62%); }
  </style>
</head>

<body class="p-4 pb-24">
  <!-- Top Nav -->
  <div class="sticky top-0 z-50 -mx-4 px-4 py-3 bg-black/40 backdrop-blur border-b border-white/10">
    <div class="max-w-xl mx-auto flex items-center justify-between">
      <div class="font-black tracking-tight">2026 æˆ°ç•¥å°èˆª</div>
      <div class="flex gap-2 text-xs">
        <button class="px-3 py-1 rounded bg-white/5 hover:bg-white/10" onclick="go('#sec-bazi')">å››æŸ±</button>
        <button class="px-3 py-1 rounded bg-white/5 hover:bg-white/10" onclick="go('#sec-wx')">äº”è¡Œ</button>
        <button class="px-3 py-1 rounded bg-white/5 hover:bg-white/10" onclick="go('#sec-ziwei')">ç´«å¾®</button>
        <button class="px-3 py-1 rounded bg-white/5 hover:bg-white/10" onclick="go('#sec-liuyue')">æµæœˆ</button>
        <button class="px-3 py-1 rounded bg-white/5 hover:bg-white/10" onclick="go('#sec-analysis')">è§£è®€</button>
      </div>
    </div>
  </div>

  <h1 class="text-3xl font-black text-center my-6">2026 æµå¹´æˆ°ç•¥å ±å‘Š</h1>

  <!-- è¼¸å…¥ -->
  <div class="glass p-6 rounded-xl max-w-xl mx-auto mb-8">
    <div class="grid grid-cols-3 gap-2 mb-3">
      <select id="birthYear" class="bg-black/40 p-2 rounded"></select>
      <select id="birthMonth" class="bg-black/40 p-2 rounded" onchange="updateDays()"></select>
      <select id="birthDay" class="bg-black/40 p-2 rounded"></select>
    </div>
    <div class="grid grid-cols-2 gap-2 mb-4">
      <select id="birthHour" class="bg-black/40 p-2 rounded"></select>
      <select id="birthMinute" class="bg-black/40 p-2 rounded"></select>
    </div>

    <button id="btnLaunch" class="w-full bg-amber-500 text-black py-3 rounded font-black">
      ç”Ÿæˆæˆ‘çš„ 2026 æˆ°ç•¥
    </button>

    <p id="hint" class="text-xs text-slate-400 mt-3 italic"></p>
  </div>

  <!-- å ±å‘Š -->
  <div id="report" class="hidden max-w-xl mx-auto space-y-8">

    <!-- å››æŸ± -->
    <div id="sec-bazi" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">å››æŸ±ï¼ˆé¡¯ç¤ºç”¨ï¼‰</h2>
      <div class="grid grid-cols-4 text-center">
        <div><div id="yG" class="bazi-char"></div><div id="yZ" class="text-sm text-slate-300"></div></div>
        <div><div id="mG" class="bazi-char"></div><div id="mZ" class="text-sm text-slate-300"></div></div>
        <div><div id="dG" class="bazi-char text-amber-400"></div><div id="dZ" class="text-sm text-slate-300"></div></div>
        <div><div id="hG" class="bazi-char"></div><div id="hZ" class="text-sm text-slate-300"></div></div>
      </div>
      <div id="meta" class="text-[11px] text-slate-500 mt-3"></div>
    </div>

    <!-- äº”è¡Œ -->
    <div id="sec-wx" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">äº”è¡Œèƒ½é‡</h2>
      <div class="text-xs text-slate-400 mb-2">è¡¨å±¤ï¼ˆå¤©å¹²è¨ˆæ•¸ï¼‰</div>
      <div id="surfaceWx" class="space-y-2 mb-5"></div>

      <div class="text-xs text-slate-400 mb-2">å¯¦æˆ°ï¼ˆå¤©å¹²+è—å¹²+æœˆä»¤åŠ æ¬Šï¼‰</div>
      <div id="strategicWx" class="space-y-2"></div>
    </div>

    <!-- âœ… ç´«å¾®ï¼šæ”¾åœ¨æµæœˆå‰ -->
    <div id="sec-ziwei" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-2">ç´«å¾®å‘½ç›¤ 12 å®®ç¸½è¦½</h2>
      <p class="text-xs text-slate-400 mb-4">
        å‘½ç›¤ä»¥ã€Œå‘½å®®ï¼å®˜ç¥¿å®®ï¼è²¡å¸›å®®ã€ç‚ºä¸»è»¸ï¼Œå…ˆç”¨ä¸»æ˜Ÿï¼‹äº”è¡Œèƒ½é‡å‘ˆç¾ã€‚
      </p>

      <div id="ziweiGridWrap">
        <div id="ziweiGrid" class="zw-grid-container"></div>
      </div>

      <div id="ziweiHint" class="text-xs text-slate-400 italic mt-4"></div>
    </div>

    <!-- æµæœˆ -->
    <div id="sec-liuyue" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">2026 æµæœˆç¯€å¥ï¼ˆ12ï¼‰</h2>
      <div id="monthGrid" class="space-y-2"></div>
    </div>

    <!-- åˆ†æ -->
    <div id="sec-analysis" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">æˆ°ç•¥è§£è®€ï¼ˆfallbackï¼‰</h2>
      <div id="analysisBox" class="space-y-2 text-sm text-slate-200"></div>
    </div>

  </div>

<script>
const API_BASE = "https://17gonplay-api.billeetw.workers.dev";

function go(sel){ document.querySelector(sel)?.scrollIntoView({behavior:"smooth", block:"start"}); }

function renderBar(id, data, max) {
  const box = document.getElementById(id);
  if (!box) return;
  box.innerHTML = "";
  ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => {
    const v = Number(data?.[e] || 0);
    const w = max ? Math.max(2, (v / max) * 100) : 0;
    box.innerHTML += `
      <div class="mb-1">
        <div class="flex justify-between text-xs">
          <span>${e}</span><span>${v.toFixed(1)}</span>
        </div>
        <div class="h-2 bg-white/10 rounded overflow-hidden">
          <div class="h-full wuxing-${e}" style="width:${Math.max(0, Math.min(100, w))}%"></div>
        </div>
      </div>`;
  });
}

/* ========= ç´«å¾®æ–¹ç›¤æ¸²æŸ“ ========= */
const PALACE_ORDER = ["å‘½å®®","å…„å¼Ÿ","å¤«å¦»","å­å¥³","è²¡å¸›","ç–¾å„","é·ç§»","åƒ•å½¹","å®˜ç¥¿","ç”°å®…","ç¦å¾·","çˆ¶æ¯"];
const gridAreas = [
  "1/1/2/2","1/2/2/3","1/3/2/4","1/4/2/5",
  "2/4/3/5","3/4/4/5","4/4/5/5",
  "4/3/5/4","4/2/5/3","4/1/5/2",
  "3/1/4/2","2/1/3/2"
];

const STAR_WUXING_MAP = {
  "ç´«å¾®":"åœŸ","å¤©æ©Ÿ":"æœ¨","å¤ªé™½":"ç«","æ­¦æ›²":"é‡‘","å¤©åŒ":"æ°´",
  "å»‰è²":"ç«","å¤©åºœ":"åœŸ","å¤ªé™°":"æ°´","è²ªç‹¼":"æœ¨","å·¨é–€":"æ°´",
  "å¤©ç›¸":"æ°´","å¤©æ¢":"åœŸ","ä¸ƒæ®º":"é‡‘","ç ´è»":"æ°´"
};

// âœ… æ”¯æ´ä½ ç¾åœ¨å¯èƒ½æ˜¯è‹±æ–‡ keyï¼šminggong/career/wealth
function mapMainStarsToCN(mainStars){
  if (!mainStars) return {};
  // å¦‚æœå·²ç¶“æ˜¯ä¸­æ–‡ keyï¼Œç›´æ¥å›
  if (mainStars["å‘½å®®"] || mainStars["å®˜ç¥¿"] || mainStars["è²¡å¸›"]) return mainStars;

  const out = {};
  // ä½ ç¾åœ¨å¸¸è¦‹çš„ä¸‰å€‹ï¼šå‘½/å®˜/è²¡
  if (Array.isArray(mainStars.minggong)) out["å‘½å®®"] = mainStars.minggong;
  if (Array.isArray(mainStars.career)) out["å®˜ç¥¿"] = mainStars.career;
  if (Array.isArray(mainStars.wealth)) out["è²¡å¸›"] = mainStars.wealth;

  // å…¶ä»–å¦‚æœä½ æœ‰ï¼šout["å…„å¼Ÿ"]=... ä¹‹å¾Œå†è£œ
  return out;
}

function renderZiwei(ziwei){
  const container = document.getElementById("ziweiGrid");
  const hint = document.getElementById("ziweiHint");
  if (!container) return;

  if (!ziwei || ziwei.version !== "ziwei_features_v1"){
    container.innerHTML = `<div class="w-full h-full flex items-center justify-center text-xs text-slate-500">ï¼ˆå°šæœªå–å¾—ç´«å¾®è³‡æ–™ï¼‰</div>`;
    if (hint) hint.textContent = "ï¼ˆç›®å‰å°šæœªå–å¾—ç´«å¾®è³‡æ–™ï¼šè«‹ç¢ºèª /compute/all å·²å›å‚³ features.ziweiï¼Œæˆ–å‰ç«¯æœ‰æŠŠ ziwei ä¸€èµ· POST ä¸Šå»ï¼‰";
    return;
  }

  const mainStarsCN = mapMainStarsToCN(ziwei.mainStars);
  container.className = "zw-grid-container";
  container.innerHTML = "";

  PALACE_ORDER.forEach((name, idx)=>{
    const starsList = mainStarsCN[name] || [];
    const isKey = ["å‘½å®®","å®˜ç¥¿","è²¡å¸›"].includes(name);

    let palaceMainElement = "";
    let starsHtml = "";

    if (starsList.length){
      starsHtml = starsList.map((s, i)=>{
        const wx = STAR_WUXING_MAP[s] || "";
        if (i === 0 && wx) palaceMainElement = wx;
        return `<span class="${wx ? "star-wx-"+wx : ""}">${s}</span>`;
      }).join("<br>");
    } else {
      starsHtml = `<span class="text-slate-600 text-xs italic font-normal">ç©ºå®®</span>`;
    }

    const glowClass = palaceMainElement ? `palace-glow-${palaceMainElement}` : "";
    container.innerHTML += `
      <div class="zw-palace ${isKey ? "zw-palace-key":""} ${glowClass}" style="grid-area:${gridAreas[idx]}">
        <div class="text-[10px] font-bold text-slate-500 mb-1">${name}</div>
        <div class="text-[13px] font-black leading-snug tracking-wide">${starsHtml}</div>
      </div>`;
  });

  container.innerHTML += `
    <div class="zw-center-block">
      <div class="text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">Destiny Core</div>
      <div class="text-amber-400 font-black text-xl tracking-widest">${ziwei.core?.minggong || "â€”"}</div>
      <div class="text-[10px] text-slate-400 mt-2">èº«å®®ï¼š${ziwei.core?.shengong || "â€”"}</div>
      <div class="text-[10px] text-slate-400">${ziwei.core?.wuxingju || "â€”"}å±€</div>
    </div>`;

  if (hint) hint.textContent = "";
}

/* ========= ä½ å·²æœ‰çš„ç´«å¾®è¨ˆç®—ï¼šè²¼åœ¨é€™è£¡ =========
   ä½ ç¾åœ¨ã€Œç´«å¾®å‡ºä¸ä¾†ã€99% æ˜¯å› ç‚º contract æ²’æœ‰ ziweiã€‚
   Worker å·²æ”¯æ´åƒ body.ziweiï¼Œä½ åªè¦æŠŠä½ åŸæœ¬ç®—å‡ºä¾†çš„ ziwei_features_v1 å›å‚³å³å¯ã€‚
*/
function buildZiweiFeaturesLocal(vy, vm, vd, vh, vmin){
  // TODOï¼šæŠŠä½ åŸæœ¬èƒ½åå‡ºï¼š
  // {version:'ziwei_features_v1', core:{...}, mainStars:{...}, tendencies:{...}}
  // çš„é‚£æ®µç¨‹å¼è²¼é€²ä¾†ï¼Œç„¶å¾Œ return å®ƒ

  // å…ˆå› undefined ä¹Ÿä¸æœƒç‚¸ï¼ˆæœƒé¡¯ç¤º fallbackï¼‰
  return undefined;
}

/* ========= ä¸»æµç¨‹ï¼š/compute/allï¼ˆå¯æŠŠ ziwei ä¸€èµ· POSTï¼‰ ========= */
async function calculate(){
  const vy   = parseInt(document.getElementById("birthYear")?.value, 10);
  const vm   = parseInt(document.getElementById("birthMonth")?.value, 10);
  const vd   = parseInt(document.getElementById("birthDay")?.value, 10);
  const vh   = parseInt(document.getElementById("birthHour")?.value, 10);
  const vmin = parseInt(document.getElementById("birthMinute")?.value, 10);

  try{
    if (![vy,vm,vd,vh,vmin].every(n => Number.isFinite(n))) throw new Error("è«‹å…ˆé¸å¥½å‡ºç”Ÿå¹´æœˆæ—¥èˆ‡æ™‚é–“");

    // âœ… å…ˆåœ¨å‰ç«¯ç®—ç´«å¾®ï¼ˆä½ åŸæœ¬é‚£å¥—ï¼‰ï¼Œä¸€èµ· POST çµ¦ Worker
    const ziweiLocal = buildZiweiFeaturesLocal(vy, vm, vd, vh, vmin);

    const resp = await fetch(`${API_BASE}/compute/all`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ year:vy, month:vm, day:vd, hour:vh, minute:vmin, ziwei: ziweiLocal })
    });

    if (!resp.ok){
      const txt = await resp.text().catch(()=> "");
      throw new Error(`API HTTP ${resp.status} ${txt || ""}`.trim());
    }

    const payload = await resp.json();
    if (!payload?.ok) throw new Error(payload?.error || "API error");

    window.__payload = payload;
    window.__contract = payload.features;

    const contract = payload.features;
    const bazi = contract?.bazi;

    if (!contract || contract.version !== "strategic_features_v1") throw new Error("contract æ ¼å¼ä¸æ­£ç¢º");
    if (!bazi) throw new Error("contract.bazi ä¸å­˜åœ¨");

    // å››æŸ±
    const disp = bazi.display;
    document.getElementById("yG").innerText = disp?.yG || "";
    document.getElementById("yZ").innerText = disp?.yZ || "";
    document.getElementById("mG").innerText = disp?.mG || "";
    document.getElementById("mZ").innerText = disp?.mZ || "";
    document.getElementById("dG").innerText = disp?.dG || "";
    document.getElementById("dZ").innerText = disp?.dZ || "";
    document.getElementById("hG").innerText = disp?.hG || "";
    document.getElementById("hZ").innerText = disp?.hZ || "";

    // äº”è¡Œ
    renderBar("surfaceWx", bazi.wuxing?.surface, 4);
    renderBar("strategicWx", bazi.wuxing?.strategic, bazi.wuxing?.maxStrategic || 1);

    // ç´«å¾®ï¼ˆâœ… å„ªå…ˆç”¨ contract.ziweiï¼›è‹¥æ²’æœ‰å°±ç”¨ ziweiLocalï¼‰
    const ziwei = contract?.ziwei || ziweiLocal;
    renderZiwei(ziwei);

    // æµæœˆ
    const bounds = bazi.liuyue2026?.bounds || [];
    const monthGrid = document.getElementById("monthGrid");
    monthGrid.innerHTML = "";
    const redMonths = [];
    if (bounds.length){
      bounds.forEach(b=>{
        const red = b.light === "RED";
        if (red) redMonths.push(b.gz);
        monthGrid.innerHTML += `
          <div class="p-3 rounded border-l-4 ${red ? "border-red-500 bg-red-500/10":"border-emerald-500 bg-emerald-500/10"}">
            <div class="font-bold">${b.gz} <span class="text-xs text-slate-400 ml-1">${b.range || ""}</span></div>
            <div class="text-xs text-slate-300 mt-1">${red ? "ğŸ”´ å£“åŠ›":"ğŸŸ¢ ç©©é€²"} ï½œ æœ¬æ°£ï¼š${b.ssBranch || ""}</div>
          </div>`;
      });
    } else {
      monthGrid.innerHTML = `<div class="text-xs text-slate-400 italic">ï¼ˆæš«ç„¡æµæœˆè³‡æ–™ï¼‰</div>`;
    }

    // fallback è§£è®€
    const dominant = (bazi.tenGod?.dominant || "").trim() || "æœªå®š";
    const dmElement = bazi.dmElement || "ç«";
    document.getElementById("analysisBox").innerHTML = `
      <p>ä½ çš„æ—¥ä¸»äº”è¡Œä¸»å ´æ˜¯ã€Œ${dmElement}ã€ï¼Œ2026 å¹´åº¦ä¸»è»¸åå‘ã€Œ${dominant}ã€ã€‚</p>
      <p>${redMonths.length ? `å£“åŠ›æœˆï¼š${redMonths.join("ã€")}ï¼ˆé€™äº›æœˆå…ˆå®ˆè¦å‰‡ï¼Œä¸è¦ç¡¬è¡ï¼‰ã€‚` : "ä»Šå¹´å£“åŠ›æœˆåå°‘ï¼Œå¯ä»¥ç©©ç©©æ¨é€²ã€‚"}</p>
      <p>ç­–ç•¥ï¼šæŠŠè¡Œå‹•æ‹†å°ã€ç›®æ¨™è®Šå°‘ã€ç¯€å¥å›ºå®šï¼Œå£“åŠ›æœˆå„ªå…ˆå®ˆä½ç¾æœ‰ç›¤é¢ã€‚</p>`;

    document.getElementById("report").classList.remove("hidden");
    go("#sec-bazi");
  }catch(e){
    console.error(e);
    alert("è¨ˆç®—å¤±æ•—ï¼š" + (e?.message || e));
  }
}

/* UIï¼šæ—¥æœŸé¸å–® */
function initSelectors(){
  const y = document.getElementById("birthYear");
  const m = document.getElementById("birthMonth");
  const d = document.getElementById("birthDay");
  const h = document.getElementById("birthHour");
  const min = document.getElementById("birthMinute");

  for (let i=2026;i>=1940;i--) y.add(new Option(i+" å¹´", i));
  for (let i=1;i<=12;i++) m.add(new Option(i+" æœˆ", i));
  for (let i=0;i<24;i++) h.add(new Option(String(i).padStart(2,"0")+" æ™‚", i));
  ["00","15","30","45"].forEach(v => min.add(new Option(v+" åˆ†", v)));

  y.value="1990"; m.value="1"; h.value="12"; min.value="00";
  updateDays();
}
function updateDays(){
  const y = document.getElementById("birthYear");
  const m = document.getElementById("birthMonth");
  const d = document.getElementById("birthDay");
  const year = parseInt(y.value,10);
  const month = parseInt(m.value,10);
  const cur = d.value;
  d.innerHTML="";
  const days = new Date(year, month, 0).getDate();
  for (let i=1;i<=days;i++){
    const opt = new Option(i+" æ—¥", i);
    if (String(i)===String(cur) || (!cur && i===1)) opt.selected=true;
    d.add(opt);
  }
}

document.addEventListener("DOMContentLoaded", ()=>{
  initSelectors();
  document.getElementById("btnLaunch").addEventListener("click", calculate);
});
</script>
</body>
</html>
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #94a3b8;
    }

    /* ============ äº”è¡Œæ˜Ÿæ›œé¡è‰² ============ */
    .star-wx-æœ¨ {
      color: #86efac;
      text-shadow: 0 0 5px rgba(34,197,94,0.5);
    }
    .star-wx-ç« {
      color: #fca5a5;
      text-shadow: 0 0 5px rgba(239,68,68,0.5);
    }
    .star-wx-åœŸ {
      color: #fde047;
      text-shadow: 0 0 5px rgba(234,179,8,0.5);
    }
    .star-wx-é‡‘ {
      color: #e2e8f0;
      text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }
    .star-wx-æ°´ {
      color: #93c5fd;
      text-shadow: 0 0 5px rgba(59,130,246,0.5);
    }

    /* ============ ç´«å¾® 12 å®®æ ¼å®¹å™¨ ============ */
    .zw-grid-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 8px;
      width: 100%;
      max-width: 520px;
      aspect-ratio: 1/1;
      margin: 0 auto;
    }

    /* å€‹åˆ¥å®®ä½æ–¹æ ¼åŸºç¤æ¨£å¼ */
    .zw-palace {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      border-radius: 0.85rem;
      padding: 8px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .zw-palace:hover {
      transform: translateY(-2px);
      border-color: rgba(248,250,252,0.8);
      box-shadow: 0 10px 30px rgba(15,23,42,0.7);
    }

    /* ============ å®®ä½äº”è¡Œèƒ½é‡ç™¼å…‰ç‰¹æ•ˆ ============ */
    .zw-palace::before {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      width: 150%; height: 150%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: -1;
      pointer-events: none;
    }

    [class*="palace-glow-"]::before { opacity: 1; }

    .palace-glow-æœ¨::before {
      background: radial-gradient(circle, rgba(34,197,94,0.18) 0%, transparent 70%);
    }
    .palace-glow-ç«::before {
      background: radial-gradient(circle, rgba(239,68,68,0.20) 0%, transparent 70%);
    }
    .palace-glow-åœŸ::before {
      background: radial-gradient(circle, rgba(234,179,8,0.20) 0%, transparent 70%);
    }
    .palace-glow-é‡‘::before {
      background: radial-gradient(circle, rgba(248,250,252,0.18) 0%, transparent 70%);
    }
    .palace-glow-æ°´::before {
      background: radial-gradient(circle, rgba(59,130,246,0.20) 0%, transparent 70%);
    }

    .zw-palace-key {
      border-color: rgba(251, 191, 36, 0.8);
      box-shadow: inset 0 0 16px rgba(251, 191, 36, 0.25);
    }

    /* ä¸­å¿ƒå€åŸŸï¼ˆå‘½èº«ï¼‹äº”è¡Œå±€ï¼‰ */
    .zw-center-block {
      grid-area: 2 / 2 / 4 / 4;
      background: radial-gradient(circle, #1e293b 35%, #020617 100%);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      border-radius: 1.1rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 12px;
      z-index: 10;
    }

    .zw-center-block-badge {
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #64748b;
    }

    .nav-bar {
      background: linear-gradient(90deg, #ef4444, #f97316, #ef4444);
      color: #fff;
      padding: 10px 16px;
      position: sticky;
      top: 0;
      z-index: 40;
      box-shadow: 0 4px 20px rgba(220,38,38,0.6);
    }
  </style>
</head>

<body class="pb-16">

  <!-- å°èˆª bar -->
  <div class="nav-bar flex items-center justify-between">
    <div class="text-xs md:text-sm font-bold tracking-[0.25em] uppercase">
      ä¸€èµ·å‡ºä¾†ç© Â· 2026 æˆ°ç•¥å°èˆª
    </div>
    <a
      href="https://www.youtube.com/@billeetw1"
      target="_blank"
      class="text-[11px] md:text-xs bg-white text-red-600 font-black px-3 py-1 rounded-full shadow"
    >
      è¨‚é–±æœ€æ–°æˆ°ç•¥ ğŸ””
    </a>
  </div>

  <main class="max-w-5xl mx-auto px-4 pt-6 space-y-8">
    <!-- æ¨™é¡Œ -->
    <section class="text-center space-y-2">
      <h1 class="text-3xl md:text-4xl font-black tracking-tight">
        2026 æµå¹´æˆ°ç•¥å ±å‘Š
      </h1>
      <p class="text-xs text-slate-400 tracking-[0.25em] uppercase">
        BAZI Ã— ç´«å¾® Ã— æµæœˆç¯€å¥
      </p>
    </section>

    <!-- è¼¸å…¥ -->
    <section class="glass p-6 md:p-7 space-y-4 max-w-xl mx-auto">
      <h2 class="text-sm font-black text-slate-200 tracking-[0.28em] uppercase mb-1">
        01. è¼¸å…¥ä½ çš„å‡ºç”Ÿæ™‚é–“
      </h2>
      <p class="text-xs text-slate-400 mb-2">
        ä½¿ç”¨è¥¿å…ƒï¼ˆå…¬æ›†ï¼‰ï¼Œæ™‚å€ä»¥ç•¶åœ°å‡ºç”Ÿåœ°ç‚ºä¸»ã€‚åˆ†é˜é¸ä¸æº–æ²’é—œä¿‚ï¼Œå…ˆæŠ“ä¸€å€‹å¤§æ¦‚çš„æ•´åˆ»åº¦ã€‚
      </p>

      <div class="grid grid-cols-3 gap-2 mb-3">
        <select id="birthYear" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
        <select id="birthMonth" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
        <select id="birthDay" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
      </div>
      <div class="grid grid-cols-2 gap-2 mb-4">
        <select id="birthHour" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
        <select id="birthMinute" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
      </div>

      <button
        id="btnLaunch"
        class="w-full bg-gradient-to-r from-amber-400 via-yellow-400 to-amber-500 text-black py-3.5 rounded-xl font-black tracking-[0.25em] text-xs md:text-sm uppercase shadow-lg active:scale-[0.98] transition"
      >
        ç”Ÿæˆæˆ‘çš„ 2026 æˆ°ç•¥
      </button>

      <p id="hint" class="text-[11px] text-slate-400 mt-3 italic"></p>
    </section>

    <!-- å ±å‘Š -->
    <section id="report" class="hidden space-y-8">

      <!-- å…«å­—ï¼šå››æŸ± + äº”è¡Œ -->
      <section class="glass p-6 md:p-7 space-y-5">
        <div class="flex items-center justify-between mb-1">
          <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">
            02. æ²³åœ–æ™‚ç©ºåº§æ¨™ï¼ˆå››æŸ±ï¼‹äº”è¡Œï¼‰
          </h2>
          <span id="baziDmTag" class="text-[11px] px-2 py-1 rounded-full border border-amber-400/70 text-amber-300 font-bold">
            æ—¥ä¸»ï¼šâ€”
          </span>
        </div>

        <!-- å››æŸ± -->
        <div class="grid grid-cols-4 gap-2 text-center">
          <div class="py-3 rounded-xl bg-slate-900/70">
            <div class="text-[10px] text-slate-400 tracking-[0.2em] uppercase mb-1">å¹´</div>
            <div id="yG" class="bazi-char"></div>
            <div id="yZ" class="text-sm text-slate-300"></div>
          </div>
          <div class="py-3 rounded-xl bg-slate-900/70">
            <div class="text-[10px] text-slate-400 tracking-[0.2em] uppercase mb-1">æœˆ</div>
            <div id="mG" class="bazi-char"></div>
            <div id="mZ" class="text-sm text-slate-300"></div>
          </div>
          <div class="py-3 rounded-xl bg-slate-900/70 border border-amber-400/60">
            <div class="text-[10px] text-amber-300 tracking-[0.2em] uppercase mb-1">æ—¥</div>
            <div id="dG" class="bazi-char text-amber-300"></div>
            <div id="dZ" class="text-sm text-amber-100"></div>
          </div>
          <div class="py-3 rounded-xl bg-slate-900/70">
            <div class="text-[10px] text-slate-400 tracking-[0.2em] uppercase mb-1">æ™‚</div>
            <div id="hG" class="bazi-char"></div>
            <div id="hZ" class="text-sm text-slate-300"></div>
          </div>
        </div>

        <!-- äº”è¡Œ -->
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-5">
          <div>
            <div class="wx-row-label mb-1">è¡¨å±¤èƒ½é‡ï¼ˆå¤©å¹²è¨ˆæ•¸ï¼‰</div>
            <div id="surfaceWx" class="space-y-2"></div>
          </div>
          <div>
            <div class="wx-row-label mb-1">å¯¦æˆ°èƒ½é‡ï¼ˆå¤©å¹²ï¼‹è—å¹²ï¼‹æœˆä»¤åŠ æ¬Šï¼‰</div>
            <div id="strategicWx" class="space-y-2"></div>
          </div>
        </div>
      </section>

      <!-- ç´«å¾®å‘½ç›¤ 12 å®® -->
      <section class="glass p-6 md:p-7 space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">
            03. ç´«å¾®å‘½ç›¤ Â· 12 å®®ç¸½è¦½
          </h2>
          <span class="text-[11px] text-slate-400">
            å‘½ Â· å®˜ Â· è²¡ ç‚ºä¸»æˆ°å ´
          </span>
        </div>
        <p class="text-[11px] text-slate-400 mb-2">
          å‘½ç›¤ä»¥ã€Œå‘½å®®ï¼å®˜ç¥¿å®®ï¼è²¡å¸›å®®ã€ç‚ºä¸»è»¸ï¼Œç”¨ä¸»æ˜Ÿï¼‹äº”è¡Œç™¼å…‰æ¨™å‡ºä½ çš„ä¸»æˆ°å ´ã€‚
        </p>

        <div id="ziweiGrid" class="zw-grid-container">
          <!-- ç”± JS renderZiwei() æ³¨å…¥ -->
        </div>

        <div id="ziweiMeta" class="text-[11px] text-slate-400 mt-3"></div>
      </section>

      <!-- æµæœˆ -->
      <section class="glass p-6 md:p-7 space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">
            04. 2026 ç¯€æ°£æµæœˆç¯€å¥ï¼ˆä¸‰è‰²ç‡ˆï¼‰
          </h2>
          <span class="text-[11px] text-slate-400">
            ç´…ç‡ˆå…ˆå®ˆä½ï¼Œç¶ ç‡ˆå†åŠ é€Ÿ
          </span>
        </div>
        <p class="text-[11px] text-slate-500">
          æ¡ç¯€æ°£æœˆå€é–“ï¼ˆå¦‚ 02.04â€“03.05ï¼‰ï¼Œç”¨ç´…ï¼ç¶ æ¨™ç¤ºå£“åŠ›æœˆèˆ‡ç©©é€²æœˆã€‚
        </p>
        <div id="monthGrid" class="space-y-2"></div>
      </section>

      <!-- æˆ°ç•¥è§£è®€ -->
      <section class="glass p-6 md:p-7 space-y-3">
        <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">
          05. æˆ°ç•¥è§£è®€ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        </h2>
        <div id="analysisBox" class="text-sm text-slate-200 space-y-2"></div>
      </section>

      <!-- è«®è©¢ CTA -->
      <section class="glass p-6 md:p-7 space-y-3 border border-amber-400/60">
        <h2 class="text-base md:text-lg font-black text-amber-300">
          æƒ³è¦ä¸€ä»½å¯ä¿ç”¨ä¸€ç”Ÿçš„ã€Œäººç”Ÿä½¿ç”¨èªªæ˜æ›¸ã€ï¼Ÿ
        </h2>
        <p class="text-sm text-slate-200 leading-relaxed">
          å¦‚æœä½ å¸Œæœ›æˆ‘æŠŠä½ çš„å‘½æ ¼çµ„æˆã€äººç”Ÿå¤§é‹ã€æµå¹´æµæœˆã€ç”Ÿæ¶¯è¦åŠƒå’Œæœ€é©åˆè‡ªå·±çš„äººç”Ÿç¯€å¥åšæˆå¯ä¿ç”¨ä¸€ç”Ÿçš„ 50 é äººç”Ÿä½¿ç”¨èªªæ˜æ›¸ï¼Œæ­¡è¿é ç´„ç·šä¸Šè«®è©¢ã€‚
        </p>
        <a
          href="https://forms.gle/UVCSq1udEC549gzYA"
          target="_blank"
          class="inline-flex items-center justify-center mt-2 px-4 py-3 rounded-xl bg-gradient-to-r from-amber-400 to-yellow-500 text-slate-900 font-black text-sm shadow-lg active:scale-[0.98] transition"
        >
          å‰å¾€é ç´„ç·šä¸Šè«®è©¢
        </a>
      </section>

    </section>
  </main>

  <script>
    /* ========= åŸºæœ¬è¨­å®š ========= */
    const API_BASE = "https://17gonplay-api.billeetw.workers.dev";

    /* ========= äº”è¡Œ bar ========= */
    function renderBar(id, data, max) {
      const box = document.getElementById(id);
      if (!box) return;
      box.innerHTML = "";
      ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => {
        const v = Number(data?.[e] || 0);
        const w = max ? Math.max(2, (v / max) * 100) : 0;
        box.innerHTML += `
          <div class="mb-1">
            <div class="flex justify-between text-[11px] text-slate-300">
              <span>${e}</span>
              <span>${v.toFixed(1)}</span>
            </div>
            <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
              <div class="h-full wuxing-${e}" style="width:${w}%"></div>
            </div>
          </div>
        `;
      });
    }

    /* ========= ç´«å¾®æ–¹ç›¤æ¸²æŸ“ (å«äº”è¡Œèƒ½é‡) ========= */
    const PALACE_ORDER = ["å‘½å®®","å…„å¼Ÿ","å¤«å¦»","å­å¥³","è²¡å¸›","ç–¾å„","é·ç§»","åƒ•å½¹","å®˜ç¥¿","ç”°å®…","ç¦å¾·","çˆ¶æ¯"];

    const gridAreas = [
      "1/1/2/2","1/2/2/3","1/3/2/4","1/4/2/5", // ä¸Šæ’ 4 æ ¼
      "2/4/3/5","3/4/4/5","4/4/5/5",          // å³å´ 3 æ ¼
      "4/3/5/4","4/2/5/3","4/1/5/2",          // ä¸‹æ’ 3 æ ¼
      "3/1/4/2","2/1/3/2"                     // å·¦å´ 2 æ ¼
    ];

    // 14 ä¸»æ˜Ÿäº”è¡Œå°ç…§è¡¨ï¼ˆè¦–è¦ºç”¨ï¼‰
    const STAR_WUXING_MAP = {
      "ç´«å¾®": "åœŸ", "å¤©æ©Ÿ": "æœ¨", "å¤ªé™½": "ç«", "æ­¦æ›²": "é‡‘", "å¤©åŒ": "æ°´",
      "å»‰è²": "ç«", "å¤©åºœ": "åœŸ", "å¤ªé™°": "æ°´", "è²ªç‹¼": "æœ¨",
      "å·¨é–€": "æ°´", "å¤©ç›¸": "æ°´", "å¤©æ¢": "åœŸ", "ä¸ƒæ®º": "é‡‘", "ç ´è»": "æ°´"
    };

    function renderZiwei(ziwei) {
      const container = document.getElementById("ziweiGrid");
      const meta = document.getElementById("ziweiMeta");
      if (!container || !meta) return;

      // åªè¦æ²’æœ‰ ziwei ç‰©ä»¶ï¼Œå°±é¡¯ç¤º fallback æ–‡æ¡ˆ
      if (!ziwei) {
        container.className = "zw-grid-container";
        container.innerHTML = `
          <div class="text-xs text-slate-400 italic col-span-4 flex items-center justify-center">
            ï¼ˆç›®å‰å°šæœªå–å¾—ç´«å¾®è³‡æ–™ï¼Œä¹‹å¾Œå¯æ¥ iztro å®Œæ•´å‘½ç›¤ï¼‰
          </div>
        `;
        meta.innerText = "";
        return;
      }

      container.className = "zw-grid-container";
      container.innerHTML = "";

      const mainStarsData = ziwei.mainStars || {};

      PALACE_ORDER.forEach((name, idx) => {
        const starsList = mainStarsData[name] || [];
        const isKey = ["å‘½å®®", "å®˜ç¥¿", "è²¡å¸›"].includes(name);

        let starsHtml = "";
        let palaceMainElement = "";

        if (starsList.length > 0) {
          starsHtml = starsList.map((starName, i) => {
            const wx = STAR_WUXING_MAP[starName] || "";
            if (i === 0 && wx) palaceMainElement = wx;
            return `<span class="${wx ? 'star-wx-' + wx : ''}">${starName}</span>`;
          }).join("<br>");
        } else {
          starsHtml = '<span class="text-slate-600 text-xs italic font-normal">ç©ºå®®</span>';
        }

        const glowClass = palaceMainElement ? `palace-glow-${palaceMainElement}` : "";

        container.innerHTML += `
          <div class="zw-palace ${isKey ? 'zw-palace-key' : ''} ${glowClass}"
               style="grid-area:${gridAreas[idx]}">
            <div class="text-[10px] font-bold text-slate-500 mb-1">${name}</div>
            <div class="text-[13px] font-black leading-snug tracking-wide">
              ${starsHtml}
            </div>
          </div>
        `;
      });

      container.innerHTML += `
        <div class="zw-center-block">
          <div class="zw-center-block-badge mb-1">DESTINY CORE</div>
          <div class="text-amber-400 font-black text-xl tracking-widest mb-1">
            ${ziwei.core?.minggong || "â€”"}
          </div>
          <div class="text-[11px] text-slate-300 mt-1">
            èº«å®®ï¼š${ziwei.core?.shengong || "â€”"}
          </div>
          <div class="text-[11px] text-slate-300 mt-1">
            ${ziwei.core?.wuxingju || "â€”"}å±€
          </div>
        </div>
      `;

      meta.innerHTML = `
        å‘½å®®ï¼š${ziwei.core?.minggong || "â€”"} ï½œ èº«å®®ï¼š${ziwei.core?.shengong || "â€”"} ï½œ äº”è¡Œå±€ï¼š${ziwei.core?.wuxingju || "â€”"}å±€
      `;
    }

    /* ========= ä¸»æµç¨‹ï¼šåªæ‰“ /compute/all ========= */
    async function calculate() {
      const vy   = parseInt(document.getElementById("birthYear")?.value, 10);
      const vm   = parseInt(document.getElementById("birthMonth")?.value, 10);
      const vd   = parseInt(document.getElementById("birthDay")?.value, 10);
      const vh   = parseInt(document.getElementById("birthHour")?.value, 10);
      const vmin = parseInt(document.getElementById("birthMinute")?.value, 10);

      try {
        if (![vy, vm, vd, vh, vmin].every(n => Number.isFinite(n))) {
          throw new Error("è«‹å…ˆé¸å¥½å‡ºç”Ÿå¹´æœˆæ—¥èˆ‡æ™‚é–“");
        }

        const hint = document.getElementById("hint");
        if (hint) hint.innerText = "è¨ˆç®—ä¸­â€¦ï¼ˆç´„ 1â€“2 ç§’ï¼‰";

        const resp = await fetch(`${API_BASE}/compute/all`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ year: vy, month: vm, day: vd, hour: vh, minute: vmin }),
        });

        if (!resp.ok) {
          const txt = await resp.text().catch(() => "");
          throw new Error(`API HTTP ${resp.status} ${txt || ""}`.trim());
        }

        const payload = await resp.json();

        // debug ç”¨
        window.__payload = payload;
        window.__contract = payload?.features;

        if (!payload?.ok) throw new Error(payload?.error || "API error");

        const contract = payload.features;
        const bazi = contract?.bazi;
        const ziwei = contract?.ziwei;

        if (!bazi) {
          throw new Error("contract.bazi ä¸å­˜åœ¨ï¼ˆå¾Œç«¯ /compute/all æ‡‰è©²æœƒå¸¶ baziï¼‰");
        }

        // --- å…«å­—ï¼šå››æŸ± & æ—¥ä¸» ---
        const disp = bazi.display || {};
        document.getElementById("yG").innerText = disp.yG || "";
        document.getElementById("yZ").innerText = disp.yZ || "";
        document.getElementById("mG").innerText = disp.mG || "";
        document.getElementById("mZ").innerText = disp.mZ || "";
        document.getElementById("dG").innerText = disp.dG || "";
        document.getElementById("dZ").innerText = disp.dZ || "";
        document.getElementById("hG").innerText = disp.hG || "";
        document.getElementById("hZ").innerText = disp.hZ || "";

        const dmElement = bazi.dmElement || "â€”";
        const dmTag = document.getElementById("baziDmTag");
        if (dmTag) dmTag.innerText = `æ—¥ä¸»ï¼š${dmElement}`;

        // --- äº”è¡Œ bars ---
        if (!bazi.wuxing?.surface || !bazi.wuxing?.strategic) {
          throw new Error("bazi.wuxing ç¼ºè³‡æ–™");
        }
        renderBar("surfaceWx",   bazi.wuxing.surface,   4);
        renderBar("strategicWx", bazi.wuxing.strategic, bazi.wuxing.maxStrategic || 1);

        // --- æµæœˆ ---
        const bounds = bazi.liuyue2026?.bounds || [];
        const monthGrid = document.getElementById("monthGrid");
        monthGrid.innerHTML = "";
        const redMonths = [];

        if (bounds.length) {
          bounds.forEach(b => {
            const isRed = b.light === "RED";
            if (isRed) redMonths.push(b.gz);
            monthGrid.innerHTML += `
              <div class="p-3 rounded-xl border-l-4 ${isRed ? "border-red-500 bg-red-500/10" : "border-emerald-500 bg-emerald-500/10"}">
                <div class="font-bold text-sm">
                  ${b.gz}
                  <span class="text-[11px] text-slate-400 ml-1">${b.range || ""}</span>
                </div>
                <div class="text-[11px] text-slate-300 mt-1">
                  ${isRed ? "ğŸ”´ å£“åŠ›æœˆ" : "ğŸŸ¢ ç©©é€²æœˆ"} ï½œ æœ¬æ°£ï¼š${b.ssBranch || ""}
                </div>
              </div>
            `;
          });
        } else {
          monthGrid.innerHTML = `<div class="text-xs text-slate-400 italic">ï¼ˆæš«ç„¡æµæœˆè³‡æ–™ï¼‰</div>`;
        }

        // --- æˆ°ç•¥è§£è®€ï¼ˆç°¡æ˜“ç‰ˆ fallbackï¼‰ ---
        const dominant = (bazi.tenGod?.dominant || "").trim() || "æœªå®š";
        const analysisBox = document.getElementById("analysisBox");

        const redText = redMonths.length
          ? `å£“åŠ›æœˆï¼š${redMonths.join("ã€")}ï¼ˆé€™äº›æœˆè«‹å…ˆå®ˆè¦å‰‡ã€ä¸ç¡¬è¡ï¼Œå°ˆå¿ƒæ”¶æ–‚èˆ‡èª¿æ•´ç¯€å¥ï¼‰ã€‚`
          : "ä»Šå¹´å£“åŠ›æœˆåå°‘ï¼Œå¯ä»¥æŠŠæ›´å¤šè³‡æºæ”¾åœ¨ç©©å®šæ¨é€²èˆ‡æ“´å¼µä¸Šã€‚";

        analysisBox.innerHTML = `
          <p>ä½ çš„æ—¥ä¸»äº”è¡Œä¸»å ´æ˜¯ã€Œ${dmElement}ã€ï¼Œ2026 å¹´åº¦ä¸»è»¸åå‘ã€Œ${dominant}ã€ã€‚</p>
          <p>${redText}</p>
          <p>æ•´é«”ç­–ç•¥ï¼šæŠŠã€ŒåŒæ™‚åœ¨åšçš„äº‹æƒ…ã€è®Šå°‘ï¼ŒæŠŠã€Œå›ºå®šæ¯é€±è¦åšçš„ç¯€å¥ã€è®Šæ¸…æ¥šï¼Œå£“åŠ›æœˆå„ªå…ˆå®ˆä½ç¾æœ‰ç›¤é¢ï¼Œç©©å®šæœˆå†å¾€å¤–æ‰“ä»—ã€‚</p>
          <p class="text-[11px] text-slate-400 mt-2">
            ï¼ˆä¹‹å¾Œå¯ä»¥å†æŠŠé€™æ®µæ”¹æˆ /render/report çš„å®Œæ•´ AI æ•˜äº‹ç‰ˆï¼‰
          </p>
        `;

        // --- ç´«å¾®å‘½ç›¤æ¸²æŸ“ ---
        // å¦‚æœå¾Œç«¯é‚„æ²’æ¥å¥½ï¼Œå¯ä»¥åœ¨é€™è£¡æš«æ™‚å¡ä¸€ä»½ demoï¼Œç¾åœ¨å…ˆç›´æ¥åƒ contract.ziwei
        renderZiwei(ziwei);

        // é¡¯ç¤ºå ±å‘Šå€
        document.getElementById("report").classList.remove("hidden");
        if (hint) hint.innerText = "";
        document.getElementById("report").scrollIntoView({ behavior:"smooth", block:"start" });

      } catch (e) {
        console.error(e);
        alert("è¨ˆç®—å¤±æ•—ï¼š" + (e?.message || e));
        const hint = document.getElementById("hint");
        if (hint) hint.innerText = "";
      }
    }

    /* ========= æ—¥æœŸé¸å–® ========= */
    function initSelectors() {
      const y   = document.getElementById("birthYear");
      const m   = document.getElementById("birthMonth");
      const d   = document.getElementById("birthDay");
      const h   = document.getElementById("birthHour");
      const min = document.getElementById("birthMinute");
      if (!y || !m || !d || !h || !min) return;

      for (let i = 2026; i >= 1940; i--) {
        y.add(new Option(i + " å¹´", i));
      }
      for (let i = 1; i <= 12; i++) {
        m.add(new Option(i + " æœˆ", i));
      }
      for (let i = 0; i < 24; i++) {
        const label = String(i).padStart(2,"0") + " æ™‚";
        h.add(new Option(label, i));
      }
      ["00","15","30","45"].forEach(v => {
        min.add(new Option(v + " åˆ†", v));
      });

      y.value   = "1990";
      m.value   = "1";
      h.value   = "12";
      min.value = "00";

      updateDays();
    }

    function updateDays() {
      const y = document.getElementById("birthYear");
      const m = document.getElementById("birthMonth");
      const d = document.getElementById("birthDay");
      if (!y || !m || !d) return;

      const year  = parseInt(y.value, 10);
      const month = parseInt(m.value, 10);
      const current = d.value;

      d.innerHTML = "";
      const days = new Date(year, month, 0).getDate();
      for (let i = 1; i <= days; i++) {
        const opt = new Option(i + " æ—¥", i);
        if (String(i) === String(current) || (!current && i === 1)) opt.selected = true;
        d.add(opt);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      initSelectors();
      const y = document.getElementById("birthYear");
      const m = document.getElementById("birthMonth");
      if (y && m) {
        y.addEventListener("change", updateDays);
        m.addEventListener("change", updateDays);
      }
      const btn = document.getElementById("btnLaunch");
      if (btn) btn.addEventListener("click", calculate);
    });
  </script>
</body>
</html>
