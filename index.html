<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2026 æˆ°ç•¥å°èˆªï½œä¸€èµ·å‡ºä¾†ç©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/iztro/dist/index.min.js"></script>

  <style>
    body { background:#0b0e14; color:#e2e8f0; font-family: system-ui,-apple-system; }
    .glass { background: rgba(255,255,255,.04); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,.08); }
    .bazi-char { font-size:1.8rem; font-weight:900; line-height:1.1; }
    .wuxing-æœ¨{background:#2ecc71}.wuxing-ç«{background:#e74c3c}
    .wuxing-åœŸ{background:#f1c40f}.wuxing-é‡‘{background:#ced4da}
    .wuxing-æ°´{background:#3498db}

    /* ===== ç´«å¾® 12 å®®æ ¼èˆ‡è¦–è¦ºç‰¹æ•ˆ ===== */
    .zw-grid-container{
      display:grid; grid-template-columns:repeat(4,1fr); grid-template-rows:repeat(4,1fr);
      gap:8px; width:100%; max-width:520px; aspect-ratio:1/1; margin:0 auto;
    }
    .zw-palace{
      background: rgba(15,23,42,0.8); border: 1px solid rgba(148,163,184,0.18);
      border-radius: 14px; padding: 8px; position: relative; overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .zw-palace:hover { transform: translateY(-2px); border-color: rgba(248,250,252,0.8); box-shadow: 0 10px 30px rgba(15,23,42,0.7); }
    .zw-palace-key{ border-color: rgba(251,191,36,0.55); box-shadow: inset 0 0 18px rgba(251,191,36,0.08); }
    
    .zw-center-block{
      grid-area: 2 / 2 / 4 / 4; background: radial-gradient(circle, rgba(30,41,59,0.85) 10%, rgba(2,6,23,0.95) 70%);
      border: 1px dashed rgba(148,163,184,0.35); border-radius: 18px;
      display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding: 10px;
    }
    .zw-center-block-badge { font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase; color: #64748b; }

    /* æ˜Ÿæ›œé¡è‰² */
    .star-wx-æœ¨{ color:#86efac; text-shadow:0 0 5px rgba(34,197,94,0.45); }
    .star-wx-ç«{ color:#fca5a5; text-shadow:0 0 5px rgba(239,68,68,0.45); }
    .star-wx-åœŸ{ color:#fde047; text-shadow:0 0 5px rgba(234,179,8,0.45); }
    .star-wx-é‡‘{ color:#e2e8f0; text-shadow:0 0 5px rgba(255,255,255,0.35); }
    .star-wx-æ°´{ color:#93c5fd; text-shadow:0 0 5px rgba(59,130,246,0.45); }

    /* äº”è¡Œç™¼å…‰ç‰¹æ•ˆ */
    .zw-palace::before{ content:""; position:absolute; inset:-25%; opacity:0; transition:opacity .3s ease; pointer-events:none; z-index: -1; }
    [class*="palace-glow-"]::before{ opacity:1; }
    .palace-glow-æœ¨::before{ background: radial-gradient(circle, rgba(34,197,94,0.14) 0%, transparent 62%); }
    .palace-glow-ç«::before{ background: radial-gradient(circle, rgba(239,68,68,0.14) 0%, transparent 62%); }
    .palace-glow-åœŸ::before{ background: radial-gradient(circle, rgba(234,179,8,0.14) 0%, transparent 62%); }
    .palace-glow-é‡‘::before{ background: radial-gradient(circle, rgba(255,255,255,0.10) 0%, transparent 62%); }
    .palace-glow-æ°´::before{ background: radial-gradient(circle, rgba(59,130,246,0.14) 0%, transparent 62%); }

    .nav-bar { background: linear-gradient(90deg, #ef4444, #f97316, #ef4444); color: #fff; padding: 10px 16px; position: sticky; top: 0; z-index: 40; box-shadow: 0 4px 20px rgba(220,38,38,0.6); }
    .wx-row-label { font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase; color: #94a3b8; }
  </style>
</head>

<body class="pb-16">
  <div class="nav-bar flex items-center justify-between">
    <div class="text-xs md:text-sm font-bold tracking-[0.25em] uppercase">ä¸€èµ·å‡ºä¾†ç© Â· 2026 æˆ°ç•¥å°èˆª</div>
    <div class="flex gap-2">
      <button class="text-[10px] bg-white/10 px-2 py-1 rounded" onclick="go('#sec-bazi')">å››æŸ±</button>
      <button class="text-[10px] bg-white/10 px-2 py-1 rounded" onclick="go('#sec-ziwei')">ç´«å¾®</button>
      <a href="https://www.youtube.com/@billeetw1" target="_blank" class="text-[11px] bg-white text-red-600 font-black px-3 py-1 rounded-full">è¨‚é–±æœ€æ–°æˆ°ç•¥ ğŸ””</a>
    </div>
  </div>

  <main class="max-w-5xl mx-auto px-4 pt-6 space-y-8">
    <section class="text-center space-y-2">
      <h1 class="text-3xl md:text-4xl font-black tracking-tight">2026 æµå¹´æˆ°ç•¥å ±å‘Š</h1>
      <p class="text-xs text-slate-400 tracking-[0.25em] uppercase">BAZI Ã— ç´«å¾® Ã— æµæœˆç¯€å¥</p>
    </section>

    <section class="glass p-6 md:p-7 space-y-4 max-w-xl mx-auto">
      <h2 class="text-sm font-black text-slate-200 tracking-[0.28em] uppercase mb-1">01. è¼¸å…¥ä½ çš„å‡ºç”Ÿæ™‚é–“</h2>
      <div class="grid grid-cols-3 gap-2 mb-3">
        <select id="birthYear" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
        <select id="birthMonth" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
        <select id="birthDay" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
      </div>
      <div class="grid grid-cols-2 gap-2 mb-4">
        <select id="birthHour" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
        <select id="birthMinute" class="bg-black/40 p-2 rounded border border-slate-700 text-sm"></select>
      </div>
      <button id="btnLaunch" class="w-full bg-gradient-to-r from-amber-400 to-amber-500 text-black py-3.5 rounded-xl font-black uppercase shadow-lg">ç”Ÿæˆæˆ‘çš„ 2026 æˆ°ç•¥</button>
      <p id="hint" class="text-[11px] text-slate-400 mt-3 italic text-center"></p>
    </section>

    <section id="report" class="hidden space-y-8">
      <section id="sec-bazi" class="glass p-6 md:p-7 space-y-5">
        <div class="flex items-center justify-between mb-1">
          <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">02. æ²³åœ–æ™‚ç©ºåº§æ¨™</h2>
          <span id="baziDmTag" class="text-[11px] px-2 py-1 rounded-full border border-amber-400/70 text-amber-300 font-bold">æ—¥ä¸»ï¼šâ€”</span>
        </div>
        <div class="grid grid-cols-4 gap-2 text-center">
          <div class="py-3 rounded-xl bg-slate-900/70">
            <div id="yG" class="bazi-char"></div><div id="yZ" class="text-sm text-slate-300"></div>
          </div>
          <div class="py-3 rounded-xl bg-slate-900/70">
            <div id="mG" class="bazi-char"></div><div id="mZ" class="text-sm text-slate-300"></div>
          </div>
          <div class="py-3 rounded-xl bg-slate-900/70 border border-amber-400/60">
            <div id="dG" class="bazi-char text-amber-300"></div><div id="dZ" class="text-sm text-amber-100"></div>
          </div>
          <div class="py-3 rounded-xl bg-slate-900/70">
            <div id="hG" class="bazi-char"></div><div id="hZ" class="text-sm text-slate-300"></div>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div id="surfaceWx" class="space-y-2"></div>
          <div id="strategicWx" class="space-y-2"></div>
        </div>
      </section>

      <section id="sec-ziwei" class="glass p-6 md:p-7 space-y-4">
        <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">03. ç´«å¾®å‘½ç›¤ Â· 12 å®®ç¸½è¦½</h2>
        <div id="ziweiGrid" class="zw-grid-container"></div>
        <div id="ziweiHint" class="text-[11px] text-slate-400 mt-3 italic text-center"></div>
      </section>

      <section id="sec-liuyue" class="glass p-6 md:p-7 space-y-4">
        <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">04. 2026 ç¯€æ°£æµæœˆç¯€å¥</h2>
        <div id="monthGrid" class="space-y-2"></div>
      </section>

      <section id="sec-analysis" class="glass p-6 md:p-7 space-y-3">
        <h2 class="text-sm font-black tracking-[0.3em] uppercase text-slate-200">05. æˆ°ç•¥è§£è®€</h2>
        <div id="analysisBox" class="text-sm text-slate-200 space-y-2"></div>
      </section>

      <section class="glass p-6 md:p-7 space-y-3 border border-amber-400/60">
        <h2 class="text-base md:text-lg font-black text-amber-300">æƒ³è¦ä¸€ä»½å¯ä¿ç”¨ä¸€ç”Ÿçš„ã€Œäººç”Ÿä½¿ç”¨èªªæ˜æ›¸ã€ï¼Ÿ</h2>
        <p class="text-sm text-slate-200 leading-relaxed">æä¾› 50 é çš„äººç”Ÿæˆ°ç•¥å ±å‘Šï¼Œæ­¡è¿é ç´„ç·šä¸Šè«®è©¢ã€‚</p>
        <a href="https://forms.gle/UVCSq1udEC549gzYA" target="_blank" class="inline-flex px-4 py-3 rounded-xl bg-amber-400 text-slate-900 font-black text-sm">å‰å¾€é ç´„ç·šä¸Šè«®è©¢</a>
      </section>
    </section>
  </main>

  <script>
    const API_BASE = "https://17gonplay-api.billeetw.workers.dev";
    function go(sel){ document.querySelector(sel)?.scrollIntoView({behavior:"smooth", block:"start"}); }

    function renderBar(id, data, max) {
      const box = document.getElementById(id);
      if (!box) return;
      box.innerHTML = `<div class="wx-row-label mb-1">${id==='surfaceWx'?'è¡¨å±¤èƒ½é‡':'å¯¦æˆ°èƒ½é‡'}</div>`;
      ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => {
        const v = Number(data?.[e] || 0);
        const w = max ? Math.max(2, (v / max) * 100) : 0;
        box.innerHTML += `
          <div class="mb-1">
            <div class="flex justify-between text-[11px]"><span>${e}</span><span>${v.toFixed(1)}</span></div>
            <div class="h-1.5 bg-slate-800 rounded-full overflow-hidden">
              <div class="h-full wuxing-${e}" style="width:${w}%"></div>
            </div>
          </div>`;
      });
    }

    const PALACE_ORDER = ["å‘½å®®","å…„å¼Ÿ","å¤«å¦»","å­å¥³","è²¡å¸›","ç–¾å„","é·ç§»","åƒ•å½¹","å®˜ç¥¿","ç”°å®…","ç¦å¾·","çˆ¶æ¯"];
    const gridAreas = ["1/1/2/2","1/2/2/3","1/3/2/4","1/4/2/5","2/4/3/5","3/4/4/5","4/4/5/5","4/3/5/4","4/2/5/3","4/1/5/2","3/1/4/2","2/1/3/2"];
    const STAR_WUXING_MAP = {"ç´«å¾®":"åœŸ","å¤©æ©Ÿ":"æœ¨","å¤ªé™½":"ç«","æ­¦æ›²":"é‡‘","å¤©åŒ":"æ°´","å»‰è²":"ç«","å¤©åºœ":"åœŸ","å¤ªé™°":"æ°´","è²ªç‹¼":"æœ¨","å·¨é–€":"æ°´","å¤©ç›¸":"æ°´","å¤©æ¢":"åœŸ","ä¸ƒæ®º":"é‡‘","ç ´è»":"æ°´"};

    function mapMainStarsToCN(mainStars){
      if (!mainStars) return {};
      if (mainStars["å‘½å®®"] || mainStars["å®˜ç¥¿"] || mainStars["è²¡å¸›"]) return mainStars;
      const out = {};
      if (Array.isArray(mainStars.minggong)) out["å‘½å®®"] = mainStars.minggong;
      if (Array.isArray(mainStars.career)) out["å®˜ç¥¿"] = mainStars.career;
      if (Array.isArray(mainStars.wealth)) out["è²¡å¸›"] = mainStars.wealth;
      return out;
    }

    function renderZiwei(ziwei) {
      const container = document.getElementById("ziweiGrid");
      const hint = document.getElementById("ziweiHint");
      if (!container) return;
      if (!ziwei) {
        container.innerHTML = `<div class="text-xs text-slate-500 italic col-span-4 flex items-center justify-center">ï¼ˆå°šæœªå–å¾—ç´«å¾®è³‡æ–™ï¼‰</div>`;
        return;
      }
      container.innerHTML = "";
      const mainStarsCN = mapMainStarsToCN(ziwei.mainStars);
      PALACE_ORDER.forEach((name, idx) => {
        const stars = mainStarsCN[name] || [];
        const isKey = ["å‘½å®®","å®˜ç¥¿","è²¡å¸›"].includes(name);
        let palaceMainElement = "";
        let starsHtml = stars.length ? stars.map((s, i) => {
          const wx = STAR_WUXING_MAP[s] || "";
          if (i === 0) palaceMainElement = wx;
          return `<span class="star-wx-${wx}">${s}</span>`;
        }).join("<br>") : '<span class="text-slate-600 italic">ç©ºå®®</span>';
        
        container.innerHTML += `<div class="zw-palace ${isKey?'zw-palace-key':''} palace-glow-${palaceMainElement}" style="grid-area:${gridAreas[idx]}">
          <div class="text-[9px] font-bold text-slate-500 mb-1">${name}</div>
          <div class="text-[12px] font-black leading-tight">${starsHtml}</div>
        </div>`;
      });
      container.innerHTML += `<div class="zw-center-block">
        <div class="zw-center-block-badge mb-1">DESTINY CORE</div>
        <div class="text-amber-400 font-black text-xl">${ziwei.core?.minggong || "â€”"}</div>
        <div class="text-[10px] text-slate-300 mt-1">èº«ï¼š${ziwei.core?.shengong || "â€”"}</div>
        <div class="text-[10px] text-slate-300">${ziwei.core?.wuxingju || "â€”"}å±€</div>
      </div>`;
    }

    function buildZiweiFeaturesLocal(vy, vm, vd, vh, vmin) {
      // é ç•™ä½ç½®çµ¦æœ¬åœ° iztro è¨ˆç®—
      return undefined; 
    }

    async function calculate() {
      const vy=parseInt(document.getElementById("birthYear").value), vm=parseInt(document.getElementById("birthMonth").value);
      const vd=parseInt(document.getElementById("birthDay").value), vh=parseInt(document.getElementById("birthHour").value), vmin=parseInt(document.getElementById("birthMinute").value);
      const hint = document.getElementById("hint");
      try {
        hint.innerText = "æˆ°ç•¥åˆ†æä¸­...";
        const ziweiLocal = buildZiweiFeaturesLocal(vy, vm, vd, vh, vmin);
        const resp = await fetch(`${API_BASE}/compute/all`, {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ year: vy, month: vm, day: vd, hour: vh, minute: vmin, ziwei: ziweiLocal })
        });
        const payload = await resp.json();
        if (!payload.ok) throw new Error(payload.error);
        const { bazi, ziwei } = payload.features;

        document.getElementById("yG").innerText = bazi.display.yG; document.getElementById("yZ").innerText = bazi.display.yZ;
        document.getElementById("mG").innerText = bazi.display.mG; document.getElementById("mZ").innerText = bazi.display.mZ;
        document.getElementById("dG").innerText = bazi.display.dG; document.getElementById("dZ").innerText = bazi.display.dZ;
        document.getElementById("hG").innerText = bazi.display.hG; document.getElementById("hZ").innerText = bazi.display.hZ;
        document.getElementById("baziDmTag").innerText = `æ—¥ä¸»ï¼š${bazi.dmElement}`;

        renderBar("surfaceWx", bazi.wuxing.surface, 4);
        renderBar("strategicWx", bazi.wuxing.strategic, bazi.wuxing.maxStrategic);
        renderZiwei(ziwei || ziweiLocal);

        const monthGrid = document.getElementById("monthGrid");
        monthGrid.innerHTML = "";
        const redMonths = [];
        bazi.liuyue2026.bounds.forEach(b => {
          if (b.light === "RED") redMonths.push(b.gz);
          monthGrid.innerHTML += `<div class="p-3 rounded-xl border-l-4 ${b.light==='RED'?'border-red-500 bg-red-500/10':'border-emerald-500 bg-emerald-500/10'}">
            <div class="font-bold text-sm">${b.gz} <span class="text-[11px] text-slate-400 ml-1">${b.range}</span></div>
            <div class="text-[11px] text-slate-300 mt-1">${b.light==='RED'?"ğŸ”´ å£“åŠ›æœˆ":"ğŸŸ¢ ç©©é€²æœˆ"} ï½œ æœ¬æ°£ï¼š${b.ssBranch}</div>
          </div>`;
        });

        document.getElementById("analysisBox").innerHTML = `<p>æ—¥ä¸»äº”è¡Œï¼šã€Œ${bazi.dmElement}ã€ï¼Œå¹´åº¦ä¸»è»¸ï¼šã€Œ${bazi.tenGod.dominant}ã€ã€‚</p><p>${redMonths.length ? 'å£“åŠ›æœˆï¼š' + redMonths.join('ã€') : 'ä»Šå¹´ç„¡æ˜é¡¯å£“åŠ›æœˆã€‚'}</p>`;
        document.getElementById("report").classList.remove("hidden");
        hint.innerText = "";
        document.getElementById("report").scrollIntoView({ behavior:"smooth" });
      } catch (e) { alert("è¨ˆç®—å¤±æ•—ï¼š" + e.message); hint.innerText = ""; }
    }

    function init() {
      const y=document.getElementById("birthYear"), m=document.getElementById("birthMonth"), d=document.getElementById("birthDay"), h=document.getElementById("birthHour"), min=document.getElementById("birthMinute");
      for(let i=2026; i>=1940; i--) y.add(new Option(i+" å¹´", i));
      for(let i=1; i<=12; i++) m.add(new Option(i+" æœˆ", i));
      for(let i=0; i<24; i++) h.add(new Option(String(i).padStart(2,"0")+" æ™‚", i));
      ["00","15","30","45"].forEach(v => min.add(new Option(v+" åˆ†", v)));
      y.value="1990"; m.value="1"; h.value="12"; min.value="00";
      
      const updateDays = () => {
        const year=parseInt(y.value), month=parseInt(m.value), cur=d.value;
        d.innerHTML="";
        const days = new Date(year, month, 0).getDate();
        for(let i=1; i<=days; i++) {
          const opt = new Option(i+" æ—¥", i);
          if(String(i)===cur) opt.selected=true;
          d.add(opt);
        }
      };
      y.onchange = m.onchange = updateDays;
      updateDays();
      document.getElementById("btnLaunch").onclick = calculate;
    }
    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
