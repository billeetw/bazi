<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="2026 æˆ°ç•¥å°èˆªï¼šç”Ÿå­˜æ¼”ç®—æ³•ï¼ˆå°ˆæ¥­æ ¡æº–æœ€çµ‚ç‰ˆï¼‰" />
  <meta property="og:description" content="é€™ä¸æ˜¯ç®—å‘½ï¼Œæ˜¯å¦³ 2026 çš„æˆ°ç•¥é…ç½®ã€‚è§£ç¢¼è—å¹²æ¬Šé‡ã€é›™æ¨™ç±¤å¹´åº¦æˆ°ç•¥èˆ‡å£“åŠ›é˜²ç·šï¼" />
  <title>2026 æˆ°ç•¥å°èˆª | ä¸€èµ·å‡ºä¾†ç© å°ˆæ¥­æ ¡æº–æœ€çµ‚ç‰ˆ</title>

  <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
    body { font-family: 'Noto Sans TC', sans-serif; background: #0b0e14; color: #e2e8f0; overflow-x: hidden; }
    .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
    .gold-text { background: linear-gradient(135deg, #d4af37 0%, #f3e5ab 50%, #aa8a2e 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .wuxing-æœ¨ { background: #2ecc71; box-shadow: 0 0 10px rgba(46, 204, 113, 0.2); }
    .wuxing-ç« { background: #e74c3c; box-shadow: 0 0 10px rgba(231, 76, 60, 0.2); }
    .wuxing-åœŸ { background: #f1c40f; box-shadow: 0 0 10px rgba(241, 196, 15, 0.2); }
    .wuxing-é‡‘ { background: #ced4da; box-shadow: 0 0 10px rgba(206, 212, 218, 0.2); }
    .wuxing-æ°´ { background: #3498db; box-shadow: 0 0 10px rgba(52, 152, 219, 0.2); }
    .bazi-char { font-size: 1.8rem; font-weight: 900; line-height: 1.1; }
    .shishen-tag { font-size: 10px; padding: 2px 4px; border-radius: 4px; background: rgba(255,255,255,0.08); color: #aaa; margin-top: 2px; }
    #loading { position: fixed; inset: 0; background: #0b0e14; z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; }
    .ring { width: 60px; height: 60px; border: 4px solid rgba(212,175,55,0.1); border-top: 4px solid #d4af37; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .archetype-badge { background: linear-gradient(45deg, #1e293b, #0f172a); border: 1px solid #d4af37; border-radius: 99px; padding: 6px 20px; font-weight: 900; font-size: 16px; display: inline-block; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2); }
    select {
      -webkit-appearance: none; appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1em; padding-right: 2rem !important;
    }
    @keyframes pulse-red { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
    .vibrant-bar { animation: pulse-red 2s infinite ease-in-out; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center p-0 pb-24 text-center">

  <div id="loading">
    <div class="ring mb-6"></div>
    <p class="gold-text font-black tracking-[0.3em] text-lg animate-pulse">æ­£åœ¨ç²¾ç®—æ²³åœ–æ´›æ›¸èˆ‡æ¬Šé‡èƒ½é‡...</p>
  </div>

  <!-- é ‚éƒ¨é†’ç›® Bar -->
  <div class="w-full bg-gradient-to-r from-red-600 via-orange-600 to-red-600 py-5 px-6 text-white sticky top-0 z-50 shadow-[0_4px_20px_rgba(220,38,38,0.5)] cursor-pointer hover:brightness-110 transition-all border-b border-white/20">
    <a href="https://www.youtube.com/@billeetw1" target="_blank" class="block w-full">
      <span class="text-base md:text-xl font-black tracking-tight vibrant-bar inline-block text-center mx-auto">
        ã€è·Ÿæä¼¯å½¥ä¸€èµ·å‡ºä¾†ç©ã€ 2026 ä½ çš„ç”Ÿå­˜æˆ°ç•¥ ğŸš€
        <span class="ml-2 bg-yellow-400 text-red-700 px-3 py-1 rounded-full text-xs md:text-sm font-black shadow-lg text-center inline-block">
          é»æ“Šè¨‚é–±éš¨æ™‚æ¥å—æ–°æƒ…å ±ï¼
        </span>
      </span>
    </a>
  </div>

  <div class="w-full max-w-xl mx-auto flex flex-col items-center p-4">
    <div class="my-8 px-4">
      <h1 class="text-3xl md:text-4xl font-black gold-text mb-3 tracking-tighter leading-tight text-center">
        ä¸€èµ·å‡ºä¾†ç©<br class="md:hidden" /> æ˜“ç¶“å››æŸ±æµå¹´æ·±åº¦è§£æ
      </h1>
      <p class="text-slate-500 text-xs tracking-[0.4em] font-bold uppercase italic text-center mx-auto">Advanced Metaphysical Algorithm</p>

      <div class="mt-6 flex items-center justify-center space-x-2 bg-slate-800/40 px-4 py-2 rounded-full border border-white/5 mx-auto w-fit">
        <span class="flex h-2 w-2 relative">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
          <span class="relative h-2 w-2 rounded-full bg-green-500"></span>
        </span>
        <p class="text-[11px] font-bold text-slate-400 tracking-wider">
          ç›®å‰å·²æœ‰ <span id="userCounter" class="text-amber-400 font-black text-sm mx-1">5,001</span> ä½é ˜å–æˆ°ç•¥å ±å‘Š
        </p>
      </div>
    </div>

    <!-- è¼¸å…¥æ¨¡çµ„ -->
    <div class="glass p-8 rounded-[2.5rem] shadow-2xl border-t-2 border-amber-500/20 mb-10 w-full">
      <div class="space-y-8">
        <div>
          <label class="block text-[11px] font-black text-slate-400 uppercase tracking-widest mb-4 text-center">é¸æ“‡æ‚¨çš„å‡ºç”Ÿæ—¥æœŸ (å…¬æ›†)</label>
          <div class="grid grid-cols-3 gap-3">
            <select id="birthYear" class="bg-slate-800/60 border border-slate-700 rounded-2xl px-3 py-4 text-white text-center text-sm focus:outline-none focus:border-amber-500 transition-all"></select>
            <select id="birthMonth" class="bg-slate-800/60 border border-slate-700 rounded-2xl px-3 py-4 text-white text-center text-sm focus:outline-none focus:border-amber-500 transition-all" onchange="updateDays()"></select>
            <select id="birthDay" class="bg-slate-800/60 border border-slate-700 rounded-2xl px-3 py-4 text-white text-center text-sm focus:outline-none focus:border-amber-500 transition-all"></select>
          </div>
        </div>

        <div>
          <label class="block text-[11px] font-black text-slate-400 uppercase tracking-widest mb-4 text-center">é¸æ“‡å‡ºç”Ÿæ™‚é–“</label>
          <div class="grid grid-cols-2 gap-3">
            <select id="birthHour" class="bg-slate-800/60 border border-slate-700 rounded-2xl px-3 py-4 text-white text-center text-sm focus:outline-none focus:border-amber-500"></select>
            <select id="birthMinute" class="bg-slate-800/60 border border-slate-700 rounded-2xl px-3 py-4 text-white text-center text-sm focus:outline-none focus:border-amber-500"></select>
          </div>
        </div>

        <button onclick="launch()" class="w-full bg-gradient-to-r from-amber-500 to-yellow-600 text-slate-900 font-black py-6 rounded-2xl text-lg md:text-xl shadow-[0_10px_30px_rgba(245,158,11,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all tracking-widest leading-tight uppercase">
          ç”Ÿæˆå°ˆå±¬æ–¼æˆ‘çš„ 2026 æµå¹´æˆ°ç•¥å ±å‘Š
        </button>
      </div>
    </div>

    <div id="report" class="hidden space-y-10 w-full animate-in fade-in slide-in-from-bottom-10 duration-1000 flex flex-col items-center">

      <div id="archetype" class="archetype-badge gold-text mb-2 tracking-tighter italic"></div>

      <!-- â¶ å‘½ç›¤ -->
      <div class="w-full">
        <h2 class="text-xs font-black text-slate-500 mb-6 tracking-[0.2em] uppercase text-center mx-auto">â¶ æ²³åœ–æ™‚ç©ºåº§æ¨™ (å››æŸ±å‘½ç›¤)</h2>
        <div class="grid grid-cols-4 gap-2 px-1">
          <div class="glass py-5 rounded-2xl flex flex-col items-center">
            <p class="text-[10px] text-slate-600 mb-2 font-bold uppercase">å¹´</p>
            <div id="yG" class="bazi-char"></div><div id="yZ" class="bazi-char"></div>
            <div id="ySG" class="shishen-tag"></div><div id="ySZ" class="shishen-tag opacity-40 italic text-[8px]"></div>
          </div>

          <div class="glass py-5 rounded-2xl flex flex-col items-center border border-white/5">
            <p class="text-[10px] text-slate-600 mb-2 font-bold uppercase">æœˆ</p>
            <div id="mG" class="bazi-char"></div><div id="mZ" class="bazi-char"></div>
            <div id="mSG" class="shishen-tag"></div><div id="mSZ" class="shishen-tag opacity-40 italic text-[8px]"></div>
          </div>

          <div class="glass py-5 rounded-2xl flex flex-col items-center border-2 border-amber-500/30 bg-amber-500/5">
            <p class="text-[10px] text-amber-500 mb-2 font-black uppercase tracking-tighter">æ—¥</p>
            <div id="dG" class="bazi-char text-amber-500"></div><div id="dZ" class="bazi-char text-amber-500"></div>
            <div class="shishen-tag text-amber-600 font-bold border-amber-900/50 uppercase">å‘½ä¸»</div>
          </div>

          <div class="glass py-5 rounded-2xl flex flex-col items-center">
            <p class="text-[10px] text-slate-600 mb-2 font-bold uppercase">æ™‚</p>
            <div id="hG" class="bazi-char text-slate-200"></div><div id="hZ" class="bazi-char text-slate-200"></div>
            <div id="hSG" class="shishen-tag"></div><div id="hSZ" class="shishen-tag opacity-40 italic text-[8px]"></div>
          </div>
        </div>
        <p class="text-[9px] text-slate-500 mt-3 italic text-right px-2 tracking-tight w-full">â€» åœ°æ”¯é¡¯ç¤ºæœ¬æ°£åç¥ä»¥ä¿æŒå¯è®€æ€§</p>
      </div>

      <!-- â· äº”è¡Œ -->
      <div class="glass p-8 rounded-[2.5rem] shadow-xl w-full">
        <h2 class="text-xs font-black gold-text mb-6 tracking-widest uppercase text-center mx-auto">â· äº”è¡Œèƒ½é‡æ·±åº¦æ¼”ç®—æ³•</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-left">
          <div>
            <p class="text-[10px] font-black text-slate-500 mb-4 uppercase flex items-center"><i class="fas fa-eye mr-2"></i> è¡¨å±¤èƒ½é‡ (å¤©å¹²å­—æ•¸)</p>
            <div id="surfaceWx" class="space-y-3"></div>
          </div>

          <div>
            <p class="text-[10px] font-black text-amber-500 mb-4 uppercase flex items-center"><i class="fas fa-shield-alt mr-2"></i> å¯¦æˆ°èƒ½é‡ (å¤©å¹²+è—å¹²+æœˆä»¤)</p>
            <div id="strategicWx" class="space-y-3"></div>
          </div>
        </div>

        <div class="mt-8 p-5 bg-slate-800/40 rounded-3xl text-[11px] text-slate-400 border border-white/5 leading-relaxed italic text-left">
          <p class="font-bold text-slate-300 mb-2 uppercase">ğŸ›¡ï¸ æ¼”ç®—æ³•èªªæ˜ï¼š</p>
          æœ¬å·¥å…·æä¾›å…©ç¨®äº”è¡Œè¦–è§’ï¼šè¡¨å±¤èƒ½é‡åƒ…çµ±è¨ˆå››æŸ±å¤©å¹²å‡ºç¾æ¬¡æ•¸ï¼›å¯¦æˆ°èƒ½é‡å‰‡ç´å…¥åœ°æ”¯è—å¹²æ¯”ä¾‹ (æ¡ç”¨æ¥­ç•Œå¸¸ç”¨ 0.6/0.3/0.1 æ¯”ä¾‹)ï¼Œä¸¦å°æœˆä»¤é€²è¡Œ 1.5 å€åŠ æ¬Šï¼Œæ¨¡æ“¬å­£ç¯€å¼·å¼±å½±éŸ¿ã€‚æ­¤ç‚ºå¯è§£é‡‹çš„çµæ§‹åŒ–ä¼°ç®—æ¨¡å‹ï¼Œä¸å–ä»£å®Œæ•´å‘½ç†æ¨è«–ã€‚
        </div>
      </div>

      <!-- â¸ æˆ°ç•¥ -->
      <div class="glass p-10 rounded-[2.5rem] border-t-4 border-amber-500 shadow-2xl w-full bg-gradient-to-b from-slate-900/50 to-transparent">
        <h2 class="text-xs font-black gold-text mb-4 uppercase tracking-[0.2em] text-center mx-auto">â¸ 2026 ä¸™åˆå¹´å¹´åº¦æˆ°ç•¥æ–¹é‡</h2>
        <div id="strategyBox" class="text-sm text-slate-200 leading-relaxed text-center italic"></div>
      </div>

      <!-- â¹ ä¸‰è‰²ç‡ˆ -->
      <div class="w-full px-2">
        <h2 class="text-xs font-black text-slate-500 mb-6 tracking-[0.2em] uppercase text-center mx-auto">â¹ 2026 ç¯€æ°£æµæœˆåŸ·è¡Œç¯€å¥ (ä¸‰è‰²ç‡ˆ)</h2>
        <div id="monthGrid" class="grid grid-cols-1 gap-3.5"></div>
        <p class="text-[9px] text-slate-600 mt-4 italic text-center uppercase tracking-widest mx-auto">â€» æœ¬è¡¨æ¡ç¯€æ°£æœˆå€é–“ï¼ˆéåœ‹æ›†æœˆï¼‰</p>
      </div>

      <!-- âº å‘½ç›¤åˆ†æ -->
      <div class="glass p-10 rounded-[2.5rem] shadow-2xl w-full bg-gradient-to-b from-slate-900/40 to-transparent">
        <h2 class="text-xs font-black gold-text mb-4 uppercase tracking-[0.2em] text-center mx-auto">âº å‘½ç›¤åˆ†æ ä½ çš„äººç”Ÿä½¿ç”¨èªªæ˜</h2>

        <div id="analysisBox" class="text-sm text-slate-200 leading-relaxed text-left italic space-y-2"></div>

        <div class="mt-8 p-5 bg-slate-800/40 rounded-3xl text-[11px] text-slate-400 border border-white/5 leading-relaxed italic text-left">
          <p class="font-bold text-slate-300 mb-2 uppercase">æç¤º</p>
          é€™æ®µæ–‡å­—æ˜¯æŠŠå‘½ç›¤çµæ§‹è½‰æˆå¯åŸ·è¡Œç­–ç•¥ ç›®æ¨™æ˜¯è®“ä½ çœ‹å®Œå°±çŸ¥é“ä»Šå¹´è¦æ”¶æ–‚ä»€éº¼ è¦å»ºç«‹ä»€éº¼å®¹å™¨ ä»¥åŠå“ªå¹¾å€‹æœˆä¸è¦ç¡¬è¡
        </div>
      </div>

      <!-- åˆ†äº«å€ -->
      <div class="glass p-10 rounded-[3rem] text-center border-2 border-dashed border-amber-500/20 bg-slate-900/60 w-full mb-12 flex flex-col items-center">
        <h3 class="gold-text text-2xl font-black mb-4 tracking-tighter italic text-center mx-auto">ã€Œå¦³ä¸æ˜¯åœ¨ç®—å‘½ï¼Œæ˜¯åœ¨é‡å¯« 2026ã€‚ã€</h3>
        <div class="flex flex-col gap-4 w-full px-2">
          <button onclick="copyText()" class="w-full bg-gradient-to-r from-amber-500 to-yellow-600 text-slate-900 font-black py-5 rounded-2xl text-lg shadow-xl hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center">
            <i class="far fa-copy mr-2"></i> ä¸€éµè¤‡è£½ã€æ·±åº¦æˆ°ç•¥ã€‘æ–‡æ¡ˆ
          </button>
          <a href="https://www.facebook.com/bill17gonplay/" target="_blank" class="w-full bg-[#1877F2] text-white py-4 rounded-2xl font-bold flex items-center justify-center text-sm shadow-lg mx-auto">
            <i class="fab fa-facebook-f mr-2"></i> å‰å¾€è‡‰æ›¸åƒèˆ‡æˆ°ç•¥å¯¦é©—
          </a>
        </div>
      </div>
    </div>
  </div>

  <div id="copyToast" class="fixed bottom-12 bg-amber-500 text-slate-900 px-8 py-4 rounded-full font-black text-sm shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none z-[2001] flex items-center transition-all">
    <i class="fas fa-check-circle mr-2"></i> å°ˆæ¥­æ ¡æº–ç‰ˆæˆ°ç•¥æ–‡æ¡ˆå·²è¤‡è£½
  </div>

  <script>
    const ELEMENTS = {"ç”²":"æœ¨","ä¹™":"æœ¨","ä¸™":"ç«","ä¸":"ç«","æˆŠ":"åœŸ","å·±":"åœŸ","åºš":"é‡‘","è¾›":"é‡‘","å£¬":"æ°´","ç™¸":"æ°´","å­":"æ°´","ä¸‘":"åœŸ","å¯…":"æœ¨","å¯":"æœ¨","è¾°":"åœŸ","å·³":"ç«","åˆ":"ç«","æœª":"åœŸ","ç”³":"é‡‘","é…‰":"é‡‘","æˆŒ":"åœŸ","äº¥":"æ°´"};
    const STEM_POLARITY = {"ç”²":"é™½","ä¹™":"é™°","ä¸™":"é™½","ä¸":"é™°","æˆŠ":"é™½","å·±":"é™°","åºš":"é™½","è¾›":"é™°","å£¬":"é™½","ç™¸":"é™°"};
    const SHISHEN_MAP = {
      "åŒé¡": {"åŒ":"æ¯”è‚©","ç•°":"åŠ«è²¡"},
      "ç”Ÿè€…": {"åŒ":"é£Ÿç¥","ç•°":"å‚·å®˜"},
      "å‰‹è€…": {"åŒ":"åè²¡","ç•°":"æ­£è²¡"},
      "å¾Œç”Ÿè€…": {"åŒ":"åå°","ç•°":"æ­£å°"},
      "å¾Œå‰‹è€…": {"åŒ":"ä¸ƒæ®º","ç•°":"æ­£å®˜"}
    };

    const CANGGAN_DATA = {
      "å­": {"ç™¸": 1.0},
      "ä¸‘": {"å·±": 0.6, "ç™¸": 0.3, "è¾›": 0.1},
      "å¯…": {"ç”²": 0.6, "ä¸™": 0.3, "æˆŠ": 0.1},
      "å¯": {"ä¹™": 1.0},
      "è¾°": {"æˆŠ": 0.6, "ä¹™": 0.3, "ç™¸": 0.1},
      "å·³": {"ä¸™": 0.6, "åºš": 0.3, "æˆŠ": 0.1},
      "åˆ": {"ä¸": 0.7, "å·±": 0.3},
      "æœª": {"å·±": 0.6, "ä¸": 0.3, "ä¹™": 0.1},
      "ç”³": {"åºš": 0.6, "å£¬": 0.3, "æˆŠ": 0.1},
      "é…‰": {"è¾›": 1.0},
      "æˆŒ": {"æˆŠ": 0.6, "è¾›": 0.3, "ä¸": 0.1},
      "äº¥": {"å£¬": 0.7, "ç”²": 0.3}
    };

    function getBranchMainStem(zhi) {
      const cg = CANGGAN_DATA[zhi];
      if (!cg) return null;
      let bestStem = null, bestW = -1;
      for (const s in cg) {
        if (cg[s] > bestW) { bestW = cg[s]; bestStem = s; }
      }
      return bestStem;
    }

    function normalizeToStem(x) {
      if (!x) return null;
      if (STEM_POLARITY[x]) return x;
      return getBranchMainStem(x);
    }

    function getSS(dm, target) {
      const sDm = normalizeToStem(dm);
      const sTarget = normalizeToStem(target);
      if (!sDm || !sTarget) return "";

      const de = ELEMENTS[sDm];
      const te = ELEMENTS[sTarget];
      const dp = STEM_POLARITY[sDm];
      const tp = STEM_POLARITY[sTarget];
      const isS = (dp === tp) ? "åŒ" : "ç•°";

      const gen = {"æœ¨":"ç«","ç«":"åœŸ","åœŸ":"é‡‘","é‡‘":"æ°´","æ°´":"æœ¨"};
      const ctrl = {"æœ¨":"åœŸ","åœŸ":"æ°´","æ°´":"ç«","ç«":"é‡‘","é‡‘":"æœ¨"};

      if (de === te) return SHISHEN_MAP["åŒé¡"][isS];
      if (gen[de] === te) return SHISHEN_MAP["ç”Ÿè€…"][isS];
      if (ctrl[de] === te) return SHISHEN_MAP["å‰‹è€…"][isS];
      if (gen[te] === de) return SHISHEN_MAP["å¾Œç”Ÿè€…"][isS];
      if (ctrl[te] === de) return SHISHEN_MAP["å¾Œå‰‹è€…"][isS];
      return "";
    }

    function isPressureTenGod(ss) { return /æ­£å®˜|ä¸ƒæ®º/.test(ss || ""); }

    // ============================
    // C è·¯ç·š æ•˜äº‹è¦å‰‡åº« 1.0
    // ============================
    const NarrativeRuleSet = {
      openings: {
        "æ°´": [
          "ä½ åƒä¸€æ¢æ°´ å¾ˆå¿« å¾ˆæ·± å¾ˆæ•æ„Ÿ",
          "ä½ åƒä¸€æ¢æ°´ è¡¨é¢å®‰éœ ä½†åº•ä¸‹æµé€Ÿå¾ˆçŒ›",
          "ä½ åƒä¸€æ¢æ°´ ä¸æ˜¯è„†å¼± æ˜¯ä½ æ¥æ”¶åˆ°çš„è¨Šè™Ÿå¤ªå¤š"
        ],
        "æœ¨": [
          "ä½ åƒä¸€æ£µæ¨¹ é•·å¾—å¾ˆå¿« ä½†ææ¢å¤ªå¤š",
          "ä½ åƒä¸€æ£µæ¨¹ ä¸€ç›´å¾€ä¸Š é•·åˆ°è‡ªå·±ä¹Ÿå–˜ä¸éæ°£",
          "ä½ åƒä¸€æ£µæ¨¹ ä½ ä¸ç¼ºç”Ÿé•· ä½ ç¼ºä¿®å‰ª"
        ],
        "ç«": [
          "ä½ åƒä¸€åœ˜ç« å¾ˆäº® å¾ˆæ€¥ å¾ˆæƒ³ç«‹åˆ»ç…§äº®ä¸€åˆ‡",
          "ä½ åƒä¸€åœ˜ç« ä¸€é»å°±ç‡ƒ ä¹Ÿå¾ˆå®¹æ˜“æŠŠè‡ªå·±ç‡’ä¹¾",
          "ä½ åƒä¸€åœ˜ç« ä½ ä¸æ˜¯æ²’è€å¿ƒ æ˜¯ä½ çœ‹åˆ°å¤ªå¤šè©²åšçš„äº‹"
        ],
        "åœŸ": [
          "ä½ åƒä¸€å¡ŠåœŸ å¾ˆèƒ½æ‰› å¾ˆèƒ½æ’ ä½†ä¹Ÿå¾ˆå®¹æ˜“æ‚¶ä½è‡ªå·±",
          "ä½ åƒä¸€å¡ŠåœŸ ä½ æŠŠå¤§å®¶éƒ½æ¥ä½äº† å»å¿˜äº†èª°ä¾†æ¥ä½ä½ ",
          "ä½ åƒä¸€å¡ŠåœŸ ä½ ä¸æ˜¯ä¸è®Šé€š æ˜¯ä½ å¤ªåœ¨æ„ç©©"
        ],
        "é‡‘": [
          "ä½ åƒä¸€æŠŠåˆ€ å¾ˆæº– å¾ˆæ¸…é†’ å¾ˆåœ¨æ„æ¨™æº–",
          "ä½ åƒä¸€æŠŠåˆ€ ä½ ä¸æ˜¯å†· æ˜¯ä½ ä¸æƒ³æµªè²»",
          "ä½ åƒä¸€æŠŠåˆ€ ä½ å…¶å¯¦å¾ˆåœ¨ä¹ åªæ˜¯ä½ ç”¨çµæœèªªè©±"
        ]
      },

      terrains: {
        "æ°´": {
          strong: ["ä¸€æ•´ç‰‡å¯†æ— è·¯å¾ˆå¤š ä½ æ¯èµ°ä¸€æ­¥éƒ½æœƒé•·å‡ºé¸é …", "å¤§æ±Ÿå…¥æµ· é€Ÿåº¦å¤ªå¿« å¾ˆé›£åœä¸‹ä¾†æ•´ç†"],
          weak: ["ä¹¾æ—±æ²³åºŠ æ°´é‚„åœ¨ ä½†å¤–ç•Œä¸€ç›´è¦ä½ è­‰æ˜è‡ªå·±", "ç‹¹çª„æ°´é“ ä½ è¢«é€¼è‘—åœ¨å¾ˆå°çš„ç©ºé–“å®Œæˆå¾ˆå¤§ä»»å‹™"]
        },
        "æœ¨": {
          strong: ["å¢æ—éå¯† ä½ å¾ˆå®¹æ˜“é•·æˆéåº¦æ‰¿æ“”çš„äºº", "é«˜ç‰†èŠ±åœ’ ä½ è¢«æœŸå¾…ä¸€ç›´å¾€ä¸Š ä½†æ²’äººæ•™ä½ ä¼‘æ¯"],
          weak: ["é¢¨å¤§åœŸè–„ ä½ æƒ³æˆé•· ä½†è³‡æºå¸¸å¸¸è·Ÿä¸ä¸Š", "ç¢çŸ³å¡ ä½ å¾ˆåŠªåŠ› ä½†æ¯ä¸€æ­¥éƒ½åœ¨è€—"]
        },
        "ç«": {
          strong: ["ç››å¤æ›æ›¬ ä½ ä¸€å‡ºæ‰‹å°±å¾ˆçŒ› ä¹Ÿæœ€æ€•ç‡’åˆ°ç©º", "ç«å ´å¤ªäº® ä½ æœƒè¢«æ‰€æœ‰æœŸå¾…æ¨è‘—è·‘"],
          weak: ["ç«ç¨®åœ¨é¢¨è£¡ ä½ å…¶å¯¦æœ‰å…‰ ä½†å¸¸è¢«ç¾å¯¦å¹ç†„", "æ½®æ¿•æš—å®¤ ä½ éœ€è¦çš„æ˜¯å¯æŒçºŒçš„ç‡ƒæ–™"]
        },
        "åœŸ": {
          strong: ["åšåœŸå †ç© ä½ èƒ½æ‰› ä½†ä¹Ÿæœ€å®¹æ˜“å¡ä½", "è€åŸç‰† ä½ æ’å¾—ä½ ä½†è½‰èº«ä¸å®¹æ˜“"],
          weak: ["é¬†åœŸæµå¤± ä½ å¾ˆæƒ³ç©© ä½†å¤–ç•Œä¸€ç›´åœ¨è®Š", "åœ°åŸºæœªä¹¾ ä½ éœ€è¦æ™‚é–“å›ºåŒ–è‡ªå·±çš„ç¯€å¥"]
        },
        "é‡‘": {
          strong: ["å¯’éµå·¥åŠ æ¨™æº–å¾ˆé«˜ ä½ ä¹Ÿå¾ˆå®¹æ˜“è‹›åˆ»è‡ªå·±", "é‹¼ç´¢æ©‹ ä½ èµ°å¾—å¾ˆæº– ä½†å®¹éŒ¯å¾ˆå°"],
          weak: ["éˆåˆ€ç„¡ç£¨ ä½ ä¸æ˜¯ä¸è¡Œ æ˜¯å·¥å…·ä¸å¤ ç²¾", "è–„åˆƒé‡ç¡¬ç‰© ä½ å¤ªæ—©ç”¨é«˜æ¨™æº–æ‰“è‡ªå·±"]
        }
      },

      pullsByDominantSS: {
        "å‚·å®˜": ["è¡¨é”", "çªç ´", "å°æŠ—è¦å‰‡"],
        "é£Ÿç¥": ["ä½œå“", "äº«å—", "é•·æœŸæ‰“ç£¨"],
        "æ­£è²¡": ["æ”¶å…¥", "è²¬ä»»", "å¯äº¤ä»˜"],
        "åè²¡": ["è³‡æº", "æ©Ÿæœƒ", "åˆä½œ"],
        "æ­£å®˜": ["è¦å‰‡", "é‚Šç•Œ", "æ¨™æº–"],
        "ä¸ƒæ®º": ["é¢¨éšª", "é€Ÿåº¦", "æ±ºæ–·"],
        "æ­£å°": ["å­¸ç¿’", "ä¿®å¾©", "ç†è§£"],
        "åå°": ["æŠ€è¡“", "æ´å¯Ÿ", "å‡ç´š"],
        "æ¯”è‚©": ["æ„å¿—", "è‡ªç«‹", "åŒå„•ç«¶çˆ­"],
        "åŠ«è²¡": ["äººè„ˆ", "äº¤æ›", "åœˆå±¤"]
      },

      notIsByElement: {
        "æ°´": [
          "ä¸æ˜¯ä½ å¤ªæƒ…ç·’ æ˜¯ä½ æ¥æ”¶çš„è¨Šè™Ÿå¤ªå¯†",
          "ä¸æ˜¯ä½ æ²’å®šåŠ› æ˜¯ä½ ä¸€ç›´åœ¨æ›¿åˆ¥äººæ„Ÿå—",
          "ä¸æ˜¯ä½ ä¸å¤ å¼· æ˜¯ä½ æŠŠè‡ªå·±æ”¾åœ¨å¤ªåµçš„ç’°å¢ƒè£¡"
        ],
        "æœ¨": [
          "ä¸æ˜¯ä½ ä¸åŠªåŠ› æ˜¯ä½ ä¸€ç›´åœ¨é•·å‡ºå¤ªå¤šåˆ†æ”¯",
          "ä¸æ˜¯ä½ æ²’èƒ½åŠ› æ˜¯ä½ æŠŠèƒ½åŠ›ç”¨åœ¨ä¸è©²æ‰¿æ“”çš„åœ°æ–¹",
          "ä¸æ˜¯ä½ ä¸å¤ ç‹  æ˜¯ä½ æ¨ä¸å¾—å‰ªæ‰ä»»ä½•ä¸€æ¢è·¯"
        ],
        "ç«": [
          "ä¸æ˜¯ä½ è¡å‹• æ˜¯ä½ å¤ªå¿«çœ‹è¦‹çµ‚é»",
          "ä¸æ˜¯ä½ ä¸ç©© æ˜¯ä½ æŠŠæ¯ä»¶äº‹éƒ½ç•¶æˆæ±ºæˆ°",
          "ä¸æ˜¯ä½ ä¸è¡Œ æ˜¯ä½ ç‡ƒæ–™æ²’è£œ å°±ä¸€ç›´é»ç«"
        ],
        "åœŸ": [
          "ä¸æ˜¯ä½ ä¿å®ˆ æ˜¯ä½ çŸ¥é“ä»£åƒ¹æœƒå¾ˆé‡",
          "ä¸æ˜¯ä½ ä¸è®Š æ˜¯ä½ å¤ªç¿’æ…£ç”¨è‡ªå·±ç¡¬æ‰›",
          "ä¸æ˜¯ä½ æ²’æ©Ÿæœƒ æ˜¯ä½ æ€•æ©Ÿæœƒå¸¶ä¾†å¤±æ§"
        ],
        "é‡‘": [
          "ä¸æ˜¯ä½ å†·æ·¡ æ˜¯ä½ æ€•æµªè²»å½¼æ­¤æ™‚é–“",
          "ä¸æ˜¯ä½ æŒ‘å‰” æ˜¯ä½ ä¸€ç›´ç”¨é«˜æ¨™æº–ä¿è­·è‡ªå·±",
          "ä¸æ˜¯ä½ ä¸åˆç¾¤ æ˜¯ä½ ä¸æƒ³ç”¨ä½å“è³ªäº¤æ›å®‰å…¨æ„Ÿ"
        ]
      },

      goodNewsByLack: {
        "æœ¨": "ä½†å¥½æ¶ˆæ¯ä¾†äº† ä½ åªè¦æŠŠé¸æ“‡è®Šå°‘ ä½ å°±æœƒçªç„¶è®Šå¿«",
        "ç«": "ä½†å¥½æ¶ˆæ¯ä¾†äº† ä½ åªè¦æŠŠè¡Œå‹•æ‹†å° ä½ å°±æœƒçªç„¶è®Šç©©",
        "åœŸ": "ä½†å¥½æ¶ˆæ¯ä¾†äº† ä½ åªè¦æŠŠæµç¨‹ç«‹èµ·ä¾† ä½ å°±ä¸å¿…å†ç¡¬æ‰›",
        "é‡‘": "ä½†å¥½æ¶ˆæ¯ä¾†äº† ä½ åªè¦æŠŠæ¨™æº–å¯«æ¸…æ¥š ä½ å°±èƒ½æŠŠè‡ªå·±æ•‘å›ä¾†",
        "æ°´": "ä½†å¥½æ¶ˆæ¯ä¾†äº† ä½ åªè¦æŠŠæƒ…ç·’æ”¾å›èº«é«” ä½ å°±èƒ½é‡æ–°æ±ºç­–"
      },

      annualThemesByYearSSG: {
        "å‚·å®˜": "å¹´åº¦å‘½é¡Œ æŠŠè‡ªå·±åšæˆå¯è¢«å¼•ç”¨çš„ç«‹å ´",
        "é£Ÿç¥": "å¹´åº¦å‘½é¡Œ ç”¨ä½œå“èªªæœä¸–ç•Œ",
        "æ­£è²¡": "å¹´åº¦å‘½é¡Œ æŠŠæ”¶å…¥åšæˆåˆ¶åº¦",
        "åè²¡": "å¹´åº¦å‘½é¡Œ ç”¨é€£çµæ›é€Ÿåº¦",
        "æ­£å®˜": "å¹´åº¦å‘½é¡Œ ç”¨ç´€å¾‹æ›ä¿¡ä»»",
        "ä¸ƒæ®º": "å¹´åº¦å‘½é¡Œ ç”¨æ±ºæ–·æ›å‘½é‹",
        "æ­£å°": "å¹´åº¦å‘½é¡Œ ç”¨ç†è§£æ›ç©©å®š",
        "åå°": "å¹´åº¦å‘½é¡Œ ç”¨æŠ€è¡“æ›ä¸»å ´",
        "æ¯”è‚©": "å¹´åº¦å‘½é¡Œ ç”¨è‡ªç«‹æ›å°Šé‡",
        "åŠ«è²¡": "å¹´åº¦å‘½é¡Œ ç”¨äº¤æ›æ›æ©Ÿæœƒ"
      },

      methodsByElement: {
        "æ°´": "æ–¹æ³• ä½ è¦çš„ä¸æ˜¯æ›´åŠªåŠ› æ˜¯æ›´å®‰éœçš„å®¹å™¨ å…ˆæŠŠè¨Šè™Ÿé™å™ª å†æŠŠè¡Œå‹•æ”¶æ–‚æˆä¸€æ¢ä¸»ç·š",
        "æœ¨": "æ–¹æ³• ä½ è¦çš„ä¸æ˜¯æ›´å¤šè¨ˆç•« æ˜¯æ›´ç‹ çš„ä¿®å‰ª æŠŠæ¯é€±åªåšä¸‰ä»¶äº‹å¯«æˆåˆ¶åº¦ ä½ å°±ä¸æœƒè¢«åˆ†æ•£",
        "ç«": "æ–¹æ³• ä½ è¦çš„ä¸æ˜¯æ›´ç‡ƒ æ˜¯æ›´å¯æŒçºŒ æŠŠè¡åˆºæ”¹æˆçŸ­è¿´åœˆ æŠŠç†±æƒ…äº¤çµ¦æµç¨‹è€Œä¸æ˜¯æƒ…ç·’",
        "åœŸ": "æ–¹æ³• ä½ è¦çš„ä¸æ˜¯å†æ‰› æ˜¯è¦åˆ†å·¥ æŠŠè²¬ä»»æ‹†æˆæ¸…å–® æŠŠäº¤ä»˜å¯«é€²è¡Œäº‹æ›† ä½ å°±æœƒé¬†",
        "é‡‘": "æ–¹æ³• ä½ è¦çš„ä¸æ˜¯æ›´åš´æ ¼ æ˜¯æ›´æ¸…æ¥š æŠŠæ¨™æº–è®Šæˆæ–‡ä»¶ æŠŠç•Œç·šè®Šæˆæµç¨‹ ä½ å°±ä¸ç”¨ä¸€ç›´ç¡¬æ’"
      },

      dealTemplatesByLack: {
        "æœ¨": "åªè¦ä½ æŠŠè·¯è®Šå°‘ ä½ å°±æœƒè®Šå¼· åšä¸åˆ°å°±å…ˆæŠŠæ¯é€±æ–°å¢çš„ä»»å‹™ç æ‰ä¸€åŠ",
        "ç«": "åªè¦ä½ æŠŠæ­¥é©Ÿæ‹†å° ä½ å°±æœƒè®Šç©© åšä¸åˆ°å°±å…ˆæŠŠæ‰¿è«¾æ¸›åŠ ä½†äº¤ä»˜åŠ å€",
        "åœŸ": "åªè¦ä½ æŠŠåˆ¶åº¦ç«‹èµ·ä¾† ä½ å°±ä¸å¿…å†ç¡¬æ‰› åšä¸åˆ°å°±å…ˆæŠŠä½ æœ€å¸¸æ•‘ç«çš„é‚£ä»¶äº‹å¤–åŒ…",
        "é‡‘": "åªè¦ä½ æŠŠæ¨™æº–å¯«æ¸…æ¥š ä½ å°±ä¸æœƒè¢«äººæƒ…æ‹–èµ° åšä¸åˆ°å°±å…ˆæ‹’çµ•ä»»ä½•æ²’æœ‰è¦æ ¼çš„åˆä½œ",
        "æ°´": "åªè¦ä½ æŠŠç¡çœ èˆ‡èº«é«”æ”¾å›å„ªå…ˆé †åº ä½ å°±èƒ½é‡æ–°æ±ºç­– åšä¸åˆ°å°±å…ˆæŠŠç¤¾äº¤èˆ‡è³‡è¨Šæ–·æ‰ä¸‰å¤©"
      },

      closings: [
        "æœ€å¾Œ ä¸æ±‚å®Œç¾ å…ˆæ”¶æ–‚æ²‰æ¾± ä½ åªè¦å…ˆåšå‡ºä¸€å€‹å¯è¢«æ‰¿æ¥çš„ç‰ˆæœ¬ å°±å·²ç¶“è´å¾ˆå¤šäººäº†",
        "æœ€å¾Œ ä¸ç”¨æ€¥è‘—è®Šå²å®³ å…ˆè®“è‡ªå·±ç«™å¾—ä½ ç«™ä½äº† ä½ æ‰æœ‰è³‡æ ¼è«‡çˆ†ç™¼",
        "æœ€å¾Œ ä½ ä¸ç”¨è­‰æ˜ä½ å¾ˆå¼· ä½ åªè¦è­‰æ˜ä½ èƒ½æŒçºŒ ä¸–ç•Œå°±æœƒé–‹å§‹ç›¸ä¿¡ä½ "
      ]
    };

    function wxPercent(strategicWx) {
      const total = Object.values(strategicWx).reduce((s, v) => s + (Number(v || 0)), 0) || 1;
      const pct = {};
      ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => pct[e] = (Number(strategicWx[e] || 0)) / total);
      return { pct, total };
    }

    function findLacks(strategicWx, threshold = 0.08) {
      const { pct } = wxPercent(strategicWx);
      return Object.entries(pct)
        .filter(([e, p]) => p < threshold)
        .sort((a, b) => a[1] - b[1])
        .map(([e]) => e);
    }

    function pickOne(arr, seed = 0) {
      if (!arr || arr.length === 0) return "";
      const i = Math.abs(seed) % arr.length;
      return arr[i];
    }

    function buildNarrativeProfile({
      dmElement,
      strategicWx,
      dominantSS,
      yrSS_G,
      yrSS_Z,
      redMonths = []
    }) {
      const lacks = findLacks(strategicWx, 0.08);
      const primaryLack = lacks[0] || null;

      const { pct } = wxPercent(strategicWx);
      const strengthScore = pct[dmElement] || 0;
      const strengthLevel = strengthScore >= 0.24 ? "strong" : "weak";

      const opening = pickOne(NarrativeRuleSet.openings[dmElement], Math.floor(strengthScore * 1000));
      const terrainPool = NarrativeRuleSet.terrains[dmElement]?.[strengthLevel] || [];
      const terrain = pickOne(terrainPool, lacks.length);

      const pulls = NarrativeRuleSet.pullsByDominantSS[dominantSS] || ["éˆæ„Ÿ","äººæƒ…","è²¬ä»»"];
      const notIs = (NarrativeRuleSet.notIsByElement[dmElement] || []).slice(0, 3);

      const goodNews = primaryLack
        ? (NarrativeRuleSet.goodNewsByLack[primaryLack] || "ä½†å¥½æ¶ˆæ¯ä¾†äº† ä½ åªè¦é–‹å§‹æ”¶æ–‚ äº‹æƒ…å°±æœƒè®Šå¿«")
        : "ä½†å¥½æ¶ˆæ¯ä¾†äº† ä½ åªè¦æŠŠç¯€å¥å›ºå®š ä½ å°±æœƒé–‹å§‹è´å›è‡ªå·±";

      const annualTheme = NarrativeRuleSet.annualThemesByYearSSG[yrSS_G] || "å¹´åº¦å‘½é¡Œ ç”¨æ”¶æ–‚æ›çˆ†ç™¼";
      const method = NarrativeRuleSet.methodsByElement[dmElement] || "æ–¹æ³• æŠŠåˆ¶åº¦ç•¶å®¹å™¨ æŠŠè¡Œå‹•ç•¶è­‰æ˜";

      const deal = primaryLack
        ? (NarrativeRuleSet.dealTemplatesByLack[primaryLack] || "åªè¦ä½ é–‹å§‹æ”¶æ–‚ ä½ å°±æœƒè®Šå¼· åšä¸åˆ°å°±å…ˆæŠŠè¡Œç¨‹ç æ‰ä¸‰æˆ")
        : "åªè¦ä½ æŠŠç¯€å¥å›ºå®š ä½ å°±æœƒè®Šå¼· åšä¸åˆ°å°±å…ˆæŠŠæ–°å¢ä»»å‹™åœå…©é€±";

      const monthRoadmap = (redMonths && redMonths.length)
        ? `æµæœˆè·¯ç·šåœ– å£“åŠ›æœˆ ${redMonths.join(" ")} é€™äº›æœˆä¸æ±‚è¡åˆº åªæ±‚ä¸å¤±æ§ æŠŠè¦å‰‡å®ˆä½å°±æœƒé`
        : "æµæœˆè·¯ç·šåœ– ä»Šå¹´æœ€é‡è¦çš„ä¸æ˜¯æ‹šå‘½ æ˜¯ç©©å®š æŠŠç¯€å¥å®ˆä½ ä½ å°±æœƒé–‹å§‹ç¿»ç›¤";

      const closing = pickOne(NarrativeRuleSet.closings, (dominantSS || "").length);

      const narrativeLines = [
        opening,
        `ä½†ä½ å‡ºç”Ÿçš„åœ°å½¢ æ˜¯ ${terrain}`,
        `ä½ æ¯å¾€å‰èµ°ä¸€æ­¥ å°±æœƒé•·å‡ºä¸‰æ¢å²”è·¯ ${pulls[0]} ${pulls[1]} ${pulls[2]}`,
        `é€™å°±æ˜¯ä½ æœ€æ ¸å¿ƒçš„çŸ›ç›¾`,
        notIs[0] || "",
        notIs[1] || "",
        notIs[2] || "",
        goodNews,
        annualTheme,
        method,
        deal,
        monthRoadmap,
        closing
      ].filter(Boolean);

      return {
        lacks,
        strengthScore,
        narrativeLines,
        primaryLack,
        pulls
      };
    }

    function yearStrategyCopy(ssG, ssZ) {
      const key = ssG || "default";
      const map = {
        "å‚·å®˜": ["ä»Šå¹´ä¸æ˜¯è¦ä½ æ›´åŠªåŠ›ã€‚æ˜¯è¦ä½ æ›´æ•¢èªªã€‚", "ä¸æ˜¯æ²’è·¯ã€‚æ˜¯ä½ å¤ªç¿’æ…£èµ°å®‰å…¨çš„è·¯ã€‚", "ä¸æ˜¯ç¼ºè³‡æºã€‚æ˜¯ç¼ºä¸€å¥ä½ çœŸæ­£æ•¢è¬›çš„è©±ã€‚", "æŠŠå…§å®¹åšæˆæ­¦å™¨ã€‚æŠŠèªæ°£ç·´æˆåˆ€ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ ä¸€é–‹å£ã€‚å¸‚å ´å°±æœƒçŸ¥é“ä½ ä¸æ˜¯åœ¨ç©ã€‚", "å¹´åº¦å‘½é¡Œã€‚æŠŠè‡ªå·±åšæˆä¸€å€‹å¯è¢«å¼•ç”¨çš„ç«‹å ´ã€‚"],
        "é£Ÿç¥": ["ä»Šå¹´ä¸æ˜¯è¡åˆºå¹´ã€‚æ˜¯æ‰“ç£¨å¹´ã€‚", "ä¸æ˜¯åšæ›´å¤šã€‚æ˜¯åšæ›´å¥½ã€‚", "æ§ç®¡å“è³ªã€‚æ˜¯æŠŠä½ æ‰‹ä¸Šçš„æ±è¥¿åšåˆ°å¯ä»¥è³£æ›´è²´ã€‚", "æŠŠæµç¨‹åšæˆå®¹å™¨ã€‚æŠŠä½œå“åšæˆå“ç‰Œã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ åªè¦æŠŠæ‰‹è—åšæ·±ã€‚å°±æœƒæœ‰äººæ›¿ä½ å‚³ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨ä½œå“èªªæœä¸–ç•Œã€‚"],
        "æ­£è²¡": ["ä»Šå¹´ä¸æ˜¯éˆæ„Ÿå¹´ã€‚æ˜¯çµå¸³å¹´ã€‚", "ä¸æ˜¯ä½ ä¸æœƒè³ºã€‚æ˜¯ä½ æ²’æŠŠåƒ¹ç›®è¡¨è²¼å‡ºä¾†ã€‚", "æ§ç®¡æµç¨‹ã€‚æ˜¯ä½ æ²’æœ‰æŠŠæˆäº¤æµç¨‹å®šä¸‹ä¾†ã€‚", "æŠŠæ¯ä¸€æ¬¡äº’å‹•ã€‚éƒ½æ¨é€²åˆ°ä»˜æ¬¾ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ åªè¦é–‹å§‹ç®—å¸³ã€‚éŒ¢å°±æœƒé–‹å§‹å›ä¾†ã€‚", "å¹´åº¦å‘½é¡Œã€‚æŠŠæ”¶å…¥åšæˆåˆ¶åº¦ã€‚"],
        "åè²¡": ["ä»Šå¹´ä¸æ˜¯è‹¦å¹¹å¹´ã€‚æ˜¯è³‡æºå¹´ã€‚", "ä¸æ˜¯ä½ ä¸å¤ å¼·ã€‚æ˜¯ä½ å¤ªç¿’æ…£å–®æ‰“ç¨é¬¥ã€‚", "é…ç½®åˆä½œã€‚æ˜¯ç¼ºä¸€å€‹èƒ½æ”¾å¤§ä½ çš„å±€ã€‚", "æŠŠäººè„ˆåšæˆç¶²ã€‚æŠŠåˆä½œåšæˆæ§“æ¡¿ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ åªè¦ç«™ä¸Šæ­£ç¢ºçš„å ´ã€‚å°±æœ‰äººæ›¿ä½ åŠ é€Ÿã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨é€£çµæ›é€Ÿåº¦ã€‚"],
        "æ­£å®˜": ["ä»Šå¹´ä¸æ˜¯è‡ªç”±å¹´ã€‚æ˜¯è¦å‰‡å¹´ã€‚", "ä¸æ˜¯ä¸–ç•Œé‡å°ä½ ã€‚æ˜¯ä½ å¿…é ˆé•·å‡ºé‚Šç•Œã€‚", "æŒ‘æˆ°å¦³çš„è€å¿ƒã€‚æ˜¯ä½ éœ€è¦ä¸€å¥—å¯è¤‡è£½çš„æ¨™æº–ã€‚", "æŠŠåˆ¶åº¦åšæˆè­·åŸæ²³ã€‚æŠŠç§©åºåšæˆåŠ›é‡ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ ä¸€æ—¦æŠŠè¦å‰‡ç«‹ä½ã€‚åˆ¥äººåè€Œæœƒæ›´ä¿¡ä½ ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨ç´€å¾‹æ›ä¿¡ä»»ã€‚"],
        "ä¸ƒæ®º": ["ä»Šå¹´ä¸æ˜¯å¹³ç©©å¹´ã€‚æ˜¯ç ´å±€å¹´ã€‚", "ä¸æ˜¯ä½ å€’æ¥£ã€‚æ˜¯ä½ ç¢°åˆ°å¿…é ˆé€²åŒ–çš„é—œé—œã€‚", "é…ç½®é¢¨éšªã€‚æ˜¯è¦ä½ é‡æ–°é…ç½®é¢¨éšªã€‚", "è©²ç å°±ç ã€‚è©²æ›å°±æ›ã€‚è©²æ’¤å°±æ’¤ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ åªè¦æ•¢æ›ä¸€æ¢è·¯ã€‚å±€é¢å°±æœƒç¿»ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨æ±ºæ–·æ›å‘½é‹ã€‚"],
        "æ­£å°": ["ä»Šå¹´ä¸æ˜¯å¤–è¡å¹´ã€‚æ˜¯å›æ”¶å¹´ã€‚", "ä¸æ˜¯ä½ é€€ã€‚æ˜¯ä½ åœ¨æŠŠåŠ›é‡æ”¶å›ä¾†ã€‚", "é‡æ•´ç³»çµ±ã€‚æ˜¯ä½ åœ¨æŠŠè‡ªå·±ä¿®å¥½ã€‚", "æŠŠçŸ¥è­˜åšæˆåœ°åŸºã€‚æŠŠæ–¹æ³•åšæˆè·¯æ¨™ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ è¶Šæ¸…æ¥šã€‚è¶Šä¸æ€•ä¸–ç•Œäº‚ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨ç†è§£æ›ç©©å®šã€‚"],
        "åå°": ["ä»Šå¹´ä¸æ˜¯è¡¨ç¾å¹´ã€‚æ˜¯å‡ç´šå¹´ã€‚", "ä¸æ˜¯ä½ ä¸å¤ ç†±ã€‚æ˜¯ä½ éœ€è¦æ›´ç²¾æº–çš„å·¥å…·ã€‚", "å¹³è¡¡æ„Ÿèˆ‡éˆæ„Ÿç¼ºä¸€ä¸å¯ã€‚æ˜¯ç¼ºä¸€å¥—å¯è½åœ°çš„ç³»çµ±ã€‚", "æŠŠæŠ€è¡“åšæˆå£å£˜ã€‚æŠŠæ´å¯Ÿåšæˆå·®ç•°ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ åªè¦æŠŠæ­¦å™¨ç£¨äº®ã€‚åˆ¥äººè¿½ä¸ä¸Šä½ ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨æŠ€è¡“æ›ä¸»å ´ã€‚"],
        "æ¯”è‚©": ["ä»Šå¹´ä¸æ˜¯é é‹æ°£ã€‚æ˜¯é æ„å¿—ã€‚", "ä¸æ˜¯æ²’äººå¹«ä½ ã€‚æ˜¯ä½ å¿…é ˆå…ˆç«™ç©©ã€‚", "å®šç¾©æˆ°å ´ã€‚æ˜¯ä½ è¦å…ˆæŠŠè‡ªå·±æ’èµ·ä¾†ã€‚", "æŠŠè‡ªå·±åšæˆä¸»åŠ›ã€‚æŠŠç¯€å¥åšæˆç´€å¾‹ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ ä¸€æ—¦ç«™ç©©ã€‚åè€Œæœƒæœ‰äººè·Ÿä¸Šä½ ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨è‡ªç«‹æ›å°Šé‡ã€‚"],
        "åŠ«è²¡": ["ä»Šå¹´ä¸æ˜¯å–®å¹¹å¹´ã€‚æ˜¯æ‰“ç¾¤æ¶å¹´ã€‚", "ä¸æ˜¯ä½ ä¸å¤ å¥½ã€‚æ˜¯ä½ è¦é€²æ›´å¤§çš„åœˆã€‚", "å®šç¾©äº¤æ›ã€‚æ˜¯è¦ä½ å­¸æœƒäº¤æ›ã€‚", "æŠŠäººè„ˆè®Šæ¸ é“ã€‚æŠŠåˆä½œè®Šç¾é‡‘æµã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ åªè¦é–‹å§‹èµ°å‡ºå»ã€‚äº‹æƒ…å°±æœƒè®Šå¿«ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨é€£çµæ›æ©Ÿæœƒã€‚"],
        "default": ["ä»Šå¹´ä¸æ˜¯æ±‚ç¥ã€‚æ˜¯æ±‚æ¸…æ¥šã€‚", "ä¸æ˜¯ä½ ä¸è¡Œã€‚æ˜¯ä½ éœ€è¦ä¸€å€‹æ›´ä¹¾æ·¨çš„ç¯€å¥ã€‚", "æ§åˆ¶è®Šå› ã€‚æ˜¯ä½ è¦å…ˆæŠŠè‡ªå·±æ”¶æ–‚ã€‚", "æŠŠåˆ¶åº¦ç•¶å®¹å™¨ã€‚æŠŠè¡Œå‹•ç•¶è­‰æ˜ã€‚", "ä½†å¥½æ¶ˆæ¯ä¾†äº†ã€‚ä½ åªè¦é–‹å§‹åšã€‚å‘½å°±æœƒè·Ÿè‘—å‹•ã€‚", "å¹´åº¦å‘½é¡Œã€‚ç”¨æ”¶æ–‚æ›çˆ†ç™¼ã€‚"]
      };
      const lines = map[key] || map["default"];
      const zHint = ssZ ? `ï¼ˆå¹´åº¦åœ°æ”¯æ°£å ´åå‘ï¼š${ssZ}ï¼‰` : "";
      return { lines, zHint };
    }

    function launch() {
      document.getElementById('loading').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
        calculate();
      }, 1200);
    }

    function calculate() {
      const vy = parseInt(document.getElementById('birthYear').value, 10);
      const vm = parseInt(document.getElementById('birthMonth').value, 10);
      const vd = parseInt(document.getElementById('birthDay').value, 10);
      const vh = parseInt(document.getElementById('birthHour').value, 10);
      const vmin = parseInt(document.getElementById('birthMinute').value, 10);

      try {
        const sol = Solar.fromYmdHms(vy, vm, vd, vh, vmin, 0);
        const bazi = sol.getLunar().getEightChar();
        const bY = bazi.getYear(), bM = bazi.getMonth(), bD = bazi.getDay(), bH = bazi.getTime(), dm = bD[0];

        document.getElementById('yG').innerText = bY[0]; document.getElementById('yZ').innerText = bY[1];
        document.getElementById('mG').innerText = bM[0]; document.getElementById('mZ').innerText = bM[1];
        document.getElementById('dG').innerText = bD[0]; document.getElementById('dZ').innerText = bD[1];
        document.getElementById('hG').innerText = bH[0]; document.getElementById('hZ').innerText = bH[1];

        const mSSZ = getSS(dm, bM[1]);
        document.getElementById('ySG').innerText = getSS(dm, bY[0]); document.getElementById('ySZ').innerText = getSS(dm, bY[1]);
        document.getElementById('mSG').innerText = getSS(dm, bM[0]); document.getElementById('mSZ').innerText = mSSZ;
        document.getElementById('hSG').innerText = getSS(dm, bH[0]); document.getElementById('hSZ').innerText = getSS(dm, bH[1]);

        let surface = {"æœ¨":0,"ç«":0,"åœŸ":0,"é‡‘":0,"æ°´":0}, strategic = {"æœ¨":0,"ç«":0,"åœŸ":0,"é‡‘":0,"æ°´":0};
        [bY[0], bM[0], bD[0], bH[0]].forEach(g => { surface[ELEMENTS[g]]++; });

        const pillars = [{g:bY[0],z:bY[1],m:1.0},{g:bM[0],z:bM[1],m:1.5},{g:bD[0],z:bD[1],m:1.0},{g:bH[0],z:bH[1],m:1.0}];
        pillars.forEach(p => {
          strategic[ELEMENTS[p.g]] += 1.0 * p.m;
          const cg = CANGGAN_DATA[p.z] || {};
          for (let stem in cg) strategic[ELEMENTS[stem]] += cg[stem] * p.m;
        });

        const maxStrat = pillars.reduce((acc, p) => {
          const cg = CANGGAN_DATA[p.z] || {};
          const cgSum = Object.values(cg).reduce((s, v) => s + v, 0);
          return acc + (1 + cgSum) * p.m;
        }, 0);

        function formatVal(v) {
          const x = Number(v || 0);
          if (x > 0 && x < 0.05) return "<0.1";
          return x.toFixed(1);
        }

        function renderBar(id, data, max) {
          const box = document.getElementById(id);
          box.innerHTML = '';
          ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => {
            const raw = Number(data[e] || 0);
            const pct = max > 0 ? (raw / max) * 100 : 0;
            const width = (raw > 0 && pct < 2) ? 2 : pct;
            box.innerHTML += `
              <div class="space-y-1 w-full text-left">
                <div class="flex justify-between text-[9px] font-bold"><span>${e}</span><span>${formatVal(raw)}</span></div>
                <div class="h-1.5 bg-white/5 rounded-full overflow-hidden">
                  <div class="h-full wuxing-${e}" style="width:${Math.max(0, Math.min(100, width))}%"></div>
                </div>
              </div>`;
          });
        }
        renderBar('surfaceWx', surface, 4);
        renderBar('strategicWx', strategic, maxStrat);

        const yrSS_G = getSS(dm, "ä¸™"), yrSS_Z = getSS(dm, "åˆ");
        const yrRelMap = {"å‚·å®˜":"å…§å®¹çˆ†ç‚¸å¹´","é£Ÿç¥":"ç”¢å“æ‰“ç£¨å¹´","æ­£è²¡":"ç²åˆ©å…¥å¸³å¹´","åè²¡":"è³‡ç”¢é…ç½®å¹´","æ­£å®˜":"è¦å‰‡é‡çµ„å¹´","ä¸ƒæ®º":"æŒ‘æˆ°çªç ´å¹´","æ­£å°":"è³‡æºå›æ”¶å¹´","åå°":"æŠ€è¡“ç²¾é€²å¹´","æ¯”è‚©":"åŒå„•ç«¶çˆ­å¹´","åŠ«è²¡":"äººè„ˆæ“´å±•å¹´"};
        const yTagG = yrRelMap[yrSS_G] || "å¹´åº¦è®Šé©", yTagZ = yrRelMap[yrSS_Z] || "åº•å±¤å½±éŸ¿";
        const ys = yearStrategyCopy(yrSS_G, yrSS_Z);

        document.getElementById('strategyBox').innerHTML = `
          <p class="font-black text-amber-500 text-2xl mb-3 tracking-tighter">${yTagG} <span class="text-xs text-slate-500 font-normal"> / ${yTagZ} </span></p>
          <div class="space-y-2"><p>${ys.lines[0]}</p><p>${ys.lines[4]}</p><p class="text-amber-200 font-bold">${ys.lines[5]}</p><p class="text-[10px] text-slate-500 mt-4">${ys.zHint}</p></div>`;

        const mGrid = document.getElementById('monthGrid'); mGrid.innerHTML = ''; let redM = [];
        const bounds = [{n:"åºšå¯…",r:"02.04-03.05"},{n:"è¾›å¯",r:"03.05-04.05"},{n:"å£¬è¾°",r:"04.05-05.05"},{n:"ç™¸å·³",r:"05.05-06.05"},{n:"ç”²åˆ",r:"06.05-07.07"},{n:"ä¹™æœª",r:"07.07-08.07"},{n:"ä¸™ç”³",r:"08.07-09.07"},{n:"ä¸é…‰",r:"09.07-10.08"},{n:"æˆŠæˆŒ",r:"10.08-11.07"},{n:"å·±äº¥",r:"11.07-12.07"},{n:"åºšå­",r:"12.07-01.05"},{n:"è¾›ä¸‘",r:"01.05-02.04"}];
        bounds.forEach(b => {
          const ssG = getSS(dm, b.n[0]), ssZ = getSS(dm, b.n[1]), isRed = isPressureTenGod(ssG) || isPressureTenGod(ssZ);
          if (isRed) redM.push(b.n);
          mGrid.innerHTML += `
            <div class="glass p-5 rounded-2xl border-l-4 ${isRed ? 'border-red-500 bg-red-500/5' : 'border-emerald-500 bg-emerald-500/5'} flex justify-between items-center w-full">
              <div class="text-left"><p class="font-black text-base">${b.n} <span class="text-[9px] font-normal text-slate-500 ml-1 uppercase">${b.r}</span></p><p class="text-[10px] text-slate-400 mt-1 font-bold italic">æœ¬æ°£æˆ°ç•¥ï¼š${ssZ}</p></div>
              <span class="text-[10px] font-bold px-3 py-1 rounded-lg bg-white/10 tracking-widest">${isRed ? 'ğŸ”´ å£“åŠ›' : 'ğŸŸ¢ ç©©é€²'}</span>
            </div>`;
        });

        // âº å‘½ç›¤åˆ†æï¼šç”¨ C è·¯ç·šè¦å‰‡ç”Ÿæˆæ–‡å­—
        const dmElement = ELEMENTS[dm];
        const profile = buildNarrativeProfile({
          dmElement,
          strategicWx: strategic,
          dominantSS: mSSZ,
          yrSS_G,
          yrSS_Z,
          redMonths: redM
        });
        document.getElementById('analysisBox').innerHTML = `
          <div class="space-y-2">
            ${profile.narrativeLines.map(line => `<p>${line}</p>`).join("")}
          </div>
        `;

        const archetypes = {"å‚·å®˜":"å…§å®¹é©å‘½å®¶","é£Ÿç¥":"ç”Ÿæ´»ç”¢å“ç¶“ç†","æ­£è²¡":"ç²¾æº–åŸ·è¡Œè€…","åè²¡":"è³‡æºæ•´åˆå•†","æ­£å®˜":"ç§©åºå®ˆè­·è€…","ä¸ƒæ®º":"é‚Šéš›ç ´å±€è€…","æ­£å°":"æ™ºæ…§å°å¸«","åå°":"éˆé­‚å¥‡æ‰","æ¯”è‚©":"æ„å¿—å‹æ¨æ‰‹","åŠ«è²¡":"äººè„ˆé–‹æ‹“è€…"};
        const myArch = archetypes[mSSZ] || "å¹³è¡¡è§€å¯Ÿè€…";
        document.getElementById('archetype').innerText = myArch;

        window.shareText = `ã€ä¸€èµ·å‡ºä¾†ç©ã€‚2026 æ·±åº¦æˆ°ç•¥å ±å‘Šã€‘${profile.narrativeLines.join("\n")}`;

        document.getElementById('report').classList.remove('hidden');
        document.getElementById('report').scrollIntoView({ behavior: 'smooth', block: 'start' });
      } catch (e) { console.error(e); alert("è³‡æ–™è¨­å®šæœ‰èª¤ï¼Œè«‹æª¢æŸ¥ã€‚"); }
    }

    function initSelectors() {
      const y = document.getElementById('birthYear'), m = document.getElementById('birthMonth'), d = document.getElementById('birthDay'), h = document.getElementById('birthHour'), min = document.getElementById('birthMinute');
      for (let i = 2026; i >= 1940; i--) { const o = new Option(i + " å¹´", i); if (i === 1990) o.selected = true; y.add(o); }
      for (let i = 1; i <= 12; i++) m.add(new Option(i + " æœˆ", i));
      for (let i = 0; i <= 23; i++) { const o = new Option(String(i).padStart(2, '0') + " æ™‚", i); if (i === 12) o.selected = true; h.add(o); }
      ["00","15","30","45"].forEach(v => min.add(new Option(v + " åˆ†", v)));
      updateDays();
      let c = parseInt(localStorage.getItem('fCount'), 10) || 5001;
      function t() { c += Math.floor(Math.random() * 3) + 1; document.getElementById('userCounter').innerText = c.toLocaleString(); localStorage.setItem('fCount', c); setTimeout(t, 5000); } t();
    }

    function updateDays() {
      const y = parseInt(document.getElementById('birthYear').value, 10), m = parseInt(document.getElementById('birthMonth').value, 10), d = document.getElementById('birthDay');
      const days = new Date(y, m, 0).getDate();
      const cur = d.value; d.innerHTML = '';
      for (let i = 1; i <= days; i++) { const o = new Option(i + " æ—¥", i); if (String(i) === String(cur) || (!cur && i === 1)) o.selected = true; d.add(o); }
    }

    async function copyText() {
      const text = window.shareText || "è«‹å…ˆç”Ÿæˆå ±å‘Šå†è¤‡è£½ã€‚";
      const t = document.getElementById("copyToast");
      try {
        await navigator.clipboard.writeText(text);
        t.classList.remove('opacity-0'); t.classList.add('opacity-100');
        setTimeout(() => { t.classList.add('opacity-0'); t.classList.remove('opacity-100'); }, 2500);
      } catch (e) {
        const el = document.createElement('textarea'); el.value = text; document.body.appendChild(el); el.select();
        try { document.execCommand('copy'); t.classList.remove('opacity-0'); t.classList.add('opacity-100'); setTimeout(() => { t.classList.add('opacity-0'); t.classList.remove('opacity-100'); }, 2500); } 
        catch (e2) { alert("ç€è¦½å™¨ä¸æ”¯æ´è‡ªå‹•è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½å…§å®¹ã€‚"); }
        document.body.removeChild(el);
      }
    }
    document.addEventListener('DOMContentLoaded', initSelectors);
  </script>
</body>
</html>