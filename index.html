<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <meta name="description" content="人生說明書：結合八字五行、紫微斗數與 2026 流月紅綠燈的個人戰略指揮中心，協助你規劃節奏與決策。" />
  <title>人生說明書｜一起出來玩</title>

  <!-- 思源宋體（主標題） -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@600;700;900&display=swap" rel="stylesheet" />

  <!-- Tailwind CDN（開發用） -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --amber-gold: #FFBF00;
      --ghost-blue: #00D2FF;
      --bg-deep: #050505;
      --bg-mid: #1A1A2E;
      --theme-amber: #FFBF00;
      --theme-amber-glow: rgba(255, 191, 0, 0.3);
      --theme-dark-blue: #0A0A16;
      --glass-border: rgba(255, 255, 255, 0.08);
      --vh: 1vh;
    }

    body {
      font-family: 'Noto Serif TC', system-ui, -apple-system, serif;
      background-color: var(--theme-dark-blue);
      color: #fff;
      min-height: 100vh;
      min-height: 100svh;
      min-height: calc(var(--vh, 1vh) * 100);
      position: relative;
      overflow-x: hidden;
      overscroll-behavior-y: none;
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* 專家問卷樣式 */
    .expert-questionnaire-container {
      padding: 1.5rem;
      background: var(--bg-mid);
      border-radius: 0.75rem;
      border: 1px solid var(--glass-border);
    }

    .expert-questionnaire-header h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--theme-amber);
      margin-bottom: 0.5rem;
    }

    .questionnaire-description {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 1rem;
    }

    .progress-container {
      margin-bottom: 1.5rem;
    }

    .progress-bar {
      width: 100%;
      height: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 0.25rem;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--theme-amber);
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .expert-question {
      margin-bottom: 2rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .question-header {
      margin-bottom: 1rem;
    }

    .question-number {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background: var(--theme-amber);
      color: var(--bg-deep);
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 700;
      margin-right: 0.5rem;
    }

    .question-category {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background: rgba(255, 191, 0, 0.2);
      color: var(--theme-amber);
      border-radius: 0.25rem;
      font-size: 0.75rem;
      margin-right: 0.5rem;
    }

    .question-text {
      margin-top: 0.75rem;
      font-size: 1rem;
      line-height: 1.5;
      color: rgba(255, 255, 255, 0.9);
    }

    .question-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .option-label {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .option-label:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 191, 0, 0.3);
    }

    .option-label input:checked + .option-text {
      color: var(--theme-amber);
      font-weight: 600;
    }

    .option-label input:checked ~ .option-label {
      border-color: var(--theme-amber);
      background: rgba(255, 191, 0, 0.1);
    }

    .option-input {
      margin-right: 0.75rem;
      width: 1.25rem;
      height: 1.25rem;
      accent-color: var(--theme-amber);
    }

    .option-text {
      flex: 1;
      font-size: 0.9375rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .expert-questionnaire-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-clear,
    .btn-submit {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-clear {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.8);
    }

    .btn-clear:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-submit {
      background: var(--theme-amber);
      border: 1px solid var(--theme-amber);
      color: var(--bg-deep);
    }

    .btn-submit:hover {
      background: #FFD700;
      border-color: #FFD700;
    }

    /* 經緯度校準樣式 */
    .geolocation-calibration-container {
      padding: 1.5rem;
      background: var(--bg-mid);
      border-radius: 0.75rem;
      border: 1px solid var(--glass-border);
    }

    .geolocation-header h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--theme-amber);
      margin-bottom: 0.5rem;
    }

    .geolocation-description {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 1rem;
    }

    .geolocation-status {
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 0.5rem;
    }

    .status-success {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9375rem;
    }

    .status-source {
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.75rem;
      margin-left: 0.5rem;
    }

    .status-empty {
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.875rem;
      font-style: italic;
    }

    .geolocation-actions {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .btn-browser,
    .btn-manual,
    .btn-clear {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.9);
    }

    .btn-browser:hover,
    .btn-manual:hover {
      background: rgba(255, 191, 0, 0.1);
      border-color: rgba(255, 191, 0, 0.3);
      color: var(--theme-amber);
    }

    .btn-clear {
      background: rgba(255, 0, 0, 0.1);
      border-color: rgba(255, 0, 0, 0.3);
      color: rgba(255, 150, 150, 0.9);
    }

    .btn-clear:hover {
      background: rgba(255, 0, 0, 0.2);
      border-color: rgba(255, 0, 0, 0.5);
    }

    .geolocation-manual-form {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .geolocation-manual-form.hidden {
      display: none;
    }

    .form-row {
      margin-bottom: 1rem;
    }

    .form-row label {
      display: block;
      margin-bottom: 0.5rem;
    }

    .form-row span {
      display: block;
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 0.25rem;
    }

    .form-row input {
      width: 100%;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.5rem;
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9375rem;
    }

    .form-row input:focus {
      outline: none;
      border-color: var(--theme-amber);
      background: rgba(255, 255, 255, 0.08);
    }

    .form-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
    }

    .btn-submit,
    .btn-cancel {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-submit {
      background: var(--theme-amber);
      border: 1px solid var(--theme-amber);
      color: var(--bg-deep);
    }

    .btn-submit:hover {
      background: #FFD700;
      border-color: #FFD700;
    }

    .btn-cancel {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.8);
    }

    .btn-cancel:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .geolocation-error {
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(255, 0, 0, 0.1);
      border: 1px solid rgba(255, 0, 0, 0.3);
      border-radius: 0.5rem;
      color: rgba(255, 150, 150, 0.9);
      font-size: 0.875rem;
    }

    .geolocation-error.hidden {
      display: none;
    }

    /* 核心特效 1：活的星際背景 (The Living Cosmos) */
    body::before {
      content: '';
      position: fixed;
      top: -10%;
      left: -10%;
      width: 120%;
      height: 120%;
      z-index: -2;
      background-image: url('assets/bg-destiny.png');
      background-size: cover;
      background-position: center center;
      background-color: var(--bg-deep);
      filter: brightness(0.7) contrast(1.1);
      animation: cosmic-drift 120s infinite alternate ease-in-out;
      pointer-events: none;
    }
    @keyframes cosmic-drift {
      0% { transform: scale(1) rotate(0deg) translateZ(0); }
      50% { transform: scale(1.08) rotate(2deg) translateZ(0); }
      100% { transform: scale(1) rotate(0deg) translateZ(0); }
    }
    /* 流星動畫 */
    @keyframes meteor-shower {
      0% {
        opacity: 0;
        transform: translateX(-100px) translateY(-100px);
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        opacity: 0;
        transform: translateX(200vw) translateY(200vh);
      }
    }
    .meteor {
      position: fixed;
      width: 2px;
      height: 100px;
      background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.8), transparent);
      box-shadow: 0 0 10px rgba(255, 191, 0, 0.6);
      z-index: -1;
      pointer-events: none;
      animation: meteor-shower 3s linear infinite;
    }
    .meteor:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; animation-duration: 2.5s; }
    .meteor:nth-child(2) { top: 30%; left: 60%; animation-delay: 4s; animation-duration: 3s; }
    .meteor:nth-child(3) { top: 50%; left: 40%; animation-delay: 8s; animation-duration: 2.8s; }
    .meteor:nth-child(4) { top: 70%; left: 80%; animation-delay: 12s; animation-duration: 3.2s; }
    .meteor:nth-child(5) { top: 20%; left: 10%; animation-delay: 16s; animation-duration: 2.6s; }
    /* 星圖網格：opacity 調低至 0.1，避免太明顯 */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        radial-gradient(1.5px 1.5px at 20% 30%, rgba(255,255,255,0.1), transparent),
        radial-gradient(1.5px 1.5px at 60% 70%, rgba(0,210,255,0.06), transparent),
        radial-gradient(2px 2px at 80% 20%, rgba(255,191,0,0.04), transparent);
      background-size: 60px 60px, 90px 90px, 110px 110px;
      z-index: -1;
      pointer-events: none;
      opacity: 0.1;
    }
    /* 星雲氛圍：巨大模糊 radial-gradient 深藍／深紫 */
    .ambient-nebula {
      position: fixed;
      inset: 0;
      z-index: -2;
      pointer-events: none;
      overflow: hidden;
    }
    .ambient-nebula::before,
    .ambient-nebula::after {
      content: '';
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.5;
    }
    .ambient-nebula::before {
      width: 120vmax;
      height: 120vmax;
      top: -40vmax;
      left: -30vmax;
      background: radial-gradient(circle, rgba(30, 20, 80, 0.6) 0%, transparent 50%);
    }
    .ambient-nebula::after {
      width: 100vmax;
      height: 100vmax;
      bottom: -50vmax;
      right: -20vmax;
      background: radial-gradient(circle, rgba(20, 30, 60, 0.5) 0%, transparent 55%);
    }
    body .ambient-nebula-spot {
      position: fixed;
      width: 80vmax;
      height: 80vmax;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: radial-gradient(circle, rgba(40, 25, 70, 0.35) 0%, transparent 60%);
      filter: blur(60px);
      z-index: -2;
      pointer-events: none;
    }

    /* 玻璃擬態：極透明深藍 + blur(12px) + 白邊 + 四角亮點 */
    /* 核心特效 2：頂級玻璃擬態 (Premium Glassmorphism) */
    .glass-container {
      background: rgba(10, 10, 22, 0.3);
      backdrop-filter: blur(16px) saturate(110%);
      -webkit-backdrop-filter: blur(16px) saturate(110%);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      border-left: 1px solid rgba(255, 255, 255, 0.12);
      border-right: 1px solid rgba(255, 255, 255, 0.12);
      border-bottom: 1px solid rgba(0, 0, 0, 0.3);
      border-radius: 24px;
      box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.03), 0 10px 30px -5px rgba(0, 0, 0, 0.5);
      transition: all 0.4s ease;
      animation: float-gentle 7s ease-in-out infinite;
    }
    .glass-container:hover {
      border-top: 1px solid var(--theme-amber-glow);
      box-shadow: inset 0 0 25px rgba(255, 191, 0, 0.08), 0 15px 35px -5px rgba(0, 0, 0, 0.6);
      transform: translateY(-4px);
      animation: float-gentle 5s ease-in-out infinite;
    }

    .glass-hero {
      background: rgba(26, 26, 46, 0.4);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1.5rem;
      box-shadow:
        inset 0 0 0 1px rgba(255, 255, 255, 0.03),
        0 24px 60px rgba(0, 0, 0, 0.4);
      position: relative;
      transition: border-color 0.4s ease, box-shadow 0.4s ease;
    }
    .glass-hero::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      box-shadow:
        inset 2px 2px 0 0 rgba(255, 255, 255, 0.08),
        inset -2px -2px 0 0 rgba(255, 255, 255, 0.06),
        inset 2px -2px 0 0 rgba(255, 255, 255, 0.06),
        inset -2px 2px 0 0 rgba(255, 255, 255, 0.06);
    }
    .glass-hero:hover {
      border-color: rgba(255, 255, 255, 0.15);
      box-shadow:
        inset 0 0 0 1px rgba(255, 255, 255, 0.04),
        0 0 40px rgba(255, 191, 0, 0.06),
        0 24px 60px rgba(0, 0, 0, 0.4);
    }
    .glass-input {
      background: rgba(15, 15, 30, 0.35);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 191, 0, 0.25);
      border-radius: 2rem;
      position: relative;
      box-shadow: 
        0 0 40px rgba(255, 191, 0, 0.15),
        inset 0 0 60px rgba(255, 191, 0, 0.08),
        0 20px 60px rgba(0, 0, 0, 0.4);
      transition: all 0.5s ease;
      animation: float-gentle 6s ease-in-out infinite;
    }
    @keyframes float-gentle {
      0%, 100% { transform: translateY(0px) translateX(0px); }
      50% { transform: translateY(-8px) translateX(4px); }
    }
    .glass-input:hover {
      border-color: rgba(255, 191, 0, 0.5);
      box-shadow: 
        0 0 60px rgba(255, 191, 0, 0.25),
        inset 0 0 80px rgba(255, 191, 0, 0.12),
        0 25px 80px rgba(0, 0, 0, 0.6);
      transform: translateY(-6px);
      animation: float-gentle 4s ease-in-out infinite;
    }
    .glass-input::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      box-shadow:
        inset 2px 2px 0 0 rgba(255, 255, 255, 0.08),
        inset -2px -2px 0 0 rgba(255, 255, 255, 0.06),
        inset 2px -2px 0 0 rgba(255, 255, 255, 0.06),
        inset -2px 2px 0 0 rgba(255, 255, 255, 0.06);
    }
    .glass-input:hover {
      border-color: rgba(255, 255, 255, 0.15);
      box-shadow:
        inset 0 0 0 1px rgba(255, 255, 255, 0.04),
        0 0 36px rgba(0, 210, 255, 0.05),
        0 24px 60px rgba(0, 0, 0, 0.4);
    }

    /* 主標題：linear-gradient 琥珀金→淺金 + drop-shadow 光暈 + 思源宋體 + letter-spacing 0.2em */
    .hero-title {
      font-family: "Noto Serif TC", "Source Han Serif TC", serif;
      font-weight: 700;
      letter-spacing: 0.2em;
      background: linear-gradient(180deg, #FFBF00 0%, #FFD54F 40%, #FFE082 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255, 191, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 191, 0, 0.25));
    }
    .hero-subtitle {
      font-size: 11px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: rgba(0, 210, 255, 0.9);
    }
    .hero-desc {
      color: rgba(226, 232, 240, 0.92);
      font-size: 0.95rem;
      line-height: 1.7;
      letter-spacing: 0.02em;
    }

    /* 金屬質感按鈕：radial-gradient + 光影流動動畫 */
    .btn-strategy,
    .btn-metal {
      position: relative;
      overflow: hidden;
      background: radial-gradient(ellipse 80% 50% at 50% 0%, rgba(255, 215, 0, 0.35), transparent 50%),
                  radial-gradient(ellipse 60% 40% at 50% 100%, rgba(255, 191, 0, 0.2), transparent 45%),
                  radial-gradient(ellipse 100% 100% at 50% 50%, rgba(40, 35, 30, 0.9), rgba(20, 18, 15, 0.95));
      border: 1px solid rgba(255, 191, 0, 0.4);
      color: rgba(255, 230, 180, 0.98);
      font-weight: 800;
      letter-spacing: 0.2em;
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.15),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2),
        0 0 24px rgba(255, 191, 0, 0.2);
      animation: metal-flow 4s ease-in-out infinite;
      transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
    }
    .btn-strategy:hover:not(:disabled),
    .btn-metal:hover {
      border-color: rgba(255, 191, 0, 0.6);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 32px rgba(255, 191, 0, 0.35),
        0 0 48px rgba(255, 191, 0, 0.15);
      transform: translateY(-2px);
    }
    .btn-strategy:disabled {
      animation: none;
      opacity: 0.6;
      cursor: not-allowed;
    }
    .btn-strategy:disabled::before { animation: none; }

    /* 核心特效 3：戰略引擎按鈕 (The Engine Button) */
    .engine-button {
      background: radial-gradient(circle at center, #FFBF00 0%, #D48800 70%, #A66200 100%);
      color: #fff;
      text-shadow: 0 2px 5px rgba(0,0,0,0.4);
      border: none;
      position: relative;
      overflow: hidden;
      z-index: 1;
      box-shadow: 0 0 20px var(--theme-amber-glow), 0 0 40px rgba(255, 191, 0, 0.1);
      transition: all 0.3s ease;
    }
    .engine-button::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 60%);
      opacity: 0;
      animation: pulse-light 3s infinite ease-in-out;
      pointer-events: none;
    }
    @keyframes pulse-light {
      0%, 100% { opacity: 0; transform: scale(0.8); }
      50% { opacity: 0.6; transform: scale(1); }
    }
    .engine-button:hover:not(:disabled) {
      box-shadow: 0 0 30px var(--theme-amber-glow), 0 0 60px rgba(255, 191, 0, 0.3);
      transform: scale(1.02);
      filter: brightness(1.1);
    }
    .engine-button:disabled {
      animation: none;
      opacity: 0.6;
      cursor: not-allowed;
    }
    .engine-button:disabled::after { animation: none; }
    .btn-strategy::before,
    .btn-metal::before {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      border-radius: inherit;
    }
    .btn-strategy::after,
    .btn-metal::after {
      content: '';
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 8px rgba(255, 191, 0, 0.8);
      pointer-events: none;
      opacity: 0;
      animation: sparkle-fly 9s linear infinite;
    }
    .btn-strategy::after {
      animation-delay: 0s;
    }
    .btn-metal::after {
      animation-delay: 3s;
    }
    @keyframes metal-flow {
      0%, 100% { box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), inset 0 -1px 0 rgba(0,0,0,0.2), 0 0 24px rgba(255,191,0,0.2); }
      50% { box-shadow: inset 0 1px 0 rgba(255,255,255,0.18), inset 0 -1px 0 rgba(0,0,0,0.2), 0 0 32px rgba(255,191,0,0.3), 0 0 16px rgba(0,210,255,0.08); }
    }
    @keyframes sparkle-fly {
      0% {
        left: -10px;
        top: 20%;
        opacity: 0;
      }
      5% {
        opacity: 1;
      }
      95% {
        opacity: 1;
      }
      100% {
        left: 110%;
        top: 80%;
        opacity: 0;
      }
    }

    /* 命運座標：水平條狀排列 + 頂級玻璃擬態條（無圓形） */
    .destiny-bar-row {
      display: grid;
      gap: 1rem;
      align-items: stretch;
    }
    .destiny-bar-wrap {
      display: flex;
      align-items: stretch;
      min-width: 0;
    }
    .destiny-select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 100%;
      min-width: 0;
      padding: 0.6rem 2rem 0.6rem 0.85rem;
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 191, 0, 0.3);
      border-radius: 10px;
      color: var(--amber-gold);
      font-size: 0.875rem;
      cursor: pointer;
      box-shadow: inset 0 0 10px rgba(255, 191, 0, 0.1);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23FFBF00' opacity='0.9'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    }
    .destiny-select:hover {
      border-color: rgba(255, 191, 0, 0.5);
      background: rgba(0, 0, 0, 0.5);
      box-shadow: 
        inset 0 0 20px rgba(255, 191, 0, 0.15),
        0 0 20px rgba(255, 191, 0, 0.2),
        0 6px 16px rgba(0, 0, 0, 0.4);
      transform: translateY(-2px);
    }
    .destiny-select:focus {
      outline: none;
      border-color: rgba(255, 191, 0, 0.6);
      box-shadow: 
        inset 0 0 20px rgba(255, 191, 0, 0.18),
        0 0 30px rgba(255, 191, 0, 0.3),
        0 0 0 2px rgba(255, 191, 0, 0.2);
      transform: translateY(-2px);
    }
    .destiny-select option {
      background: #0f0f18;
      color: var(--amber-gold);
    }
    /* 推算時辰按鈕：鮮明設計 */
    .identify-time-btn-enhanced {
      text-sm md:text-base font-bold text-amber-50 bg-gradient-to-r from-amber-600/80 to-amber-500/80 hover:from-amber-500 hover:to-amber-400 border-2 border-amber-400/50 hover:border-amber-300 rounded-xl px-5 py-2.5 transition-all shadow-lg hover:shadow-amber-500/30 hover:scale-105;
    }
    .identify-time-btn {
      padding: 0.875rem 2rem;
      font-size: 1rem;
      font-weight: 800;
      letter-spacing: 0.08em;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      background: linear-gradient(135deg, rgba(255, 191, 0, 0.95) 0%, rgba(255, 140, 0, 0.9) 50%, rgba(255, 191, 0, 0.95) 100%);
      border: 2px solid rgba(255, 191, 0, 0.7);
      border-radius: 1rem;
      box-shadow: 
        0 6px 20px rgba(255, 191, 0, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.3),
        0 0 30px rgba(255, 191, 0, 0.3),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .identify-time-btn::before {
      content: '';
      position: absolute;
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 0 6px rgba(255, 191, 0, 0.9);
      pointer-events: none;
      opacity: 0;
      animation: sparkle-fly-btn 9s linear infinite;
    }
    .identify-time-btn:hover {
      transform: translateY(-3px) scale(1.08);
      background: linear-gradient(135deg, rgba(255, 191, 0, 1) 0%, rgba(255, 140, 0, 0.95) 50%, rgba(255, 191, 0, 1) 100%);
      border-color: rgba(255, 191, 0, 0.9);
      box-shadow: 
        0 8px 25px rgba(255, 191, 0, 0.5),
        inset 0 2px 6px rgba(255, 255, 255, 0.4),
        0 0 40px rgba(255, 191, 0, 0.4),
        inset 0 -2px 6px rgba(0, 0, 0, 0.2);
    }
    @keyframes sparkle-fly-btn {
      0% {
        left: -5px;
        top: 30%;
        opacity: 0;
      }
      5% {
        opacity: 1;
      }
      95% {
        opacity: 1;
      }
      100% {
        left: 105%;
        top: 70%;
        opacity: 0;
      }
    }
    .identify-time-btn:active {
      transform: translateY(-1px) scale(1.05);
      box-shadow: 
        0 4px 15px rgba(255, 191, 0, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.3);
    }

    .glass{
      background: rgba(15,23,42,0.88);
      backdrop-filter: blur(18px);
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 24px 60px rgba(15,23,42,0.85);
      border-radius: 1.25rem;
    }
    .section-subtitle{
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #94a3b8;
    }
    .nav-bar {
      background: linear-gradient(90deg, rgba(26,26,46,0.95), rgba(10,10,20,0.98));
      backdrop-filter: blur(12px);
      color: #fff;
      padding: 10px 16px;
      position: sticky;
      top: 0;
      z-index: 60;
      border-bottom: 1px solid rgba(255,191,0,0.12);
      box-shadow: 0 4px 24px rgba(0,0,0,0.4);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .nav-chip {
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,191,0,0.2);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 800;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: rgba(226,232,240,0.95);
      transition: transform 0.25s ease, background 0.25s ease, border-color 0.25s ease, box-shadow 0.25s ease;
      user-select: none;
    }
    .nav-chip:hover,
    .nav-chip:active,
    .nav-chip[aria-current="page"] {
      color: rgb(245 158 11);
      border-color: rgba(245, 158, 11, 0.6);
      box-shadow: 0 0 12px rgba(245, 158, 11, 0.2);
    }
    .nav-chip:hover {
      transform: translateY(-1px);
      background: rgba(255,191,0,0.12);
    }
    .nav-chip:active {
      background: rgba(255,191,0,0.18);
    }
    .nav-chip[aria-current="page"] {
      background: rgba(255,191,0,0.15);
    }
    /* 首頁圖標按鈕樣式 */
    .nav-chip-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      background: rgba(255,191,0,0.15);
      border: 1px solid rgba(255,191,0,0.3);
      border-radius: 50%;
      color: rgba(255,191,0,0.9);
      transition: transform 0.25s ease, background 0.25s ease, border-color 0.25s ease;
      user-select: none;
    }
    .nav-chip-icon:hover {
      transform: translateY(-1px) scale(1.05);
      background: rgba(255,191,0,0.25);
      border-color: rgba(255,191,0,0.5);
    }
    .nav-chip-icon:active {
      transform: translateY(0) scale(0.98);
    }
    .nav-chip-icon svg {
      display: block;
    }
    /* 圓形 Logo 按鈕樣式 */
    .nav-chip-logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 50%;
      transition: transform 0.25s ease;
      user-select: none;
      overflow: hidden;
    }
    .nav-chip-logo:hover {
      transform: translateY(-1px) scale(1.05);
    }
    .nav-chip-logo:active {
      transform: translateY(0) scale(0.98);
    }
    .nav-chip-logo .logo-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    /* 諮詢鏈接醒目樣式 */
    .nav-chip-consult {
      background: rgba(255,191,0,0.25) !important;
      border-color: rgba(255,191,0,0.6) !important;
      color: rgb(255,191,0) !important;
      font-weight: 900 !important;
      box-shadow: 0 0 16px rgba(255,191,0,0.3) !important;
    }
    .nav-chip-consult:hover {
      background: rgba(255,191,0,0.35) !important;
      border-color: rgba(255,191,0,0.8) !important;
      box-shadow: 0 0 20px rgba(255,191,0,0.4) !important;
      transform: translateY(-2px) scale(1.05);
    }
    .nav-chip-consult[aria-current="page"] {
      background: rgba(255,191,0,0.4) !important;
      border-color: rgba(255,191,0,0.9) !important;
      box-shadow: 0 0 24px rgba(255,191,0,0.5) !important;
    }

    /* 主儀表板：卡片依序登場（stagger），僅首次進入時播放 */
    @keyframes dashboard-card-enter {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    #system.dashboard-enter .dashboard-card {
      animation: dashboard-card-enter 0.35s ease-out forwards;
    }
    #system.dashboard-enter .dashboard-card { opacity: 0; }

    /* 戰略維度切換：內容區塊淡入淡出 */
    .dashboard-content-transition {
      transition: opacity 0.2s ease;
    }
    .dashboard-content-transition.dashboard-content-fade {
      opacity: 0;
    }

    @media (prefers-reduced-motion: reduce) {
      #system.dashboard-enter .dashboard-card {
        animation: none;
        opacity: 1;
        transform: none;
      }
      .dashboard-content-transition {
        transition-duration: 0.05s;
      }
    }

    .bazi-char{
      font-size: 1.9rem;
      font-weight: 900;
      line-height: 1.05;
      letter-spacing: .08em;
    }

    /* 五行 bar 顏色 */
    .wuxing-木{background:#22c55e}
    .wuxing-火{background:#ef4444}
    .wuxing-土{background:#eab308}
    .wuxing-金{background:#e5e7eb}
    .wuxing-水{background:#3b82f6}

    /* 五行 bar 動畫 */
    .wx-row{
      opacity: 0;
      animation: fadeInUp 0.35s ease-out forwards;
    }
    .wx-bar-inner{
      transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    /* 伯彥戰略看板：精簡四行，手機一屏看完 */
    .boyan-board { max-width: 22em; }
    .boyan-attr, .boyan-highlight, .boyan-risk { font-size: 11px; line-height: 1.5; }
    .boyan-push { font-size: 11px; margin-top: 0.25rem; }
    @media (max-width: 767px) {
      .boyan-board { padding-bottom: 0.5rem; }
      .wuxing-line { margin-bottom: 0.5em; line-height: 1.6; max-width: 20em; }
    }
    /* 流月：MonthlyFlowCard 年度賽季導航、能量條、狀態標籤、展開區 */
    .liuyue-nav { scroll-behavior: smooth; }
    .liuyue-month-wrap { margin-bottom: 0.5rem; }
    .liuyue-card.monthly-flow-card { transition: background 0.2s, border-color 0.2s; border-radius: 0.75rem; }
    .liuyue-card.monthly-flow-card.is-current { border-color: rgba(255, 191, 0, 0.5); background: rgba(255, 191, 0, 0.08); box-shadow: 0 0 0 1px rgba(255, 191, 0, 0.2); }
    .liuyue-energy-bar { height: 6px; border-radius: 999px; overflow: hidden; background: rgba(255,255,255,0.08); border: 1px solid rgba(255, 191, 0, 0.12); }
    .liuyue-energy-fill { height: 100%; border-radius: 999px; transition: width 0.3s; min-width: 2%; }
    .liuyue-badge { white-space: nowrap; }
    .liuyue-badge-high { border-color: rgba(251, 191, 36, 0.5); background: rgba(251, 191, 36, 0.12); color: #fcd34d; }
    .liuyue-badge-cai { border-color: rgba(255, 191, 0, 0.4); background: rgba(255, 191, 0, 0.08); color: #fde047; }
    .liuyue-expand { overflow: hidden; transition: max-height 0.3s ease-out; }
    @keyframes fadeInUp{
      from{ opacity:0; transform: translateY(4px); }
      to{ opacity:1; transform: translateY(0); }
    }

    /* 星曜五行顏色 */
    .star-wx-木 { color: #86efac; text-shadow: 0 0 5px rgba(34,197,94,0.5); }
    .star-wx-火 { color: #fca5a5; text-shadow: 0 0 5px rgba(239,68,68,0.5); }
    .star-wx-土 { color: #fde047; text-shadow: 0 0 5px rgba(234,179,8,0.5); }
    .star-wx-金 { color: #e2e8f0; text-shadow: 0 0 5px rgba(255,255,255,0.5); }
    .star-wx-水 { color: #93c5fd; text-shadow: 0 0 5px rgba(59,130,246,0.5); }

    /* 紫微 12 宮格 */
    .zw-grid-container{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 8px;
      width: 100%;
      max-width: 540px;
      aspect-ratio: 1/1;
      margin: 0 auto;
    }
    .zw-palace{
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      border-radius: 0.85rem;
      padding: 8px;
      display:flex;
      flex-direction: column;
      position: relative;
      overflow:hidden;
      cursor:pointer;
      transition: transform 0.22s ease, border-color 0.22s ease, box-shadow 0.22s ease, background 0.22s ease;
    }
    .zw-palace:hover{
      transform: translateY(-2px);
      border-color: rgba(248,250,252,0.85);
      box-shadow: 0 10px 30px rgba(15,23,42,0.7);
    }

    /* 宮位主題發光 */
    .zw-palace::before{
      content:'';
      position:absolute;
      top:50%; left:50%;
      width:150%; height:150%;
      transform: translate(-50%, -50%);
      opacity:0;
      transition: opacity 0.5s ease;
      z-index:-1;
      pointer-events:none;
    }
    [class*="palace-glow-"]::before{ opacity:1; }
    .palace-glow-木::before { background: radial-gradient(circle, rgba(34,197,94,0.18) 0%, transparent 70%); }
    .palace-glow-火::before { background: radial-gradient(circle, rgba(239,68,68,0.20) 0%, transparent 70%); }
    .palace-glow-土::before { background: radial-gradient(circle, rgba(234,179,8,0.20) 0%, transparent 70%); }
    .palace-glow-金::before { background: radial-gradient(circle, rgba(248,250,252,0.18) 0%, transparent 70%); }
    .palace-glow-水::before { background: radial-gradient(circle, rgba(59,130,246,0.20) 0%, transparent 70%); }

    .zw-palace-key{
      border-color: rgba(251, 191, 36, 0.75);
      box-shadow: inset 0 0 16px rgba(251,191,36,0.22);
    }

    /* 三方四正互動高亮 */
    .zw-palace.is-active{
      border-color:#fbbf24 !important;
      box-shadow: 0 0 0 2px rgba(251,191,36,0.25), 0 16px 44px rgba(251,191,36,0.12);
      transform: scale(1.03);
      z-index: 30;
    }
    .zw-palace.is-related{
      border-color: rgba(251,191,36,0.30);
      background: rgba(251,191,36,0.06);
    }

    /* 小限命宮：金黃色發光邊框（作戰版科技感） */
    .zw-palace.is-active-limit{
      border-color: rgba(251,191,36,0.85);
      box-shadow: 0 0 0 2px rgba(251,191,36,0.4), 0 0 24px rgba(251,191,36,0.25);
    }
    .zw-palace.is-active-limit::before{
      opacity: 1;
      background: radial-gradient(circle, rgba(251,191,36,0.18) 0%, transparent 70%);
    }

    /* 四化 Badge：祿紅 / 權紫 / 科綠 / 忌灰 */
    .zw-badge{ display: inline-block; font-size: 10px; padding: 0 4px; border-radius: 4px; margin-left: 2px; font-weight: 700; }
    .zw-badge-lu{ background: rgba(239,68,68,0.55); color: #fecaca; }
    .zw-badge-quan{ background: rgba(147,51,234,0.55); color: #e9d5ff; }
    .zw-badge-ke{ background: rgba(34,197,94,0.5); color: #bbf7d0; }
    .zw-badge-ji{ background: rgba(100,116,139,0.6); color: #cbd5e1; }

    .zw-center-block{
      grid-area: 2 / 2 / 4 / 4;
      background: radial-gradient(circle, #1e293b 35%, #020617 100%);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      border-radius: 1.1rem;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      padding: 12px;
      z-index: 10;
    }

    /* 小圓點 */
    .month-dot{ width:6px; height:6px; border-radius:999px; display:inline-block; margin-right:6px; }
    .bg-red-light{ background:#ef4444; box-shadow:0 0 8px rgba(239,68,68,0.8); }
    .bg-green-light{ background:#10b981; box-shadow:0 0 8px rgba(16,185,129,0.8); }

    /* 讓 anchor 不被 sticky nav 遮到 */
    section{ scroll-margin-top: 84px; }

    @media (max-width: 420px){
      .bazi-char{ font-size: 1.6rem; }
      .zw-palace div{ font-size: 11px; }
    }

    /* ===== 手機版：宮位詳解 Bottom Sheet ===== */
    .palace-sheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      max-height: 80vh;
      max-height: 80svh;
      max-height: calc(var(--vh, 1vh) * 80);
      background: rgba(15,23,42,0.98);
      border-radius: 1.25rem 1.25rem 0 0;
      box-shadow: 0 -20px 40px rgba(0,0,0,0.7);
      transform: translateY(100%);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.25s ease-out, opacity 0.2s ease-out;
      padding: 12px 16px 24px;
      z-index: 50;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .palace-sheet.open {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }
    .palace-sheet-handle {
      width: 40px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148,163,184,0.7);
      margin: 0 auto 8px;
    }
    .palace-sheet-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
    }
    .palace-sheet-close {
      font-size: 11px;
      color: #fbbf24;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1.5px solid rgba(251,191,36,0.5);
      background: rgba(251,191,36,0.15);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .palace-sheet-close:hover {
      background: rgba(251,191,36,0.25);
      border-color: rgba(251,191,36,0.7);
      color: #fcd34d;
    }
    .palace-sheet-close:active {
      transform: scale(0.95);
    }

    /* 右側面板快速定位高亮 */
    .peek-highlight{
      border-color: rgba(251,191,36,0.75) !important;
      box-shadow: 0 0 0 2px rgba(251,191,36,0.18), 0 16px 44px rgba(251,191,36,0.10);
      transition: box-shadow .2s ease, border-color .2s ease;
    }

    /* 手機限定顯示 Bottom Sheet（1280px 以上隱藏） */
    @media (min-width: 1280px){
      .palace-sheet,
      #palaceSheetBackdrop {
        display: none !important;
      }
    }

    /* 座標鎖定儀式：全螢幕半透明遮罩 + 中央琥珀光擴張 */
    #ceremonyBackdrop.ceremony-visible,
    #ceremonyModal.ceremony-visible {
      display: flex !important;
    }
    #ceremonyModal.ceremony-visible {
      pointer-events: auto;
    }
    .ceremony-glow::before {
      content: '';
      position: absolute;
      width: 20vmin;
      height: 20vmin;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 191, 0, 0.85) 0%, rgba(255, 191, 0, 0.4) 35%, rgba(255, 191, 0, 0.1) 55%, transparent 70%);
      animation: ceremony-glow-expand 2.5s ease-out forwards;
      pointer-events: none;
    }
    @keyframes ceremony-glow-expand {
      0% {
        transform: scale(0.3);
        opacity: 0.6;
      }
      100% {
        transform: scale(12);
        opacity: 0.35;
      }
    }

    /* LINE / 行動端：全頁與彈窗 SafeArea，避免被系統 UI 遮擋 */
    .safe-area-top { padding-top: env(safe-area-inset-top); }
    .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    #identifyBirthTimeModal .p-5 { padding-top: max(1.25rem, env(safe-area-inset-top)); padding-bottom: max(1.5rem, env(safe-area-inset-bottom)); }
    #ceremonyModal.ceremony-visible { padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }
    .palace-sheet { padding-bottom: max(24px, env(safe-area-inset-bottom)); }

    /* md 以下隱藏右側詳解欄，主內容不預留 margin */
    @media (max-width: 767px) {
      #detailPanel { display: none !important; }
      #dashboardMainContent { grid-template-columns: 1fr; }
    }

    /* 行動端 BottomNav（md 以下顯示） */
    .bottom-nav {
      display: none;
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 45;
      background: rgba(10,10,22,0.95);
      border-top: 1px solid rgba(255,191,0,0.15);
      padding: 8px 12px env(safe-area-inset-bottom) 12px;
      padding-bottom: max(8px, env(safe-area-inset-bottom));
    }
    @media (max-width: 767px) {
      body.dashboard-visible .bottom-nav { display: flex; align-items: center; justify-content: space-around; gap: 4px; }
    }
    .bottom-nav a {
      flex: 1;
      text-align: center;
      font-size: 11px;
      font-weight: 800;
      letter-spacing: .05em;
      color: rgba(226,232,240,0.9);
      padding: 8px 6px;
      border-radius: 999px;
      text-decoration: none;
      transition: background 0.2s, color 0.2s;
    }
    .bottom-nav a:hover, .bottom-nav a:active { background: rgba(255,191,0,0.12); color: rgb(245,158,11); }
    .bottom-nav .feedback-bottom-link {
      flex: 0 0 auto;
      min-width: 60px;
    }

    /* LINE 內建瀏覽器：停用 backdrop-blur 以維持 60fps */
    body.line-browser .glass,
    body.line-browser .glass-container,
    body.line-browser .glass-hero,
    body.line-browser .glass-input { backdrop-filter: none; -webkit-backdrop-filter: none; }
  </style>
</head>

<body class="pb-20">
  <div class="ambient-nebula" aria-hidden="true"></div>
  <div class="ambient-nebula-spot" aria-hidden="true"></div>
  <!-- 流星效果 -->
  <div class="meteor" aria-hidden="true"></div>
  <div class="meteor" aria-hidden="true"></div>
  <div class="meteor" aria-hidden="true"></div>
  <div class="meteor" aria-hidden="true"></div>
  <div class="meteor" aria-hidden="true"></div>

  <!-- TOP NAV -->
  <div class="nav-bar flex items-center justify-between gap-3">
    <div class="flex items-center gap-2">
      <div class="text-sm md:text-base font-bold text-amber-300">人生說明書</div>
      <a href="#" id="homeButton" class="nav-chip-icon" aria-label="回到首頁" title="回到首頁">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      </a>
      <a href="activity-213.html" class="nav-chip bg-amber-500/20 border-amber-300/40 text-amber-100" aria-label="2/13 活動報名">2/13 活動</a>
    </div>

    <!-- workspace nav (only after system entered) -->
    <div id="workspaceNav" class="hidden md:flex items-center gap-2">
      <a class="nav-chip" href="#ws-ziwei">紫微</a>
      <a class="nav-chip" href="#ws-bazi">八字</a>
      <a class="nav-chip" href="#ws-liuyue">流年</a>
      <a class="nav-chip nav-chip-consult" href="#ws-consult">諮詢</a>
    </div>

    <div class="flex items-center gap-2">
      <a href="https://www.facebook.com/bill17gonplay/" target="_blank" rel="noopener noreferrer"
         class="nav-chip-logo"
         aria-label="前往李伯彥 Facebook（一起出來玩）"
         title="Facebook">
        <img src="assets/logo-circle.png" alt="一起出來玩" class="logo-img">
      </a>
    </div>
  </div>

  <main class="max-w-7xl mx-auto px-4 pt-6 space-y-8">

    <!-- 命運座標輸入（條狀排列 + 頂級玻璃擬態，保留原有 id 與邏輯） -->
    <section id="inputCard" class="glass-container glass-input p-8 md:p-12 max-w-3xl mx-auto space-y-8">
      <div class="text-center mb-6">
        <h2 class="text-2xl md:text-3xl font-black text-amber-300 mb-2 tracking-wider">命運座標輸入</h2>
        <p class="text-sm md:text-base text-slate-400 italic">輸入你的出生資訊，開啟專屬的人生使用說明書</p>
      </div>

      <!-- 第一行：年、月、日 -->
      <div class="destiny-bar-row grid-cols-3">
        <div class="destiny-bar-wrap"><select id="birthYear" class="destiny-select" aria-label="年"></select></div>
        <div class="destiny-bar-wrap"><select id="birthMonth" class="destiny-select" aria-label="月"></select></div>
        <div class="destiny-bar-wrap"><select id="birthDay" class="destiny-select" aria-label="日"></select></div>
      </div>
      <!-- 第二行：性別、粗略時間 -->
      <div class="destiny-bar-row grid-cols-2">
        <div class="destiny-bar-wrap"><select id="timeMode" class="destiny-select" aria-label="時間模式"></select></div>
        <div class="destiny-bar-wrap"><select id="gender" class="destiny-select" aria-label="性別"></select></div>
      </div>
      <div class="flex flex-wrap items-center gap-3 pt-2">
        <span class="text-base md:text-lg font-bold text-amber-300/90">不確定出生時間？</span>
        <button type="button" id="btnIdentifyBirthTimeGlobal" class="identify-time-btn">
          點我推算時辰
        </button>
      </div>

      <!-- 第三行：精確時、分 -->
      <div id="exactTimeRow" class="destiny-bar-row grid-cols-2">
        <div class="destiny-bar-wrap"><select id="birthHour" class="destiny-select" aria-label="時"></select></div>
        <div class="destiny-bar-wrap"><select id="birthMinute" class="destiny-select" aria-label="分"></select></div>
      </div>

      <div id="shichenRow" class="hidden space-y-4">
        <div class="destiny-bar-row grid-cols-2">
          <div class="destiny-bar-wrap"><select id="birthShichen" class="destiny-select" aria-label="時辰"></select></div>
          <div class="destiny-bar-wrap"><select id="birthShichenHalf" class="destiny-select" aria-label="上半/下半"></select></div>
        </div>
        <div class="flex justify-center">
          <button id="btnIdentifyBirthTime" type="button" class="identify-time-btn-enhanced">
            不確定時辰？點我推算時辰
          </button>
        </div>
        <p class="text-[11px] text-slate-500 text-center">註：選「時辰」會換算成代表時刻（上半/下半時辰各取代表時間）送入系統計算。</p>
      </div>

      <div class="pt-4">
        <button id="btnLaunch" type="button"
          class="engine-button w-full py-5 rounded-2xl text-base md:text-lg font-black tracking-wider disabled:opacity-60 disabled:cursor-not-allowed">
          開啟 人生使用說明書
        </button>
      </div>

      <div id="hint" class="text-center text-xs text-slate-400 italic min-h-[1.2em]"></div>
    </section>

    <!-- 一起出來玩夥伴聚會（2/13 活動預告，報名請至獨立活動頁） -->
    <section id="activity-213" class="glass-container glass-hero p-6 md:p-8 max-w-2xl mx-auto space-y-4 scroll-mt-24">
      <div class="text-center">
        <p class="text-amber-400 font-black text-sm tracking-widest">一起出來玩夥伴聚會</p>
        <h2 class="text-xl md:text-2xl font-black text-amber-300 mt-1">如何玩好人生遊戲</h2>
        <p class="text-slate-400 text-sm mt-2">2/13 週五晚上 18:30–21:30（18:00 可進場）</p>
      </div>
      <div class="text-slate-200 text-sm leading-relaxed space-y-3">
        <p>為您揭開人生這場遊戲的真實面貌，讓您知道這個遊戲的前因後果、破關關鍵，還有專屬於您的通關密碼。</p>
        <p>在這場說明會之後，你會對自己人生的過去、現在、未來，有更充足的理解，都能在未來的人生路上，提升自我，與我們一起實現自己的志願。</p>
        <p class="text-amber-300 font-bold">一起出來玩吧！祝福你。</p>
      </div>
      <div class="text-center pt-2">
        <a href="activity-213.html" class="engine-button inline-flex items-center justify-center px-8 py-4 rounded-2xl text-sm font-black tracking-[0.2em]">
          活動報名
        </a>
      </div>
    </section>

    <!-- SYSTEM WORKSPACES -->
    <section id="system" class="hidden space-y-8">

      <!-- TOP SUMMARY BAR (after computed) -->
      <section id="ws-summary" class="glass dashboard-card p-6 md:p-7">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <div class="section-subtitle mb-1">Command Summary</div>
            <div class="text-lg md:text-xl font-black">
              <span id="summaryBirth" class="text-slate-200"></span>
            </div>
            <div class="text-xs text-slate-400 mt-1">
              日主：<span class="font-bold text-amber-300" id="summaryDM">—</span>
              ｜十神主軸：<span class="font-bold text-amber-300" id="summaryDominant">—</span>
              ｜壓力月：<span class="font-bold text-red-300" id="summaryRedMonths">—</span>
            </div>
          </div>

        </div>
      </section>

      <div id="dashboardMainContent" class="grid xl:grid-cols-[1fr,440px] gap-8 dashboard-content-transition">

        <!-- LEFT WORKSPACES -->
        <div class="space-y-8">

          <!-- 紫微 -->
          <section id="ws-ziwei" class="glass dashboard-card p-6 md:p-7 space-y-4">
            <div class="flex flex-wrap items-start justify-between gap-3">
              <div>
                <div class="section-subtitle mb-1">ZiWei DouShu</div>
                <h2 class="text-xl font-black tracking-tight">紫微 12 宮 · 作戰版方盤</h2>
                <p class="text-xs text-slate-400 mt-1" id="ziweiMeta">
                  命宮與身主會顯示在中央；外圈 12 宮固定佈局，與主流排盤方向一致。
                </p>
              </div>
              <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 min-w-0">
                <label for="currentAgeSlider" class="text-[10px] font-black tracking-widest text-slate-500 uppercase">小限動態導覽</label>
                <div class="flex items-center gap-3 flex-1">
                  <input type="range" id="currentAgeSlider" min="1" max="120" value="38" class="flex-1 h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-amber-500" title="虛歲，拖曳可即時更新小限宮位與四化" />
                  <output id="currentAgeDisplay" class="text-sm font-mono font-black text-amber-400 tabular-nums w-10 text-right">38</output>
                  <span class="text-xs text-slate-500">歲</span>
                </div>
              </div>
            </div>

            <div id="ziweiGrid" class="zw-grid-container"></div>

            <div class="text-xs text-slate-400" id="ziweiHint"></div>

            <!-- 紫微分數 -->
            <section id="ws-ziwei-scores" class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="rounded-xl border border-white/10 p-4">
                <div class="text-xs font-semibold text-slate-200 mb-2">宮位強度</div>
                <div id="ziweiPalaceScores"></div>
              </div>
              <div class="rounded-xl border border-white/10 p-4">
                <div class="text-xs font-semibold text-slate-200 mb-2">紫微五行比例</div>
                <div id="ziweiWuxingScores">
                  <div class="space-y-3">
                    <div id="ziweiWxBars"></div>

                    <div class="text-[11px] font-black tracking-widest text-slate-400">
                      紫微 —— 這關好過嗎？
                    </div>
                    <div id="ziweiWxRadar" class="w-full max-w-[260px]"></div>
                    <div id="ziweiWxComment" class="text-[11px] text-slate-300 leading-relaxed"></div>
                  </div>
                </div>
              </div>
            </section>
          </section>

          <!-- 八字五行 -->
          <section id="ws-bazi" class="glass dashboard-card p-6 md:p-7 space-y-6">
            <div>
              <div class="section-subtitle mb-1">BaZi + Elements</div>
              <h2 class="text-xl font-black tracking-tight">八字 · 四柱＋五行戰力</h2>
              <p class="text-xs text-slate-400 mt-1">
                上方顯示「四柱」，下方顯示「表層（天干）」與「實戰（天干＋藏干＋月令加權）」。
                右側會附上五行意義（資料庫：wuxing_meanings）。
              </p>
            </div>

            <!-- 四柱 -->
            <div class="grid grid-cols-4 gap-2 text-center" id="pillarsGrid"></div>

            <!-- 藏干 -->
            <div class="space-y-3">
              <div class="text-xs text-slate-400">
                地支藏干（權重顯示）：<span class="text-slate-500">（用來理解你「實戰五行」的來源）</span>
              </div>
              <div id="cangganGrid" class="grid md:grid-cols-2 gap-2"></div>
            </div>

            <!-- 五行 bar -->
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <div class="text-xs text-slate-400 mb-2">表層結構（四柱天干）</div>
                <div class="space-y-3">
                  <div id="surfaceWxBars" class="space-y-2"></div>
                  <div class="text-[11px] font-black tracking-widest text-slate-400">
                    角色名望（八字表層）—— 看起來強嗎？
                  </div>
                  <div id="surfaceWxRadar" class="w-full max-w-[260px]"></div>
                  <div id="surfaceWxComment" class="text-[11px] text-slate-300 leading-relaxed"></div>
                </div>
              </div>
              <div>
                <div class="text-xs text-slate-400 mb-2">實戰結構（天干＋藏干＋月令加權）</div>
                <div class="space-y-3">
                  <div id="strategicWxBars" class="space-y-2"></div>
                  <div class="text-[11px] font-black tracking-widest text-slate-400">
                    核心戰力（八字實戰）—— 真的能贏嗎？
                  </div>
                  <div id="strategicWxRadar" class="w-full max-w-[260px]"></div>
                  <div id="strategicWxComment" class="text-[11px] text-slate-300 leading-relaxed"></div>
                </div>
              </div>
            </div>

            <!-- 十神指令（已移除：避免與上方 Summary 的「十神主軸」重複） -->
          </section>

          <!-- 流月：年度賽季導航（單一垂直列表，可展開詳情） -->
          <section id="ws-liuyue" class="glass dashboard-card p-6 md:p-7 space-y-4">
            <div>
              <div class="section-subtitle mb-1">2026 年度賽季導航</div>
              <h2 class="text-xl font-black tracking-tight">流月戰略（12）</h2>
              <p class="text-xs text-slate-400 mt-1">點月份卡片展開十神參數與李伯彥助推建議</p>
            </div>
            <div id="monthGrid" class="space-y-2 max-h-[70vh] overflow-y-auto liuyue-nav"></div>
            <div id="liuyueConsultCta" class="pt-4 border-t border-white/10"></div>
          </section>

          <!-- 戰略面板、諮詢 CTA -->
          <!-- ... 保持不變 ... -->

          <section id="ws-strategy" class="glass dashboard-card p-6 md:p-7 space-y-4">
            <div>
              <div class="section-subtitle mb-1">Strategic Panel</div>
              <h2 class="text-xl font-black tracking-tight">2026 戰術建議（動態決策）</h2>
              <p class="text-xs text-slate-400 mt-1">
                依「五行佔比」＋「十神主軸」給你今年的戰術提示（前端即時計算；解釋文字優先吃資料庫）。
              </p>
            </div>

            <div id="tacticalBox" class="space-y-2"></div>

            <div class="text-[11px] text-slate-500">
              註：這段是「指揮中心的戰術提示」，宮位詳解請點紫微方盤。
            </div>
          </section>

          <section id="ws-consult" class="glass dashboard-card p-7 md:p-9 space-y-6 text-center border border-amber-400/40">
            <div>
              <h2 class="text-2xl md:text-4xl font-black text-amber-400 tracking-tight">✨ 別讓你的初始設定，限制了你的一生。</h2>
            </div>
            <p class="text-slate-300 max-w-2xl mx-auto leading-relaxed text-sm md:text-base">
              李伯彥老師 深度諮詢：帶你看清雷區、找回主場、實現自己的志願。諮詢後提供保用一生的 50 頁個人戰略手冊，照亮眼前的路。
            </p>
            <div class="space-y-2">
              <a href="consultation.html"
                 class="inline-flex items-center justify-center px-8 py-4 rounded-2xl bg-gradient-to-r from-amber-600 via-amber-500 to-amber-700 text-slate-950 font-black tracking-widest hover:brightness-110 active:scale-[0.98] transition shadow-xl shadow-amber-900/30">
                預約深度諮詢
              </a>
              <p class="text-[10px] text-slate-500 italic">— 這是這輩子最值得的一場投資 —</p>
            </div>
          </section>

          <div class="text-center text-[12px] text-slate-400 italic">
            「裝備（表層）決定你的起點，戰力（實戰）決定你的終點。」
          </div>

        </div>

        <!-- RIGHT DETAIL PANEL（桌機用；md 以下隱藏，改由 BottomNav + 宮位 Bottom Sheet） -->
        <aside class="space-y-6 dashboard-right-sidebar" id="detailPanel">
          <div class="glass dashboard-card p-6 md:p-7 sticky top-24 border border-amber-500/30 overflow-y-auto max-h-[85vh]">
            <div class="section-subtitle mb-2">Palace Detail</div>
            <div id="palaceTitle" class="text-3xl font-black text-amber-400">請點宮位</div>
            <div id="palaceSub" class="text-xs text-slate-400 mt-2 leading-relaxed"></div>

            <div class="mt-6 space-y-6" id="palaceDetailBody">
              <div class="text-center py-10 text-slate-500 italic text-sm">點擊紫微方盤的任一宮位，這裡會顯示詳解。</div>
            </div>

            <!-- 流月改為左側單一導航，右側不再重複 -->
          </div>

            <div id="wuxingMeaningSection" class="glass dashboard-card p-6 border border-white/10">
            <div class="section-subtitle mb-2">Five Elements Meanings</div>
            <div class="font-black text-lg">金木水火土 · 基本意義</div>
            <div class="text-xs text-slate-400 mt-1">（內容優先來自資料庫：wuxing_meanings；若無則顯示預設）</div>
            <div id="wuxingMeaningBox" class="mt-4 space-y-3"></div>
          </div>

        </aside>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="text-center py-8 px-4 border-t border-white/10 mt-12">
    <div class="font-black tracking-[0.22em] text-sm uppercase text-amber-400 mb-2">一起出來玩</div>
    <div class="text-xs text-slate-400">17gonplay</div>
  </footer>

  <!-- 行動端 BottomNav（md 以下且已進入儀表板時顯示） -->
  <nav class="bottom-nav" aria-label="戰略導航">
    <a href="#ws-ziwei">紫微</a>
    <a href="#ws-bazi">八字</a>
    <a href="#ws-liuyue">流年</a>
    <a href="#ws-consult">諮詢</a>
  </nav>

  <!-- 不確定時辰？問卷 Modal（一題一題顯示 + 進度條） -->
  <div id="identifyBirthTimeBackdrop" class="fixed inset-0 bg-black/70 hidden z-50" aria-hidden="true"></div>
  <div id="identifyBirthTimeModal" class="identify-time-modal fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[90vw] max-w-md max-h-[85vh] overflow-y-auto rounded-2xl border border-amber-400/30 bg-[var(--bg-mid)] shadow-2xl hidden z-50" role="dialog" aria-labelledby="identifyBirthTimeTitle" aria-modal="true">
    <div class="p-5 md:p-6">
      <h2 id="identifyBirthTimeTitle" class="text-lg font-black text-amber-400 mb-1">不確定時辰？</h2>
      <p class="text-[11px] text-slate-400 mb-3">依行為特徵推算候選時辰，答完將自動填入排盤表單。</p>
      <div id="identifyBirthTimeProgressWrap" class="mb-4">
        <div class="flex justify-between text-[11px] text-slate-500 mb-1">
          <span id="identifyBirthTimeProgressText">第 1 / 19 題</span>
        </div>
        <div class="h-1.5 bg-white/10 rounded-full overflow-hidden">
          <div id="identifyBirthTimeProgressBar" class="h-full bg-amber-400/80 rounded-full transition-all duration-300" style="width: 5.26%;"></div>
        </div>
      </div>
      <form id="identifyBirthTimeForm" class="space-y-4">
        <div id="identifyBirthTimeQuestions"></div>
        <div class="flex gap-2 pt-3">
          <button type="button" id="identifyBirthTimePrev" class="px-4 py-2.5 rounded-xl border border-white/20 text-slate-300 text-sm hover:bg-white/5 transition disabled:opacity-40 disabled:cursor-not-allowed">
            上一題
          </button>
          <button type="button" id="identifyBirthTimeNext" class="flex-1 py-2.5 rounded-xl bg-amber-500/20 border border-amber-400/40 text-amber-300 font-bold text-sm hover:bg-amber-500/30 transition">
            下一題
          </button>
          <button type="submit" id="identifyBirthTimeSubmit" class="hidden flex-1 py-2.5 rounded-xl bg-amber-500/20 border border-amber-400/40 text-amber-300 font-bold text-sm hover:bg-amber-500/30 transition">
            推算並填入
          </button>
          <button type="button" id="identifyBirthTimeClose" class="px-4 py-2.5 rounded-xl border border-white/20 text-slate-300 text-sm hover:bg-white/5 transition">
            取消
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 座標鎖定儀式 (Coordinate Lock Ceremony) -->
  <div id="ceremonyBackdrop" class="fixed inset-0 bg-black/80 hidden z-[60]" aria-hidden="true"></div>
  <div id="ceremonyModal" class="ceremony-modal fixed inset-0 flex flex-col items-center justify-center z-[60] hidden pointer-events-none" aria-modal="true" role="dialog">
    <div class="ceremony-glow absolute inset-0 flex items-center justify-center pointer-events-none" aria-hidden="true"></div>
    <div class="ceremony-content relative z-10 max-w-lg w-[90vw] px-6 py-8 flex flex-col items-center justify-center pointer-events-auto">
      <div id="ceremonyLine0" class="text-amber-300/90 font-bold text-sm tracking-wide mb-2 min-h-[1.25em]"></div>
      <div id="ceremonyLine1" class="text-amber-400/95 font-black text-sm tracking-[0.2em] mb-4 min-h-[1.5em]"></div>
      <div id="ceremonyLine2" class="text-slate-200 text-sm md:text-base leading-relaxed text-center min-h-[4em]"></div>
      <button type="button" id="ceremonyConfirm" disabled class="mt-8 px-8 py-3 rounded-xl bg-amber-500/20 border border-amber-400/50 text-amber-300 font-bold text-sm tracking-wider hover:bg-amber-500/30 transition opacity-0">
        確認同步
      </button>
    </div>
  </div>

  <!-- Mobile Palace Detail Bottom Sheet (shown when < 1280px) -->
  <div id="palaceSheetBackdrop" class="fixed inset-0 bg-black/60 hidden z-40"></div>
  <div id="palaceSheet" class="palace-sheet z-50">
    <div class="palace-sheet-handle"></div>
    <div class="palace-sheet-header flex-shrink-0">
      <div>
        <div id="mobilePalaceTitle" class="text-lg md:text-base font-black text-amber-300">請點宮位</div>
        <div id="mobilePalaceSub" class="text-sm md:text-xs text-slate-400 mt-1"></div>
      </div>
      <button id="palaceSheetClose" type="button" class="palace-sheet-close text-xs" aria-label="收合宮位說明">
        <span>✕</span>
        <span>收合</span>
      </button>
    </div>
    <div id="mobilePalaceBody" class="mt-4 space-y-4 text-sm md:text-xs text-slate-100 overflow-y-auto flex-1 min-h-0 pb-4" style="-webkit-overflow-scrolling: touch; overscroll-behavior: contain;">
      <div class="text-slate-500 italic">點擊紫微方盤任一宮位，下方會顯示詳解與星曜解釋。</div>
    </div>
  </div>

  <!-- 動態 VH Fallback + LINE 環境偵測 -->
  <script>
    (function () {
      function setVh() {
        var vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", vh + "px");
      }
      setVh();
      window.addEventListener("resize", setVh);
      window.addEventListener("orientationchange", function () { setTimeout(setVh, 100); });
      if (/Line\//i.test(navigator.userAgent) || /LIFF/i.test(navigator.userAgent)) {
        document.body.classList.add("line-browser");
      }
    })();
  </script>
  <!-- 階段1優化：工具函數、配置常量、狀態管理 -->
  <script src="js/utils.js?v=1"></script>
  <script src="js/config.js?v=1"></script>
  <script src="js/state.js?v=2"></script>
  <!-- 階段2優化：拆分 calc.js 常數模組、純函數模組、Pipeline 模組、L9 輸出模組、八字核心和戰術建議模組 -->
  <script src="js/calc/constants.js?v=1"></script>
  <script src="js/calc/helpers.js?v=1"></script>
  <script src="js/calc/ziweiPipeline.js?v=1"></script>
  <script src="js/calc/ziweiOutput.js?v=1"></script>
  <script src="js/calc/baziCore.js?v=3"></script>
  <script src="js/calc/fourTransformations.js?v=3"></script>
  <script src="js/calc/overlapAnalysis.js?v=3"></script>
  <script src="js/calc/luckIndex.js?v=1"></script>
  <script src="js/calc/healthAnalysis.js?v=1"></script>
  <script src="js/calc/monthlyDetailedAnalysis.js?v=1"></script>
  <script src="js/calc/aiPromptGenerator.js?v=1"></script>
  <script src="js/calc/tactics.js?v=1"></script>
  <script src="js/ui/components/strategic-panel.js?v=4"></script>
  <script src="js/strategyConfig.js?v=2"></script>
  <script src="js/calc.js?v=3"></script>
  <script src="js/identifyBirthTime.js?v=1"></script>
  <!-- UI 常量模块（必须在 ui.js 之前加载） -->
  <script src="js/ui/constants/ceremony-constants.js?v=1"></script>
  <!-- UI 工具模块（必须在 ui.js 之前加载） -->
  <script src="js/ui/utils/dom-helpers.js?v=1"></script>
  <script src="js/ui/utils/render-helpers.js?v=1"></script>
  <script src="js/ui/utils/strategy-tags.js?v=1"></script>
  <script src="js/ui/utils/mobile-helpers.js?v=1"></script>
  <!-- UI 服务模块（必须在 ui.js 之前加载） -->
  <script src="js/ui/services/api-service.js?v=1"></script>
  <script src="js/ui/services/navigation.js?v=2"></script>
  <script src="js/ui/services/form-init.js?v=1"></script>
  <script src="js/ui/services/sound-service.js?v=1"></script>
  <script src="js/ui/services/calculation-flow.js?v=5"></script>
  <script src="js/ui/services/event-bindings.js?v=3"></script>
  <script src="js/ui/services/data-renderer.js?v=1"></script>
  <script src="js/ui/services/user-identity.js?v=1"></script>
  <script src="js/ui/services/feedback-service.js?v=3"></script>
  <!-- UI 组件（必须在 ui.js 之前加载） -->
  <script src="js/ui/components/wuxing-panel.js?v=1"></script>
  <script src="js/ui/components/birth-time-identifier.js?v=1"></script>
  <script src="js/ui/components/wuxing-meaning.js?v=1"></script>
  <script src="js/ui/components/bazi-pillars.js?v=1"></script>
  <script src="js/ui/components/ziwei-grid.js?v=1"></script>
  <script src="js/ui/components/palace-scores.js?v=1"></script>
  <script src="js/ui/components/palace-detail.js?v=2"></script>
  <script src="js/ui/components/launch-effect.js?v=1"></script>
  <script src="js/ui/components/ambient-sound.js?v=1"></script>
  <script src="js/ui/components/liuyue-month.js?v=1"></script>
  <script src="js/ui/components/feedback-widget.js?v=1"></script>
  <script src="js/ui/components/feedback-history.js?v=1"></script>
  <script src="js/ui/components/feedback-integration.js?v=1"></script>
  <script src="js/ui/components/expert-questionnaire.js?v=1"></script>
  <script src="js/ui/components/geolocation-calibration.js?v=1"></script>
  <script src="js/ui.js?v=7"></script>
  <!-- 啟動序列掛載點與 bundle（可選：npm run build:startup 後載入，點擊「啟動人生戰略引擎」會先播 4.5s 啟動動畫） -->
  <div id="startup-root"></div>
  <script>
    // 為 startup-sequence.js 提供 process 對象（如果不存在）
    if (typeof process === "undefined") {
      window.process = { env: { NODE_ENV: "production" } };
    }
  </script>
  <!-- startup-sequence.js 是可选的，如果文件不存在会显示警告但不影响功能 -->
  <!-- startup-sequence.js 是可选的，如果文件不存在会显示警告但不影响功能 -->
  <script>
    // 動態載入 startup-sequence.js，避免 MIME type 錯誤
    (function() {
      // 使用 fetch 檢查文件是否存在且是 JavaScript 類型
      fetch('dist/startup-sequence.js', { method: 'HEAD' })
        .then(function(response) {
          // 檢查響應狀態和 Content-Type
          if (response.ok) {
            const contentType = response.headers.get('content-type') || '';
            // 確認是 JavaScript 文件（不是 HTML 404 頁面）
            if (contentType.includes('javascript') || contentType.includes('application/javascript') || contentType.includes('text/javascript')) {
              const script = document.createElement('script');
              script.src = 'dist/startup-sequence.js';
              script.type = 'text/javascript';
              script.defer = true;
              script.onerror = function() {
                console.warn('startup-sequence.js 載入失敗，啟動動畫將不可用（這是正常的，如果沒有構建此文件）');
              };
              document.head.appendChild(script);
            } else {
              // Content-Type 不是 JavaScript，可能是 404 HTML 頁面，靜默忽略
            }
          }
        })
        .catch(function() {
          // 文件不存在或網絡錯誤，靜默忽略（這是正常的）
        });
    })();
  </script>

</body>
</html>