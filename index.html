<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2026 æˆ°ç•¥å°èˆªï½œä¸€èµ·å‡ºä¾†ç©</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background:#050814;
      color:#e2e8f0;
      font-family: system-ui,-apple-system,sans-serif;
    }
    .glass {
      background: rgba(15,23,42,0.85);
      backdrop-filter: blur(14px);
      border:1px solid rgba(148,163,184,0.35);
    }
    .bazi-char {
      font-size:1.8rem;
      font-weight:900;
      line-height:1.1;
    }
    .wuxing-æœ¨{background:#2ecc71}
    .wuxing-ç«{background:#e74c3c}
    .wuxing-åœŸ{background:#f1c40f}
    .wuxing-é‡‘{background:#ced4da}
    .wuxing-æ°´{background:#3498db}

    .tab-btn{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(15,23,42,.8);
    }
    .tab-btn:hover{background:rgba(30,64,175,.8)}

    /* ============ äº”è¡Œæ˜Ÿæ›œé¡è‰² ============ */
    .star-wx-æœ¨ { color: #86efac; text-shadow: 0 0 5px rgba(34,197,94,0.5); }
    .star-wx-ç« { color: #fca5a5; text-shadow: 0 0 5px rgba(239,68,68,0.5); }
    .star-wx-åœŸ { color: #fde047; text-shadow: 0 0 5px rgba(234,179,8,0.5); }
    .star-wx-é‡‘ { color: #e2e8f0; text-shadow: 0 0 5px rgba(255,255,255,0.5); }
    .star-wx-æ°´ { color: #93c5fd; text-shadow: 0 0 5px rgba(59,130,246,0.5); }

    /* ============ ç´«å¾® 12 å®®æ ¼å®¹å™¨ ============ */
    .zw-grid-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 8px;
      width: 100%;
      max-width: 520px;
      aspect-ratio: 1/1;
      margin: 0 auto;
    }

    .zw-palace {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 0.75rem;
      padding: 8px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease;
    }
    .zw-palace:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.4);
    }

    /* å®®ä½äº”è¡Œèƒ½é‡å…‰æšˆ */
    .zw-palace::before {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      width: 150%; height: 150%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: -1;
      pointer-events: none;
    }
    [class*="palace-glow-"]::before { opacity: 1; }
    .palace-glow-æœ¨::before {
      background: radial-gradient(circle, rgba(34,197,94,0.15) 0%, transparent 70%);
    }
    .palace-glow-ç«::before {
      background: radial-gradient(circle, rgba(239,68,68,0.15) 0%, transparent 70%);
    }
    .palace-glow-åœŸ::before {
      background: radial-gradient(circle, rgba(234,179,8,0.15) 0%, transparent 70%);
    }
    .palace-glow-é‡‘::before {
      background: radial-gradient(circle, rgba(255,255,255,0.12) 0%, transparent 70%);
    }
    .palace-glow-æ°´::before {
      background: radial-gradient(circle, rgba(59,130,246,0.15) 0%, transparent 70%);
    }

    .zw-palace-key {
      border-color: rgba(251, 191, 36, 0.8);
      box-shadow: inset 0 0 15px rgba(251, 191, 36, 0.1);
    }

    .zw-center-block {
      grid-area: 2 / 2 / 4 / 4;
      background: radial-gradient(circle, #1e293b 30%, #020617 100%);
      border: 1px dashed rgba(148, 163, 184, 0.4);
      border-radius: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 10px;
      z-index: 10;
    }
  </style>
</head>

<body class="p-4">
  <h1 class="text-3xl font-black text-center mb-2">2026 æµå¹´æˆ°ç•¥å ±å‘Š</h1>
  <p class="text-xs text-slate-400 text-center mb-6">ä¸€èµ·å‡ºä¾†ç© Â· å…«å­— Ã— ç´«å¾® Â· æˆ°ç•¥ç‰ˆ</p>

  <!-- è¼¸å…¥ -->
  <div class="glass p-6 rounded-xl max-w-xl mx-auto mb-8">
    <div class="grid grid-cols-3 gap-2 mb-3">
      <select id="birthYear" class="bg-black/40 p-2 rounded"></select>
      <select id="birthMonth" class="bg-black/40 p-2 rounded" onchange="updateDays()"></select>
      <select id="birthDay" class="bg-black/40 p-2 rounded"></select>
    </div>
    <div class="grid grid-cols-2 gap-2 mb-4">
      <select id="birthHour" class="bg-black/40 p-2 rounded"></select>
      <select id="birthMinute" class="bg-black/40 p-2 rounded"></select>
    </div>
    <button onclick="calculate()" class="w-full bg-amber-500 text-black py-3 rounded font-black">
      ç”Ÿæˆæˆ‘çš„ 2026 æˆ°ç•¥
    </button>
    <p id="hint" class="text-xs text-slate-400 mt-3 italic"></p>
  </div>

  <!-- å°èˆª bar -->
  <div id="navBar" class="hidden max-w-3xl mx-auto mb-6 flex flex-wrap justify-center gap-2">
    <button class="tab-btn" onclick="scrollToSection('sec-bazi')">å››æŸ± & äº”è¡Œ</button>
    <button class="tab-btn" onclick="scrollToSection('sec-ziwei')">ç´«å¾® 12 å®®</button>
    <button class="tab-btn" onclick="scrollToSection('sec-liuyue')">2026 æµæœˆ</button>
    <button class="tab-btn" onclick="scrollToSection('sec-analysis')">æˆ°ç•¥è§£è®€</button>
  </div>

  <!-- å ±å‘Š -->
  <div id="report" class="hidden max-w-3xl mx-auto space-y-8">

    <!-- å››æŸ± -->
    <div id="sec-bazi" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">å››æŸ±ï¼ˆé¡¯ç¤ºç”¨ï¼‰</h2>
      <div class="grid grid-cols-4 text-center gap-2">
        <div>
          <div class="text-[10px] text-slate-400 mb-1">å¹´</div>
          <div id="yG" class="bazi-char"></div>
          <div id="yZ" class="text-sm text-slate-300"></div>
        </div>
        <div>
          <div class="text-[10px] text-slate-400 mb-1">æœˆ</div>
          <div id="mG" class="bazi-char"></div>
          <div id="mZ" class="text-sm text-slate-300"></div>
        </div>
        <div>
          <div class="text-[10px] text-slate-400 mb-1">æ—¥</div>
          <div id="dG" class="bazi-char text-amber-400"></div>
          <div id="dZ" class="text-sm text-slate-300"></div>
        </div>
        <div>
          <div class="text-[10px] text-slate-400 mb-1">æ™‚</div>
          <div id="hG" class="bazi-char"></div>
          <div id="hZ" class="text-sm text-slate-300"></div>
        </div>
      </div>
      <div id="meta" class="text-[11px] text-slate-500 mt-3"></div>
    </div>

    <!-- äº”è¡Œ -->
    <div class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">äº”è¡Œèƒ½é‡</h2>
      <div class="text-xs text-slate-400 mb-2">è¡¨å±¤ï¼ˆå¤©å¹²è¨ˆæ•¸ï¼‰</div>
      <div id="surfaceWx" class="space-y-2 mb-5"></div>

      <div class="text-xs text-slate-400 mb-2">å¯¦æˆ°ï¼ˆå¤©å¹² + è—å¹² + æœˆä»¤åŠ æ¬Šï¼‰</div>
      <div id="strategicWx" class="space-y-2"></div>
    </div>

    <!-- ç´«å¾®å‘½ç›¤ 12 å®® -->
    <div id="sec-ziwei" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">ç´«å¾®å‘½ç›¤ 12 å®®ç¸½è¦½</h2>
      <p class="text-xs text-slate-400 mb-3">
        å‘½ç›¤ä»¥ã€Œå‘½å®®ï¼å®˜ç¥¿å®®ï¼è²¡å¸›å®®ã€ç‚ºä¸»è»¸ï¼Œå…ˆç”¨ä¸»æ˜Ÿï¼‹äº”è¡Œèƒ½é‡å‘ˆç¾ï¼›ä¹‹å¾Œå¯ä»¥å†æ¥å®Œæ•´æ˜Ÿæ›œè³‡æ–™ã€‚
      </p>
      <div id="ziweiGrid" class="zw-grid-container"></div>
      <div id="ziweiMeta" class="text-[11px] text-slate-400 mt-4"></div>
    </div>

    <!-- æµæœˆ -->
    <div id="sec-liuyue" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">2026 æµæœˆç¯€å¥ï¼ˆ12ï¼‰</h2>
      <div id="monthGrid" class="space-y-2"></div>
    </div>

    <!-- åˆ†æ -->
    <div id="sec-analysis" class="glass p-6 rounded-xl">
      <h2 class="font-black mb-3">æˆ°ç•¥è§£è®€ï¼ˆfallbackï¼‰</h2>
      <div id="analysisBox" class="space-y-2 text-sm text-slate-200"></div>
    </div>

    <!-- è«®è©¢ CTA -->
    <div class="glass p-6 rounded-xl text-center">
      <p class="text-sm text-slate-200 mb-4 leading-relaxed">
        å¦‚æœä½ å¸Œæœ›æˆ‘æŠŠä½ çš„å‘½æ ¼çµ„æˆã€äººç”Ÿå¤§é‹ã€æµå¹´æµæœˆã€ç”Ÿæ¶¯è¦åŠƒå’Œæœ€é©åˆè‡ªå·±çš„äººç”Ÿç¯€å¥åšæˆå¯ä¿ç”¨ä¸€ç”Ÿçš„
        <span class="font-bold text-amber-400">50 é äººç”Ÿä½¿ç”¨èªªæ˜æ›¸</span>ï¼Œ
        æ­¡è¿é ç´„ç·šä¸Šè«®è©¢ã€‚
      </p>
      <a
        href="https://forms.gle/UVCSq1udEC549gzYA"
        target="_blank"
        class="inline-flex items-center justify-center px-6 py-3 rounded-full bg-amber-500 text-black font-black text-sm"
      >
        å‰å¾€é ç´„èˆ‡æä¼¯å½¥è€å¸«è«®è©¢
      </a>
    </div>

  </div>

<script>
/* ========= åŸºæœ¬è¨­å®š ========= */
const API_BASE = "https://17gonplay-api.billeetw.workers.dev";

/* ========= å°å·¥å…· ========= */
function renderBar(id, data, max) {
  const box = document.getElementById(id);
  if (!box) return;
  box.innerHTML = "";
  ["æœ¨","ç«","åœŸ","é‡‘","æ°´"].forEach(e => {
    const v = Number(data?.[e] || 0);
    const w = max ? Math.max(2, (v / max) * 100) : 0;
    box.innerHTML += `
      <div class="mb-1">
        <div class="flex justify-between text-xs">
          <span>${e}</span>
          <span>${v.toFixed(1)}</span>
        </div>
        <div class="h-2 bg-white/10 rounded overflow-hidden">
          <div class="h-full wuxing-${e}" style="width:${w}%"></div>
        </div>
      </div>
    `;
  });
}

/* ========= ç´«å¾® 12 å®®æ–¹ç›¤ï¼ˆå«äº”è¡Œèƒ½é‡ï¼‰ ========= */
const PALACE_ORDER = ["å‘½å®®","å…„å¼Ÿ","å¤«å¦»","å­å¥³","è²¡å¸›","ç–¾å„","é·ç§»","åƒ•å½¹","å®˜ç¥¿","ç”°å®…","ç¦å¾·","çˆ¶æ¯"];
const gridAreas = [
  "1/1/2/2","1/2/2/3","1/3/2/4","1/4/2/5", // ä¸Šæ’ 4 æ ¼
  "2/4/3/5","3/4/4/5","4/4/5/5",          // å³å´ 3 æ ¼
  "4/3/5/4","4/2/5/3","4/1/5/2",          // ä¸‹æ’ 3 æ ¼
  "3/1/4/2","2/1/3/2"                     // å·¦å´ 2 æ ¼
];

// 14 ä¸»æ˜Ÿäº”è¡Œ
const STAR_WUXING_MAP = {
  "ç´«å¾®": "åœŸ", "å¤©æ©Ÿ": "æœ¨", "å¤ªé™½": "ç«", "æ­¦æ›²": "é‡‘", "å¤©åŒ": "æ°´",
  "å»‰è²": "ç«", "å¤©åºœ": "åœŸ", "å¤ªé™°": "æ°´", "è²ªç‹¼": "æœ¨",
  "å·¨é–€": "æ°´", "å¤©ç›¸": "æ°´", "å¤©æ¢": "åœŸ", "ä¸ƒæ®º": "é‡‘", "ç ´è»": "æ°´"
};

function renderZiwei(ziwei) {
  const container = document.getElementById("ziweiGrid");
  const meta = document.getElementById("ziweiMeta");
  if (!container || !meta) return;

  // 1. ä¿®æ­£æª¢æŸ¥é‚è¼¯ï¼šåªè¦æœ‰ core è³‡æ–™å°±æ¸²æŸ“ï¼Œä¸å†æª¢æŸ¥ä¸å­˜åœ¨çš„ ziwei.version
  if (!ziwei || !ziwei.core) {
    container.className = "zw-grid-container";
    container.innerHTML = `
      <div class="text-xs text-slate-400 italic col-span-4 flex items-center justify-center border border-dashed border-slate-700 rounded-xl h-40">
        ï¼ˆç›®å‰å°šæœªå–å¾—ç´«å¾®æ ¸å¿ƒè³‡æ–™ï¼‰
      </div>`;
    meta.innerText = "";
    return;
  }

  container.className = "zw-grid-container";
  container.innerHTML = "";

  // 2. æº–å‚™ 12 å®®ä½æ˜Ÿæ›œè³‡æ–™æ˜ å°„
  // é€™è£¡ç¢ºä¿å³ä¾¿ API åªçµ¦äº†éƒ¨åˆ†å®®ä½ï¼Œå…¶é¤˜å®®ä½ä¹Ÿèƒ½æ­£ç¢ºé¡¯ç¤ºç‚ºã€Œç©ºå®®ã€
  const palStars = {};
  PALACE_ORDER.forEach(p => palStars[p] = []);

  // æ˜ å°„ä¸»æ˜Ÿè³‡æ–™ (ä¾æ“š strategic_features_v1 è¦æ ¼)
  if (ziwei.core?.minggong) palStars["å‘½å®®"].push(ziwei.core.minggong);
  
  if (ziwei.mainStars) {
    if (Array.isArray(ziwei.mainStars.minggong)) palStars["å‘½å®®"].push(...ziwei.mainStars.minggong);
    if (Array.isArray(ziwei.mainStars.career))   palStars["å®˜ç¥¿"].push(...ziwei.mainStars.career);
    if (Array.isArray(ziwei.mainStars.wealth))   palStars["è²¡å¸›"].push(...ziwei.mainStars.wealth);
  }

  // 3. åŸ·è¡Œæ¸²æŸ“è¿´åœˆ
  PALACE_ORDER.forEach((name, idx) => {
    // éæ¿¾æ‰é‡è¤‡æˆ–ç©ºçš„æ˜Ÿæ›œ
    const starsList = [...new Set(palStars[name].filter(Boolean))];
    const isKey = ["å‘½å®®","å®˜ç¥¿","è²¡å¸›"].includes(name);

    let starsHtml = "";
    let palaceMainElement = "";

    if (starsList.length > 0) {
      starsHtml = starsList.map((starName, i) => {
        const wx = STAR_WUXING_MAP[starName] || "";
        if (i === 0 && wx) palaceMainElement = wx; // å–ç¬¬ä¸€é¡†ä¸»æ˜Ÿæ±ºå®šå®®ä½æ°£æ°›
        return `<span class="${wx ? "star-wx-" + wx : ""}">${starName}</span>`;
      }).join("<br>");
    } else {
      starsHtml = '<span class="text-slate-700 text-[10px] italic font-normal">ç©ºå®®</span>';
    }

    const glowClass = palaceMainElement ? `palace-glow-${palaceMainElement}` : "";

    container.innerHTML += `
      <div class="zw-palace ${isKey ? "zw-palace-key" : ""} ${glowClass}"
           style="grid-area: ${gridAreas[idx]}">
        <div class="text-[10px] font-bold text-slate-500 mb-1">${name}</div>
        <div class="text-[13px] font-black leading-tight tracking-wide">
          ${starsHtml}
        </div>
      </div>
    `;
  });

  // 4. æ’å…¥ä¸­å¿ƒå€å¡Š (ç¢ºä¿è“‹åœ¨ 2x2 çš„ä½ç½®)
  container.innerHTML += `
    <div class="zw-center-block">
      <div class="text-[9px] text-slate-500 uppercase tracking-widest font-bold mb-1">
        Destiny Core
      </div>
      <div class="text-amber-400 font-black text-lg tracking-widest leading-none">
        ${ziwei.core?.minggong || "â€”"}
      </div>
      <div class="flex flex-col gap-1 mt-2">
        <span class="text-[9px] px-2 py-0.5 rounded-full bg-slate-900 border border-slate-800 text-slate-400">
          èº«ï¼š${ziwei.core?.shengong || "â€”"}
        </span>
        <span class="text-[9px] px-2 py-0.5 rounded-full bg-slate-900 border border-slate-800 text-slate-400">
          ${ziwei.core?.wuxingju || "â€”"}å±€
        </span>
      </div>
    </div>
  `;

  meta.innerHTML = `<p class="text-[10px] text-slate-500 italic">â€» ç›®å‰åƒ…é¡¯ç¤ºä¸‰æ–¹å››æ­£æ ¸å¿ƒä¸»æ˜Ÿï¼Œå®Œæ•´æ˜Ÿç›¤æ¨¡çµ„è¼‰å…¥ä¸­...</p>`;
}

  container.className = "zw-grid-container";
  container.innerHTML = "";

  // æŠŠ API è‹±æ–‡æ¬„ä½å°æ‡‰åˆ° 12 å®®åç¨±
  const palStars = {};
  palStars["å‘½å®®"] = [];
  palStars["å®˜ç¥¿"] = [];
  palStars["è²¡å¸›"] = [];

  if (ziwei.core?.minggong) palStars["å‘½å®®"].push(ziwei.core.minggong);
  if (Array.isArray(ziwei.mainStars?.minggong)) {
    palStars["å‘½å®®"].push(...ziwei.mainStars.minggong);
  }
  if (Array.isArray(ziwei.mainStars?.career)) {
    palStars["å®˜ç¥¿"].push(...ziwei.mainStars.career);
  }
  if (Array.isArray(ziwei.mainStars?.wealth)) {
    palStars["è²¡å¸›"].push(...ziwei.mainStars.wealth);
  }

  PALACE_ORDER.forEach((name, idx) => {
    const rawStars = palStars[name] || [];
    const starsList = rawStars.filter(Boolean);
    const isKey = ["å‘½å®®","å®˜ç¥¿","è²¡å¸›"].includes(name);

    let starsHtml = "";
    let palaceMainElement = "";

    if (starsList.length > 0) {
      starsHtml = starsList.map((starName, i) => {
        const wx = STAR_WUXING_MAP[starName] || "";
        if (i === 0 && wx) palaceMainElement = wx;
        return `<span class="${wx ? "star-wx-" + wx : ""}">${starName}</span>`;
      }).join("<br>");
    } else {
      starsHtml = '<span class="text-slate-600 text-xs italic font-normal">ç©ºå®®</span>';
    }

    const glowClass = palaceMainElement ? `palace-glow-${palaceMainElement}` : "";

    container.innerHTML += `
      <div class="zw-palace ${isKey ? "zw-palace-key" : ""} ${glowClass}"
           style="grid-area: ${gridAreas[idx]}">
        <div class="text-[10px] font-bold text-slate-500 mb-1">${name}</div>
        <div class="text-[13px] font-black leading-snug tracking-wide">
          ${starsHtml}
        </div>
      </div>
    `;
  });

  meta.innerHTML = `
    <div>å‘½å®®ä¸»æ˜Ÿï¼š<span class="text-amber-300">${ziwei.core?.minggong || "â€”"}</span></div>
    <div class="mt-1 text-[11px]">
      èº«å®®ï¼š${ziwei.core?.shengong || "â€”"} ï½œ äº”è¡Œå±€ï¼š${ziwei.core?.wuxingju || "â€”"}å±€
    </div>
  `;

  // ä¸­å¿ƒå€å¡Šè“‹åœ¨ grid ä¸Š
  container.innerHTML += `
    <div class="zw-center-block">
      <div class="text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">
        Destiny Core
      </div>
      <div class="text-amber-400 font-black text-xl tracking-widest">
        ${ziwei.core?.minggong || "â€”"}
      </div>
      <div class="text-[10px] text-slate-400 mt-2">
        <span class="px-2 py-1 rounded-full bg-slate-900/50 border border-slate-800">
          èº«å®®ï¼š${ziwei.core?.shengong || "â€”"}
        </span>
      </div>
      <div class="text-[10px] text-slate-400 mt-1">
        <span class="px-2 py-1 rounded-full bg-slate-900/50 border border-slate-800">
          ${ziwei.core?.wuxingju || "â€”"}å±€
        </span>
      </div>
    </div>
  `;
}

/* ========= ä¸»æµç¨‹ ========= */
async function calculate() {
  const vy   = Number(document.getElementById("birthYear").value);
  const vm   = Number(document.getElementById("birthMonth").value);
  const vd   = Number(document.getElementById("birthDay").value);
  const vh   = Number(document.getElementById("birthHour").value);
  const vmin = Number(document.getElementById("birthMinute").value);

  try {
    if (![vy, vm, vd, vh, vmin].every(n => Number.isFinite(n))) {
      throw new Error("è«‹å…ˆé¸å¥½å‡ºç”Ÿå¹´æœˆæ—¥èˆ‡æ™‚é–“");
    }

    const resp = await fetch(`${API_BASE}/compute/all`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ year: vy, month: vm, day: vd, hour: vh, minute: vmin })
    });

    if (!resp.ok) {
      const txt = await resp.text().catch(()=> "");
      throw new Error(`API HTTP ${resp.status} ${txt || ""}`.trim());
    }

    const payload = await resp.json();
    console.log("API payload:", payload);
    window.__payload  = payload;
    window.__contract = payload?.features;

    if (!payload?.ok) throw new Error(payload?.error || "API error");

    const contract = payload.features;
    if (!contract || contract.version !== "strategic_features_v1") {
      throw new Error("contract æ ¼å¼ä¸æ­£ç¢ºï¼ˆfeatures.version != strategic_features_v1ï¼‰");
    }

    const bazi  = contract.bazi;
    const ziwei = contract.ziwei;
    if (!bazi) throw new Error("contract.bazi ä¸å­˜åœ¨");

    /* å››æŸ± */
    const disp = bazi.display || {};
    document.getElementById("yG").innerText = disp.yG || "";
    document.getElementById("yZ").innerText = disp.yZ || "";
    document.getElementById("mG").innerText = disp.mG || "";
    document.getElementById("mZ").innerText = disp.mZ || "";
    document.getElementById("dG").innerText = disp.dG || "";
    document.getElementById("dZ").innerText = disp.dZ || "";
    document.getElementById("hG").innerText = disp.hG || "";
    document.getElementById("hZ").innerText = disp.hZ || "";

    document.getElementById("meta").innerText =
      `é™½æ›† ${vy}/${vm}/${vd} ${String(vh).padStart(2,"0")}:${String(vmin).padStart(2,"0")} ï½œ æ—¥ä¸»ï¼š${bazi.dmElement}`;

    /* äº”è¡Œ */
    renderBar("surfaceWx",   bazi.wuxing?.surface,   4);
    renderBar("strategicWx", bazi.wuxing?.strategic, bazi.wuxing?.maxStrategic || 1);

    /* ç´«å¾® */
    renderZiwei(ziwei);

    /* æµæœˆ */
    const bounds = bazi.liuyue2026?.bounds || [];
    const monthGrid = document.getElementById("monthGrid");
    monthGrid.innerHTML = "";

    const redMonths = [];
    if (bounds.length) {
      bounds.forEach(b => {
        const isRed = b.light === "RED";
        if (isRed) redMonths.push(b.gz);
        monthGrid.innerHTML += `
          <div class="p-3 rounded border-l-4 ${isRed ? "border-red-500 bg-red-500/10" : "border-emerald-500 bg-emerald-500/10"}">
            <div class="font-bold">
              ${b.gz}
              <span class="text-xs text-slate-400 ml-1">${b.range || ""}</span>
            </div>
            <div class="text-xs text-slate-300 mt-1">
              ${isRed ? "ğŸ”´ å£“åŠ›" : "ğŸŸ¢ ç©©é€²"} ï½œ æœ¬æ°£ï¼š${b.ssBranch || ""}
            </div>
          </div>
        `;
      });
    } else {
      monthGrid.innerHTML = `<div class="text-xs text-slate-400 italic">ï¼ˆæš«ç„¡æµæœˆè³‡æ–™ï¼‰</div>`;
    }

    /* æˆ°ç•¥è§£è®€ fallback */
    const analysisBox = document.getElementById("analysisBox");
    const dominant = (bazi.tenGod?.dominant || "").trim() || "æœªå®š";
    const dmElement = bazi.dmElement || "ç«";

    const redText = redMonths.length
      ? `å£“åŠ›æœˆï¼š${redMonths.join("ã€")}ï¼ˆé€™äº›æœˆå…ˆå®ˆè¦å‰‡ï¼Œä¸è¦ç¡¬è¡ï¼‰ã€‚`
      : "ä»Šå¹´å£“åŠ›æœˆåå°‘ï¼Œå¯ä»¥ç©©ç©©æ¨é€²ã€‚";

    analysisBox.innerHTML = `
      <p>ä½ çš„æ—¥ä¸»äº”è¡Œä¸»å ´æ˜¯ã€Œ${dmElement}ã€ï¼Œ2026 å¹´åº¦ä¸»è»¸åå‘ã€Œ${dominant}ã€ã€‚</p>
      <p>${redText}</p>
      <p>ç­–ç•¥ï¼šæŠŠè¡Œå‹•æ‹†å°ã€ç›®æ¨™è®Šå°‘ã€ç¯€å¥å›ºå®šï¼Œå£“åŠ›æœˆå„ªå…ˆå®ˆä½ç¾æœ‰ç›¤é¢ã€‚</p>
      <p class="text-[11px] text-slate-400 mt-2">
        ï¼ˆä¹‹å¾Œå¯æ”¹ç”¨ /render/report æŠŠé€™æ®µæ›æˆå®Œæ•´ AI æ•˜äº‹ï¼‰
      </p>
    `;

    document.getElementById("hint").innerText =
      "è³‡æ–™ä¾†æºï¼š/compute/all strategic_features_v1ï¼ˆå«å…«å­— + ç´«å¾® featuresï¼‰";

    document.getElementById("navBar").classList.remove("hidden");
    document.getElementById("report").classList.remove("hidden");
    document.getElementById("report").scrollIntoView({ behavior:"smooth", block:"start" });

  } catch (e) {
    console.error(e);
    alert("è¨ˆç®—å¤±æ•—ï¼š" + (e?.message || e));
  }
}

/* ========= æ—¥æœŸé¸å–® ========= */
function initSelectors() {
  const y   = document.getElementById("birthYear");
  const m   = document.getElementById("birthMonth");
  const d   = document.getElementById("birthDay");
  const h   = document.getElementById("birthHour");
  const min = document.getElementById("birthMinute");
  if (!y || !m || !d || !h || !min) return;

  for (let i = 2026; i >= 1940; i--) y.add(new Option(i + " å¹´", i));
  for (let i = 1; i <= 12; i++)      m.add(new Option(i + " æœˆ", i));
  for (let i = 0; i < 24; i++) {
    const label = String(i).padStart(2,"0") + " æ™‚";
    h.add(new Option(label, i));
  }
  ["00","15","30","45"].forEach(v => min.add(new Option(v + " åˆ†", v)));

  y.value   = "1990";
  m.value   = "1";
  h.value   = "12";
  min.value = "00";

  updateDays();
}
function updateDays() {
  const y = document.getElementById("birthYear");
  const m = document.getElementById("birthMonth");
  const d = document.getElementById("birthDay");
  if (!y || !m || !d) return;

  const year  = parseInt(y.value, 10);
  const month = parseInt(m.value, 10);
  const current = d.value;

  d.innerHTML = "";
  const days = new Date(year, month, 0).getDate();
  for (let i = 1; i <= days; i++) {
    const opt = new Option(i + " æ—¥", i);
    if (String(i) === String(current) || (!current && i === 1)) opt.selected = true;
    d.add(opt);
  }
}

/* ========= å°èˆª scroll ========= */
function scrollToSection(id) {
  const el = document.getElementById(id);
  if (el) el.scrollIntoView({ behavior:"smooth", block:"start" });
}

document.addEventListener("DOMContentLoaded", initSelectors);
</script>

</body>
</html>



