/* calc/constants.js
 * 紫微斗數計算相關的常數定義
 * 從 calc.js 中提取，用於模組化架構
 */

(function () {
  "use strict";

  // ====== 宮位相關常數 ======
  
  /**
   * 預設「宮位順序」（從命宮開始逆行）
   * 只用來做三方四正等「宮位邏輯」，跟畫格子的位置分開
   */
  const PALACE_DEFAULT = [
    "命宮", "兄弟", "夫妻", "子女", "財帛", "疾厄",
    "遷移", "僕役", "官祿", "田宅", "福德", "父母",
  ];

  /**
   * 宮位簡繁對照（找星曜、找資料庫用）
   */
  const PALACE_KEY_MAP = {
    "兄弟": ["兄弟", "兄弟宮"],
    "命宮": ["命宮", "命宫"],
    "夫妻": ["夫妻", "夫妻宮"],
    "子女": ["子女", "子女宮"],
    "財帛": ["財帛", "财帛", "財帛宮", "财帛宫"],
    "疾厄": ["疾厄", "疾厄宮"],
    "遷移": ["遷移", "迁移", "遷移宮", "迁移宫"],
    "僕役": ["僕役", "仆役", "僕役宮", "仆役宫"],
    "官祿": ["官祿", "官禄", "官祿宮", "官禄宫"],
    "田宅": ["田宅", "田宅宮"],
    "福德": ["福德", "福德宮"],
    "父母": ["父母", "父母宮"],
  };

  /**
   * 宮位繁體名稱 → JSON 英文標識映射表
   */
  const PALACE_NAME_TO_ID_MAP = {
    "命宮": "Self",
    "兄弟": "Siblings",
    "夫妻": "Spouse",
    "子女": "Children",
    "財帛": "Wealth",
    "疾厄": "Health",
    "遷移": "Travel",
    "僕役": "Friends",
    "官祿": "Career",
    "田宅": "Property",
    "福德": "Karma",
    "父母": "Parents",
  };

  /**
   * 宮位一句話說明映射表（#深度貼文風格）
   * 為 12 宮位提供直覺描述，符合系統思維與商務決策直覺
   */
  const PALACE_ONE_LINERS = {
    "命宮": "你的核心作業系統",
    "兄弟": "你的戰友與近親資源",
    "夫妻": "你的親密連結與合夥狀態",
    "子女": "你的產出效能與創造力",
    "財帛": "你的金錢獲取與理財邏輯",
    "疾厄": "你的生理硬體與身心基石",
    "遷移": "你的外部接口與外界觀感",
    "僕役": "你的社交網絡與眾生緣分",
    "官祿": "你的事業軌道與執行強度",
    "田宅": "你的資產根基與穩定堡壘",
    "福德": "你的精神底蘊與內心平衡",
    "父母": "你的規則約束與權威互動"
  };

  // ====== 盤面位置相關常數 ======
  
  /**
   * 12 宮盤面位置（4x4 外圈）— 這是「地支座標」
   * 索引：0:寅(左下), 1:卯, 2:辰, 3:巳(左上), 4:午, 5:未,
   *      6:申(右上), 7:酉, 8:戌, 9:亥(右下),10:子, 11:丑
   */
  const gridAreas = [
    "4/1/5/2", // 0: 寅 (左下)
    "3/1/4/2", // 1: 卯
    "2/1/3/2", // 2: 辰
    "1/1/2/2", // 3: 巳 (左上)
    "1/2/2/3", // 4: 午
    "1/3/2/4", // 5: 未
    "1/4/2/5", // 6: 申 (右上)
    "2/4/3/5", // 7: 酉
    "3/4/4/5", // 8: 戌
    "4/4/5/5", // 9: 亥 (右下)
    "4/3/5/4", // 10: 子
    "4/2/5/3", // 11: 丑
  ];

  /**
   * 固定的「地支環」，對應上面 gridAreas 的順序
   */
  const BRANCH_RING = ["寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥", "子", "丑"];

  // ====== 星曜相關常數 ======
  
  /**
   * 星曜簡→繁對照（單一來源）
   * 後端請使用同份 data/star-name-trad.json，避免重複維護。
   */
  const STAR_NAME_TRAD_MAP = {
    // 14 主星
    "紫微": "紫微", "紫薇": "紫微",
    "天机": "天機", "天機": "天機",
    "太阳": "太陽", "太陽": "太陽",
    "太阴": "太陰", "太陰": "太陰",
    "武曲": "武曲",
    "天同": "天同",
    "廉贞": "廉貞", "廉貞": "廉貞",
    "天府": "天府",
    "贪狼": "貪狼", "貪狼": "貪狼",
    "巨门": "巨門", "巨門": "巨門",
    "天相": "天相",
    "天梁": "天梁",
    "七杀": "七殺", "七殺": "七殺",
    "破军": "破軍", "破軍": "破軍",

    // 六吉星
    "左辅": "左輔", "左輔": "左輔",
    "右弼": "右弼",
    "文昌": "文昌",
    "文曲": "文曲",
    "天魁": "天魁",
    "天钺": "天鉞", "天鉞": "天鉞",

    // 六煞星
    "擎羊": "擎羊",
    "陀罗": "陀羅", "陀羅": "陀羅",
    "火星": "火星",
    "铃星": "鈴星", "鈴星": "鈴星",
    "地劫": "地劫",
    "地空": "地空",

    // 重要輔星
    "禄存": "祿存", "祿存": "祿存",
    "天马": "天馬", "天馬": "天馬",
    "天伤": "天傷", "天傷": "天傷",
    "天使": "天使",
    "天才": "天才",
    "天寿": "天壽", "天壽": "天壽",
    "天官": "天官",
    "天福": "天福",
    "天巫": "天巫",
    "天喜": "天喜",
    "天姚": "天姚",
    "紅鸞": "紅鸞", "红鸾": "紅鸞",
    "天刑": "天刑",
    "解神": "解神",

    // 雜曜與神煞
    "天厨": "天廚", "天廚": "天廚",
    "截路": "截路",
    "孤辰": "孤辰",
    "寡宿": "寡宿",
    "空亡": "空亡",
    "破碎": "破碎",
    "天贵": "天貴", "天貴": "天貴",
    "华盖": "華蓋", "華蓋": "華蓋",
    "天哭": "天哭",
    "天虚": "天虛", "天虛": "天虛",
    "天德": "天德",
    "月德": "月德",
    "旬空": "旬空",
    "台辅": "台輔", "台輔": "台輔",
    "封诰": "封誥", "封誥": "封誥",
    "龙池": "龍池", "龍池": "龍池",
    "凤阁": "鳳閣", "鳳閣": "鳳閣",
    "年解": "年解",
    "咸池": "咸池",
    "三台": "三台",
    "八座": "八座",
    "恩光": "恩光",
    "蜚廉": "蜚廉",
    "阴煞": "陰煞", "陰煞": "陰煞",
    "天月": "天月",

    // 博士十二神
    "博士": "博士",
    "力士": "力士",
    "青龍": "青龍", "青龙": "青龍",
    "小耗": "小耗",
    "將軍": "將軍", "将军": "將軍",
    "奏書": "奏書", "奏书": "奏書",
    "喜神": "喜神",
    "病符": "病符",
    "大耗": "大耗",
    "伏兵": "伏兵",
    "官府": "官府",

    // 類別型星曜
    "甲級主星": "甲級主星",
    "六吉星": "六吉星",
    "六煞星": "六煞星",
    "南斗、北斗星": "南斗、北斗星",
    "中天星": "中天星",
    "輔助星": "輔助星",
    "祿存與天馬": "祿存與天馬",
  };

  /**
   * 五行 map 用「繁體星名」
   */
  const STAR_WUXING_MAP = {
    "紫微": "土", "天機": "木", "太陽": "火", "武曲": "金", "天同": "水",
    "廉貞": "火", "天府": "土", "太陰": "水", "貪狼": "木", "巨門": "水",
    "天相": "水", "天梁": "土", "七殺": "金", "破軍": "水",
  };

  /**
   * 星曜繁體名稱 → JSON ID 映射表
   */
  const STAR_NAME_TO_ID_MAP = {
    // 14 主星
    "紫微": "ZiWei",
    "天府": "TianFu",
    "太陽": "TaiYang",
    "武曲": "WuQu",
    "廉貞": "LianZhen",
    "天梁": "TianLiang",
    "七殺": "QiSha",
    "天相": "TianXiang",
    "天機": "TianJi",
    "巨門": "JuMen",
    "貪狼": "TanLang",
    "太陰": "TaiYin",
    "天同": "TianTong",
    "破軍": "PoJun",
    // 輔星
    "左輔": "ZuoFu",
    "右弼": "YouBi",
    "文昌": "WenChang",
    "文曲": "WenQu",
    "天魁": "TianKui",
    "天鉞": "TianYue",
    "祿存": "LuCun",
    "天馬": "TianMa",
    "擎羊": "QingYang",
    "陀羅": "TuoLuo",
    "火星": "HuoXing",
    "鈴星": "LingXing",
    "地劫": "DiJie",
    "地空": "DiKong",
  };

  // ====== 時辰相關常數 ======
  
  /**
   * 時辰順序（子丑寅...）
   */
  const SHICHEN_ORDER = Object.freeze(["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]);

  /**
   * 時辰區間（每個 2 小時）的起始小時
   * 子=23, 丑=1, 寅=3...（上半=起始那 1 小時、下半=下一個 1 小時）
   */
  const SHICHEN_START_HOUR = Object.freeze({
    "子": 23,
    "丑": 1,
    "寅": 3,
    "卯": 5,
    "辰": 7,
    "巳": 9,
    "午": 11,
    "未": 13,
    "申": 15,
    "酉": 17,
    "戌": 19,
    "亥": 21,
  });

  /**
   * 保留舊版「中間值」對照（相容/除錯用）
   */
  const SHICHEN_TO_HOUR = Object.freeze({
    "子": 0,   // 23-01 → 00
    "丑": 2,   // 01-03 → 02
    "寅": 4,   // 03-05 → 04
    "卯": 6,   // 05-07 → 06
    "辰": 8,   // 07-09 → 08
    "巳": 10,  // 09-11 → 10
    "午": 12,  // 11-13 → 12
    "未": 14,  // 13-15 → 14
    "申": 16,  // 15-17 → 16
    "酉": 18,  // 17-19 → 18
    "戌": 20,  // 19-21 → 20
    "亥": 22,  // 21-23 → 22
  });

  // ====== 五行相關常數 ======
  
  /**
   * 五行順序（雷達圖與註解統一採用這個軸順序）
   */
  const FIVE_ELEMENTS_ORDER = ["金", "木", "水", "火", "土"];

  /**
   * 五行相生映射表
   */
  const SHENG_MAP = Object.freeze({
    "木": "火",
    "火": "土",
    "土": "金",
    "金": "水",
    "水": "木",
  });

  /**
   * 五行相剋映射表
   */
  const KE_MAP = Object.freeze({
    "木": "土",
    "火": "金",
    "土": "水",
    "金": "木",
    "水": "火",
  });

  /**
   * 五行強勢時的說明文字
   */
  const STRONG_COMMENTS = Object.freeze({
    "木": "你的成長動能強，遇到事情會偏向突破與展開。",
    "火": "你的行動與表達能量旺盛，節奏偏快。",
    "土": "你有很強的穩定力，關鍵時刻通常靠沉住氣撐局面。",
    "金": "你的判斷力與界線感強，能快速切割與做決定。",
    "水": "你吸收資訊快，感受敏銳，是直覺與觀察型。",
  });

  /**
   * 五行弱勢時的說明文字
   */
  const WEAK_COMMENTS = Object.freeze({
    "木": "成長與規劃動能較低，事情太慢容易讓你失去耐心。",
    "火": "外放能量較弱，不喜歡被逼著表達或站 spotlight。",
    "土": "承載力有限，長期壓力會讓你容易疲乏。",
    "金": "界線較弱，不喜衝突，容易委屈自己。",
    "水": "資訊流偏弱，容易因『不知道 enough』而焦慮。",
  });

  /**
   * 地支藏干（前端顯示用，也可用於實戰結構的解釋）
   */
  const CANGGAN_DATA = {
    "子": { "癸": 1.0 },
    "丑": { "己": 0.6, "癸": 0.3, "辛": 0.1 },
    "寅": { "甲": 0.6, "丙": 0.3, "戊": 0.1 },
    "卯": { "乙": 1.0 },
    "辰": { "戊": 0.6, "乙": 0.3, "癸": 0.1 },
    "巳": { "丙": 0.6, "庚": 0.3, "戊": 0.1 },
    "午": { "丁": 0.7, "己": 0.3 },
    "未": { "己": 0.6, "丁": 0.3, "乙": 0.1 },
    "申": { "庚": 0.6, "壬": 0.3, "戊": 0.1 },
    "酉": { "辛": 1.0 },
    "戌": { "戊": 0.6, "辛": 0.3, "丁": 0.1 },
    "亥": { "壬": 0.7, "甲": 0.3 },
  };

  /**
   * 能量等級標籤：0(低頻) 1(平穩) 2(強健) 3(過旺)
   */
  const ENERGY_LABEL = Object.freeze({
    0: "低頻",
    1: "平穩",
    2: "強健",
    3: "過旺",
  });

  /**
   * 五行核心意義與診斷文字
   */
  const ELEMENT_CORE_MEANING = Object.freeze({
    "木": { core: "執行、生長", low01: "猶豫不決、停滯", level2: "條理分明、穩定成長", level3: "盲目擴張、焦慮", remedy: "缺乏「動手做」的勇氣，你需要的是直接啟動，而不是持續規劃。" },
    "火": { core: "傳播、名聲", low01: "默默無聞、冷淡", level2: "熱情、影響力強", level3: "虛火上升、易碎", remedy: "你的好只有你自己知道，缺乏「傳播力」將讓你陷入孤軍奮戰。" },
    "土": { core: "信用、整合", low01: "缺乏根基、動盪", level2: "穩重、資源豐厚", level3: "頑固死板、阻礙", remedy: "所有的成就都像在沙灘上蓋房子，你需要的是「資產化」與「穩定性」。" },
    "金": { core: "決斷、規則", low01: "界線模糊、軟弱", level2: "效率、紀律、果斷", level3: "冷酷無情、偏激", remedy: "你太好說話了，缺乏「拒絕力」是你目前能量耗損的核心原因。" },
    "水": { core: "智慧、流動", low01: "思考枯竭、封閉", level2: "洞察力、靈活應變", level3: "憂慮多思、漂浮", remedy: "正在用體力對抗智力，缺乏「深度思考」會讓你陷入低效率的勤奮。" },
  });

  /**
   * 全域相生（深度貼文風格）
   */
  const GENERATION_POST_STYLE = Object.freeze({
    "木->火": { headline: "策略引燃市場", text: "你的執行力（木）正精準轉化為市場名聲（火），品牌能量正處於上升期。" },
    "火->土": { headline: "流量沉澱資產", text: "目前的高關注度（火）應迅速轉化為品牌信用與基礎建設（土），避免熱度流失。" },
    "土->金": { headline: "資源轉化效率", text: "厚實的根基（土）是為了萃取更高效率的 SOP 與規則（金），讓組織自動運轉。" },
    "金->水": { headline: "決斷催生智慧", text: "你的紀律與邊界（金）正在為深度的思考與策略（水）提供乾淨的環境。" },
    "水->木": { headline: "智謀驅動執行", text: "充沛的智慧（水）正高效轉化為具體的執行管道（木），這是最強的變現路徑。" },
  });

  /**
   * 全域相剋（深度貼文風格）
   */
  const OVERCOMING_POST_STYLE = Object.freeze({
    "木->土": { headline: "擴張動搖根基", text: "過度的擴張慾望（木）正在損害你的信用與穩定性（土），請注意步調。" },
    "土->水": { headline: "體制限制創意", text: "僵化的制度或過度追求穩健（土），正在扼殺你原本靈活的智慧流動（水）。" },
    "水->火": { headline: "理性壓制熱情", text: "絕對的冷靜理性（水）雖然能避險，但也可能讓你的事業缺乏感性紅利（火）。" },
    "火->金": { headline: "情緒破壞規則", text: "突發的情緒衝動或追求曝光（火），正在挑戰你辛苦建立的決斷邊界（金）。" },
    "金->木": { headline: "規則扼殺執行", text: "嚴苛的管理與自我設限（金），正在剪除你應有的執行活力與成長空間（木）。" },
  });

  /**
   * 伯彥戰略看板相關常數
   */
  const ELEMENT_TYPE = { "木": "執行型", "火": "傳播型", "土": "整合型", "金": "決斷型", "水": "流動型" };
  
  const BOYAN_CONVERSION_ONE = {
    "木->火": "將執行力（木）轉成能見度（火），這才是你能拿走的資產。",
    "火->土": "將高關注度（火）沉澱為品牌信用（土），這才是你能拿走的資產。",
    "土->金": "將根基（土）萃成規則與效率（金），這才是你能拿走的資產。",
    "金->水": "將決斷與邊界（金）催生深度思考（水），這才是你能拿走的資產。",
    "水->木": "將智慧（水）轉成具體執行（木），這才是你能拿走的資產。",
  };
  
  const BOYAN_RISK_ONE = {
    "木->土": "擴張慾望（木）正在損害信用與穩定（土）。",
    "土->水": "體制與穩健（土）正在限制智慧流動（水）。",
    "水->火": "理性（水）壓制熱情（火），事業缺乏感性紅利。",
    "火->金": "情緒衝動（火）正在燒毀決斷邊界（金）。你太好說話了，這會讓你能量耗損。",
    "金->木": "規則與自我設限（金）正在扼殺執行活力（木）。",
  };
  
  const BOYAN_PUSH = {
    "木": "別再只規劃不行動。這一關，你要練的是「動手做」。",
    "火": "別再默默做事。這一關，你要練的是「傳播力」。",
    "土": "別在沙灘上蓋房子。這一關，你要練的是「資產化」。",
    "金": "別再為了討好而妥協。這一關，你要練的是「拒絕力」。",
    "水": "別用體力對抗智力。這一關，你要練的是「深度思考」。",
  };

  // ====== 小限／四化相關常數 ======
  
  /**
   * 十天干順序
   */
  const STEMS = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
  
  /**
   * 地支順序映射（用於計算）
   */
  const BRANCH_ORDER = { "寅": 0, "卯": 1, "辰": 2, "巳": 3, "午": 4, "未": 5, "申": 6, "酉": 7, "戌": 8, "亥": 9, "子": 10, "丑": 11 };
  
  /**
   * 年干 → 寅宮天干（五虎遁）
   */
  const YIN_STEM_FROM_YEAR = { "甲": "丙", "乙": "戊", "丙": "庚", "丁": "壬", "戊": "甲", "己": "丙", "庚": "戊", "辛": "庚", "壬": "壬", "癸": "甲" };

  /**
   * 十天干與四化對應 + 權重（祿 3 / 權 2 / 科 1 / 忌 -3）
   * 供小限動態導覽與宮位強度聯動
   */
  const SI_HUA_MAP = {
    "甲": { "廉貞": "祿", "破軍": "權", "武曲": "科", "太陽": "忌", weights: { "廉貞": 3, "破軍": 2, "武曲": 1, "太陽": -3 } },
    "乙": { "天機": "祿", "天梁": "權", "紫微": "科", "太陰": "忌", weights: { "天機": 3, "天梁": 2, "紫微": 1, "太陰": -3 } },
    "丙": { "天同": "祿", "天機": "權", "文昌": "科", "廉貞": "忌", weights: { "天同": 3, "天機": 2, "文昌": 1, "廉貞": -3 } },
    "丁": { "太陰": "祿", "天同": "權", "天機": "科", "巨門": "忌", weights: { "太陰": 3, "天同": 2, "天機": 1, "巨門": -3 } },
    "戊": { "貪狼": "祿", "太陰": "權", "右弼": "科", "天機": "忌", weights: { "貪狼": 3, "太陰": 2, "右弼": 1, "天機": -3 } },
    "己": { "武曲": "祿", "貪狼": "權", "天梁": "科", "文曲": "忌", weights: { "武曲": 3, "貪狼": 2, "天梁": 1, "文曲": -3 } },
    "庚": { "太陽": "祿", "武曲": "權", "太陰": "科", "天同": "忌", weights: { "太陽": 3, "武曲": 2, "太陰": 1, "天同": -3 } },
    "辛": { "巨門": "祿", "太陽": "權", "文曲": "科", "文昌": "忌", weights: { "巨門": 3, "太陽": 2, "文曲": 1, "文昌": -3 } },
    "壬": { "天梁": "祿", "紫微": "權", "左輔": "科", "武曲": "忌", weights: { "天梁": 3, "紫微": 2, "左輔": 1, "武曲": -3 } },
    "癸": { "破軍": "祿", "巨門": "權", "太陰": "科", "貪狼": "忌", weights: { "破軍": 3, "巨門": 2, "太陰": 1, "貪狼": -3 } },
  };

  // ====== 星等評分相關常數 ======
  
  /**
   * 戰略建議映射表（根據星等）
   * 符合 #深度貼文 框架：語氣冷靜、中性、具備系統思維與商務決策直覺
   * 蘊含溫和鼓勵性質，但保持不同級別的差異性
   */
  const STRATEGIC_ADVICE_BY_STARS = {
    5: "全速推進。能量通道完全開啟，適合執行高槓桿計畫，把握優勢時機。",
    4: "穩健擴張。系統運轉順暢，可適度增加資源投入與執行強度，持續優化流程。",
    3: "維持節奏。當前狀態平穩，建議保持現有策略，在穩定中尋找微調機會。",
    2: "聚焦優化。系統運作正常，建議優先處理核心任務，逐步建立更穩健的運作模式。",
    1: "穩步調整。系統基礎穩固，建議從關鍵環節開始優化，為後續發展打好基礎。"
  };

  // ====== 導出 ======
  
  // 導出到 window.CalcConstants（如果 window 存在）
  if (typeof window !== "undefined") {
    window.CalcConstants = {
      // 宮位相關
      PALACE_DEFAULT,
      PALACE_KEY_MAP,
      PALACE_NAME_TO_ID_MAP,
      PALACE_ONE_LINERS,
      
      // 盤面位置相關
      gridAreas,
      BRANCH_RING,
      
      // 星曜相關
      STAR_NAME_TRAD_MAP,
      STAR_WUXING_MAP,
      STAR_NAME_TO_ID_MAP,
      
      // 時辰相關
      SHICHEN_ORDER,
      SHICHEN_START_HOUR,
      SHICHEN_TO_HOUR,
      
      // 五行相關
      FIVE_ELEMENTS_ORDER,
      SHENG_MAP,
      KE_MAP,
      STRONG_COMMENTS,
      WEAK_COMMENTS,
      CANGGAN_DATA,
      ENERGY_LABEL,
      ELEMENT_CORE_MEANING,
      GENERATION_POST_STYLE,
      OVERCOMING_POST_STYLE,
      ELEMENT_TYPE,
      BOYAN_CONVERSION_ONE,
      BOYAN_RISK_ONE,
      BOYAN_PUSH,
      
      // 小限／四化相關
      STEMS,
      BRANCH_ORDER,
      YIN_STEM_FROM_YEAR,
      SI_HUA_MAP,
      
      // 星等評分相關
      STRATEGIC_ADVICE_BY_STARS,
    };
  } else if (typeof globalThis !== "undefined") {
    // 讓 Node / 測試環境也能引用
    globalThis.CalcConstants = {
      PALACE_DEFAULT,
      PALACE_KEY_MAP,
      PALACE_NAME_TO_ID_MAP,
      PALACE_ONE_LINERS,
      gridAreas,
      BRANCH_RING,
      STAR_NAME_TRAD_MAP,
      STAR_WUXING_MAP,
      STAR_NAME_TO_ID_MAP,
      SHICHEN_ORDER,
      SHICHEN_START_HOUR,
      SHICHEN_TO_HOUR,
      FIVE_ELEMENTS_ORDER,
      SHENG_MAP,
      KE_MAP,
      STRONG_COMMENTS,
      WEAK_COMMENTS,
      CANGGAN_DATA,
      ENERGY_LABEL,
      ELEMENT_CORE_MEANING,
      GENERATION_POST_STYLE,
      OVERCOMING_POST_STYLE,
      ELEMENT_TYPE,
      BOYAN_CONVERSION_ONE,
      BOYAN_RISK_ONE,
      BOYAN_PUSH,
      STEMS,
      BRANCH_ORDER,
      YIN_STEM_FROM_YEAR,
      SI_HUA_MAP,
      STRATEGIC_ADVICE_BY_STARS,
    };
  }
})();
