# æ–‡æ¡ˆç®¡ç†ç³»çµ±èªªæ˜

## ğŸ“‹ æ¦‚è¿°

æ–‡æ¡ˆç®¡ç†ç³»çµ±å…è¨±ç‡Ÿé‹/æ–‡æ¡ˆäººå“¡ç›´æ¥åœ¨å¾Œå°èª¿æ•´æ‰€æœ‰ UI æ–‡æ¡ˆï¼Œç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼ã€‚

## ğŸ—„ï¸ è³‡æ–™åº«çµæ§‹

### è¡¨ï¼š`ui_copy_texts`

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `id` | INTEGER (PK, AUTOINCREMENT) | ä¸»éµ |
| `copy_key` | TEXT (NOT NULL) | æ–‡æ¡ˆè­˜åˆ¥ç¢¼ï¼Œä¾‹å¦‚ "destiny.core.title" |
| `locale` | TEXT (NOT NULL, DEFAULT 'zh-TW') | èªç³»ä»£ç¢¼ |
| `content` | TEXT (NOT NULL) | å¯¦éš›é¡¯ç¤ºåœ¨å‰å°çš„æ–‡å­— |
| `category` | TEXT (NOT NULL) | åˆ†é¡ï¼Œä¾‹å¦‚ "ç´«å¾®æ–¹ç›¤"ã€"å¹´åº¦æˆ°ç•¥" |
| `description` | TEXT | å‚™è¨»èªªæ˜ï¼ˆä¸æœƒé¡¯ç¤ºåœ¨å‰å°ï¼‰ |
| `updated_by` | TEXT (NOT NULL) | æœ€å¾Œä¿®æ”¹äºº |
| `updated_at` | TEXT (NOT NULL) | æœ€å¾Œä¿®æ”¹æ™‚é–“ï¼ˆISO 8601ï¼‰ |
| `created_at` | TEXT (NOT NULL) | å»ºç«‹æ™‚é–“ï¼ˆISO 8601ï¼‰ |

**å”¯ä¸€ç´„æŸ**ï¼š`(copy_key, locale)` çµ„åˆå¿…é ˆå”¯ä¸€

**ç´¢å¼•**ï¼š
- `idx_ui_copy_texts_copy_key` - åŠ é€Ÿ copy_key æŸ¥è©¢
- `idx_ui_copy_texts_locale` - åŠ é€Ÿ locale ç¯©é¸
- `idx_ui_copy_texts_category` - åŠ é€Ÿ category ç¯©é¸
- `idx_ui_copy_texts_updated_at` - åŠ é€Ÿæ™‚é–“æ’åº

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. åŸ·è¡Œè³‡æ–™åº«é·ç§»

```bash
# æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
npx wrangler d1 migrations apply consult-db --local

# æ­£å¼ç’°å¢ƒ
npx wrangler d1 migrations apply consult-db
```

### 2. ç¢ºèª API è·¯ç”±

API è·¯ç”±ä½æ–¼ï¼š`functions/api/admin/copy.js`

æ”¯æ´çš„ HTTP æ–¹æ³•ï¼š
- `GET /api/admin/copy` - åˆ—è¡¨æŸ¥è©¢ï¼ˆæ”¯æ´æœå°‹ã€ç¯©é¸ã€åˆ†é ï¼‰
- `POST /api/admin/copy` - æ–°å¢æ–‡æ¡ˆ
- `PUT /api/admin/copy` - æ›´æ–°æ–‡æ¡ˆ
- `DELETE /api/admin/copy` - åˆªé™¤æ–‡æ¡ˆ

### 3. è¨ªå•å¾Œå°é é¢

é é¢ä½ç½®ï¼š`/admin-copy.html`

æˆ–é€éå°èˆªé€£çµï¼ˆè¦‹ä¸‹æ–¹ã€Œå°èˆªæ•´åˆã€ï¼‰

## ğŸ” èªè­‰

ä½¿ç”¨èˆ‡ç¾æœ‰å¾Œå°ç›¸åŒçš„ Basic Authï¼š
- ç’°å¢ƒè®Šæ•¸ï¼š`ADMIN_USER`ã€`ADMIN_PASSWORD`
- èªè­‰æ–¹å¼ï¼šHTTP Basic Authentication
- Session å„²å­˜ï¼š`sessionStorage`ï¼ˆé—œé–‰ç€è¦½å™¨å¾Œéœ€é‡æ–°ç™»å…¥ï¼‰

## ğŸ“ API ä½¿ç”¨èªªæ˜

### GET /api/admin/copy

æŸ¥è©¢åƒæ•¸ï¼š
- `keyword` (optional) - é—œéµå­—æœå°‹ï¼ˆå° copy_keyã€content æ¨¡ç³Šæœå°‹ï¼‰
- `category` (optional) - åˆ†é¡ç¯©é¸
- `locale` (optional) - èªç³»ç¯©é¸
- `page` (optional, default: 1) - é ç¢¼
- `pageSize` (optional, default: 20) - æ¯é ç­†æ•¸

å›æ‡‰ç¯„ä¾‹ï¼š
```json
{
  "ok": true,
  "list": [
    {
      "id": 1,
      "copy_key": "destiny.core.title",
      "locale": "zh-TW",
      "content": "äººç”Ÿèªªæ˜æ›¸",
      "category": "ç´«å¾®æ–¹ç›¤",
      "description": "ä¸»æ¨™é¡Œ",
      "updated_by": "admin",
      "updated_at": "2026-02-06T12:00:00.000Z",
      "created_at": "2026-02-06T10:00:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

### POST /api/admin/copy

è«‹æ±‚é«”ï¼š
```json
{
  "copy_key": "destiny.core.title",
  "locale": "zh-TW",
  "content": "äººç”Ÿèªªæ˜æ›¸",
  "category": "ç´«å¾®æ–¹ç›¤",
  "description": "ä¸»æ¨™é¡Œï¼ˆé¸å¡«ï¼‰"
}
```

å›æ‡‰ç¯„ä¾‹ï¼š
```json
{
  "ok": true,
  "data": { /* æ–°å»ºç«‹çš„è¨˜éŒ„ */ }
}
```

### PUT /api/admin/copy

è«‹æ±‚é«”ï¼š
```json
{
  "id": 1,
  "content": "æ›´æ–°å¾Œçš„å…§å®¹",
  "category": "æ–°åˆ†é¡",
  "description": "æ›´æ–°å¾Œçš„å‚™è¨»"
}
```

æ³¨æ„ï¼š`copy_key` å’Œ `locale` ä¸å¯ä¿®æ”¹ï¼ˆæœƒè‡ªå‹•å¾ç¾æœ‰è¨˜éŒ„å–å¾—ï¼‰

### DELETE /api/admin/copy

æŸ¥è©¢åƒæ•¸ï¼š
- `id` (required) - è¦åˆªé™¤çš„è¨˜éŒ„ ID

å›æ‡‰ç¯„ä¾‹ï¼š
```json
{
  "ok": true
}
```

## ğŸ¨ å¾Œå°é é¢åŠŸèƒ½

### ä¸»è¦åŠŸèƒ½

1. **åˆ—è¡¨é¡¯ç¤º**
   - é¡¯ç¤ºæ‰€æœ‰æ–‡æ¡ˆè¨˜éŒ„
   - æ¬„ä½ï¼šcopy_keyã€localeã€categoryã€contentï¼ˆæˆªæ–·å‰50å­—ï¼‰ã€updated_byã€updated_at
   - é»æ“Šåˆ—å¯é–‹å•Ÿç·¨è¼¯ä»‹é¢

2. **æœå°‹èˆ‡ç¯©é¸**
   - é—œéµå­—æœå°‹ï¼ˆå° copy_keyã€content æ¨¡ç³Šæœå°‹ï¼‰
   - åˆ†é¡ç¯©é¸ï¼ˆå‹•æ…‹è¼‰å…¥ç¾æœ‰åˆ†é¡ï¼‰
   - èªç³»ç¯©é¸ï¼ˆzh-TWã€zh-CNã€enï¼‰

3. **åˆ†é **
   - æ¯é  20 ç­†
   - é¡¯ç¤ºç¸½ç­†æ•¸ã€ç•¶å‰é ç¢¼ã€ç¸½é æ•¸
   - ä¸Šä¸€é /ä¸‹ä¸€é æŒ‰éˆ•

4. **æ–°å¢/ç·¨è¼¯**
   - Modal å´æ¬„ç·¨è¼¯ä»‹é¢
   - æ–°å¢æ™‚å¯è¨­å®š copy_key å’Œ locale
   - ç·¨è¼¯æ™‚ copy_key å’Œ locale ä¸å¯ä¿®æ”¹
   - é©—è­‰å¿…å¡«æ¬„ä½

5. **åˆªé™¤**
   - ç·¨è¼¯æ¨¡å¼ä¸‹å¯åˆªé™¤è¨˜éŒ„
   - åˆªé™¤å‰ç¢ºèªå°è©±æ¡†

## ğŸ”— å°èˆªæ•´åˆ

### æ–¹æ³• 1ï¼šåœ¨ç¾æœ‰ admin.html æ·»åŠ é€£çµ

ç·¨è¼¯ `admin.html`ï¼Œåœ¨æ¨™é¡Œé™„è¿‘æ·»åŠ ï¼š

```html
<div class="flex items-center gap-2 mb-4">
  <a href="/admin-copy.html" class="px-4 py-2 rounded-lg bg-amber-600/80 text-slate-900 text-sm font-medium hover:bg-amber-500">æ–‡æ¡ˆç®¡ç†</a>
  <button type="button" id="logoutBtn" class="px-4 py-2 rounded-lg bg-slate-700 text-slate-200 text-sm hover:bg-slate-600">ç™»å‡º</button>
</div>
```

### æ–¹æ³• 2ï¼šåœ¨ admin-copy.html æ·»åŠ è¿”å›é€£çµ

å·²åœ¨ `admin-copy.html` ä¸­æ·»åŠ ã€Œè¿”å›å ±åç´€éŒ„ã€é€£çµï¼ŒæŒ‡å‘ `/admin.html`

### æ–¹æ³• 3ï¼šå»ºç«‹çµ±ä¸€çš„å¾Œå°å°èˆªé 

å»ºç«‹ `admin-index.html`ï¼ŒåŒ…å«æ‰€æœ‰å¾Œå°åŠŸèƒ½çš„å°èˆªï¼š

```html
<div class="glass p-6">
  <h1 class="text-2xl font-black text-amber-400 mb-6">å¾Œå°ç®¡ç†</h1>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <a href="/admin.html" class="glass p-6 rounded-xl hover:bg-white/5 transition">
      <h2 class="text-lg font-bold mb-2">å ±åç´€éŒ„</h2>
      <p class="text-sm text-slate-400">æŸ¥çœ‹è«®è©¢å ±åè¨˜éŒ„</p>
    </a>
    <a href="/admin-copy.html" class="glass p-6 rounded-xl hover:bg-white/5 transition">
      <h2 class="text-lg font-bold mb-2">æ–‡æ¡ˆç®¡ç†</h2>
      <p class="text-sm text-slate-400">ç®¡ç† UI æ–‡æ¡ˆå…§å®¹</p>
    </a>
  </div>
</div>
```

## ğŸ’» å‰ç«¯æ•´åˆï¼ˆä½¿ç”¨æ–‡æ¡ˆï¼‰

### ç¯„ä¾‹ï¼šå¾ API è¼‰å…¥æ–‡æ¡ˆ

```javascript
// å»ºç«‹æ–‡æ¡ˆå¿«å–
const copyTextsCache = {};

async function loadCopyTexts(locale = 'zh-TW') {
  if (copyTextsCache[locale]) {
    return copyTextsCache[locale];
  }

  try {
    const response = await fetch(`/api/copy-texts?locale=${locale}`);
    const data = await response.json();
    
    if (data.ok) {
      const map = {};
      data.list.forEach(item => {
        map[item.copy_key] = item.content;
      });
      copyTextsCache[locale] = map;
      return map;
    }
  } catch (err) {
    console.error('Failed to load copy texts:', err);
  }

  return {};
}

// ä½¿ç”¨æ–‡æ¡ˆ
async function renderPage() {
  const copyTexts = await loadCopyTexts('zh-TW');
  document.getElementById('title').textContent = copyTexts['destiny.core.title'] || 'é è¨­æ¨™é¡Œ';
}
```

### å»ºç«‹å‰ç«¯ API è·¯ç”±ï¼ˆå…¬é–‹è®€å–ï¼‰

å¦‚æœéœ€è¦å‰ç«¯ç›´æ¥è®€å–æ–‡æ¡ˆï¼ˆä¸éœ€è¦èªè­‰ï¼‰ï¼Œå¯ä»¥å»ºç«‹ï¼š

`functions/api/copy-texts.js`:

```javascript
export async function onRequestGet(context) {
  const { request, env } = context;
  const url = new URL(request.url);
  const locale = url.searchParams.get('locale') || 'zh-TW';

  try {
    const db = env.CONSULT_DB;
    const { results } = await db
      .prepare('SELECT copy_key, content FROM ui_copy_texts WHERE locale = ?')
      .bind(locale)
      .all();

    return new Response(
      JSON.stringify({ ok: true, list: results || [] }),
      { 
        status: 200, 
        headers: { 
          'Content-Type': 'application/json; charset=utf-8',
          'Cache-Control': 'public, max-age=300' // å¿«å– 5 åˆ†é˜
        } 
      }
    );
  } catch (err) {
    return new Response(
      JSON.stringify({ error: 'è®€å–å¤±æ•—' }),
      { status: 500, headers: { 'Content-Type': 'application/json; charset=utf-8' } }
    );
  }
}
```

## ğŸ“Š ä½¿ç”¨å»ºè­°

### copy_key å‘½åè¦ç¯„

å»ºè­°ä½¿ç”¨éšå±¤å¼å‘½åï¼š
- `destiny.core.title` - å‘½ç†æ ¸å¿ƒæ¨™é¡Œ
- `destiny.core.subtitle` - å‘½ç†æ ¸å¿ƒå‰¯æ¨™é¡Œ
- `strategic.panel.sectionA.title` - æˆ°ç•¥é¢æ¿ A å€æ¨™é¡Œ
- `strategic.panel.sectionB.monthly.warning` - æˆ°ç•¥é¢æ¿ B å€æœˆåº¦è­¦å‘Š

### category åˆ†é¡å»ºè­°

- `ç´«å¾®æ–¹ç›¤` - ç´«å¾®æ–—æ•¸ç›¸é—œ
- `å¹´åº¦æˆ°ç•¥` - å¹´åº¦æˆ°ç•¥é¢æ¿
- `æµæœˆåˆ†æ` - æµæœˆç›¸é—œ
- `é€šç”¨` - é€šç”¨æ–‡æ¡ˆ
- `éŒ¯èª¤è¨Šæ¯` - éŒ¯èª¤æç¤º
- `æŒ‰éˆ•æ–‡å­—` - æŒ‰éˆ•æ¨™ç±¤

### å¤šèªç³»æ”¯æ´

ç³»çµ±æ”¯æ´å¤šèªç³»ï¼Œå»ºè­°ï¼š
1. ç‚ºæ¯å€‹èªç³»å»ºç«‹å°æ‡‰çš„è¨˜éŒ„
2. ä½¿ç”¨ç›¸åŒçš„ `copy_key`ï¼Œä¸åŒçš„ `locale`
3. å‰ç«¯æ ¹æ“šä½¿ç”¨è€…èªç³»é¸æ“‡å°æ‡‰çš„æ–‡æ¡ˆ

## ğŸ” æ¸¬è©¦

### æœ¬åœ°æ¸¬è©¦

```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
./start-dev.sh

# è¨ªå•å¾Œå°
open http://localhost:8788/admin-copy.html
```

### æ¸¬è©¦æ­¥é©Ÿ

1. ç™»å…¥å¾Œå°
2. æ–°å¢ä¸€ç­†æ¸¬è©¦æ–‡æ¡ˆ
3. æœå°‹æ¸¬è©¦æ–‡æ¡ˆ
4. ç·¨è¼¯æ¸¬è©¦æ–‡æ¡ˆ
5. åˆªé™¤æ¸¬è©¦æ–‡æ¡ˆ

## ğŸ“ æ³¨æ„äº‹é …

1. **å”¯ä¸€æ€§ç´„æŸ**ï¼š`copy_key` + `locale` çµ„åˆå¿…é ˆå”¯ä¸€ï¼Œæ–°å¢æ™‚æœƒæª¢æŸ¥
2. **èªè­‰**ï¼šæ‰€æœ‰ API éƒ½éœ€è¦ Basic Authï¼Œå‰ç«¯é é¢ä½¿ç”¨ sessionStorage å„²å­˜èªè­‰è³‡è¨Š
3. **æ™‚é–“æ ¼å¼**ï¼šè³‡æ–™åº«ä½¿ç”¨ ISO 8601 å­—ä¸²æ ¼å¼å„²å­˜æ™‚é–“
4. **åˆ†é **ï¼šé è¨­æ¯é  20 ç­†ï¼Œå¯é€é `pageSize` åƒæ•¸èª¿æ•´
5. **å¿«å–**ï¼šå»ºè­°å‰ç«¯å¯¦ä½œå¿«å–æ©Ÿåˆ¶ï¼Œæ¸›å°‘ API è«‹æ±‚

## ğŸ› æ•…éšœæ’é™¤

### è³‡æ–™åº«é·ç§»å¤±æ•—

```bash
# æª¢æŸ¥é·ç§»ç‹€æ…‹
npx wrangler d1 migrations list consult-db

# æ‰‹å‹•åŸ·è¡Œ SQL
npx wrangler d1 execute consult-db --command "SELECT * FROM ui_copy_texts LIMIT 1"
```

### API 401 éŒ¯èª¤

æª¢æŸ¥ç’°å¢ƒè®Šæ•¸ï¼š
```bash
# æœ¬åœ°é–‹ç™¼
cat .dev.vars | grep ADMIN

# æ­£å¼ç’°å¢ƒ
# åœ¨ Cloudflare Pages â†’ Settings â†’ Environment variables æª¢æŸ¥
```

### é é¢ç„¡æ³•è¼‰å…¥

1. ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºï¼š`/admin-copy.html`
2. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤
3. ç¢ºèª API è·¯ç”±å·²æ­£ç¢ºéƒ¨ç½²
