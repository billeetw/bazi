# 清除緩存並測試指南

## 問題診斷

您看到的錯誤顯示版本號還是 `?v=1`，但代碼已經更新到 `?v=3`。這表明瀏覽器正在使用緩存版本。

## 解決步驟

### 1. 強制清除瀏覽器緩存

**Chrome/Edge (Windows/Linux):**
- 按 `Ctrl + Shift + Delete`
- 選擇「緩存的圖片和文件」
- 時間範圍選擇「全部時間」
- 點擊「清除數據」

**Chrome/Edge (Mac):**
- 按 `Cmd + Shift + Delete`
- 選擇「緩存的圖片和文件」
- 時間範圍選擇「全部時間」
- 點擊「清除數據」

**Firefox:**
- 按 `Ctrl + Shift + Delete` (Windows) 或 `Cmd + Shift + Delete` (Mac)
- 選擇「緩存」
- 時間範圍選擇「全部」
- 點擊「立即清除」

**Safari (Mac):**
- 按 `Cmd + Option + E` 清除緩存
- 或：Safari > 偏好設置 > 高級 > 勾選「在選單列中顯示開發選單」
- 然後：開發 > 清空快取

### 2. 硬刷新頁面

**Windows/Linux:**
- `Ctrl + F5` 或 `Ctrl + Shift + R`

**Mac:**
- `Cmd + Shift + R`

### 3. 使用無痕模式測試

打開瀏覽器的無痕/隱私模式，訪問 `http://localhost:8000/index.html`，這樣可以確保不使用緩存。

### 4. 檢查網絡請求

1. 打開開發者工具 (`F12`)
2. 切換到「Network」標籤
3. 勾選「Disable cache」
4. 刷新頁面 (`F5`)
5. 檢查所有 JavaScript 文件的版本號：
   - `baziCore.js?v=3` ✅
   - `fourTransformations.js?v=3` ✅
   - `overlapAnalysis.js?v=3` ✅
   - `calc.js?v=3` ✅
   - `ui.js?v=3` ✅

### 5. 如果問題仍然存在

檢查瀏覽器控制台的錯誤訊息，確認：
1. 所有文件都成功載入（狀態碼 200）
2. 版本號是否正確（應該是 `?v=3`）
3. 載入順序是否正確：
   - `constants.js` → `helpers.js` → `baziCore.js` → `fourTransformations.js` → `overlapAnalysis.js` → `calc.js` → `ui.js`

## 已修復的問題

1. ✅ `baziCore.js` - 改進了解構賦值，避免在依賴未載入時報錯
2. ✅ `fourTransformations.js` - 修復了依賴檢查邏輯
3. ✅ `overlapAnalysis.js` - 修復了依賴檢查邏輯
4. ✅ `calc.js` - 移除了 `mingBranch` 的冗余賦值
5. ✅ `ui.js` - 添加了 `window.Calc` 未定義時的處理
6. ✅ 更新了所有版本號到 `?v=3` 以強制重新載入

## 測試命令

```bash
# 啟動本地服務器
python3 -m http.server 8000

# 然後在瀏覽器訪問
http://localhost:8000/index.html
```
