# 用户反馈系统流程说明

## 📋 完整反馈流程

### 1. 用户操作步骤

1. **完成计算**
   - 填写出生信息
   - 点击"启动人生战略引擎"
   - 等待计算完成

2. **触发反馈**
   - 计算完成后，右下角会出现蓝色圆形反馈按钮
   - 点击反馈按钮

3. **填写反馈**
   - 点击星星选择满意度（1-5星）
   - （可选）在文本框中输入反馈意见
   - 点击"提交反馈"按钮

---

## ✅ 系统反应（正常流程）

### 步骤1：点击提交后

**立即反应**：
- ✅ 提交按钮变为"提交中..."（灰色，禁用状态）
- ✅ 按钮无法再次点击（防止重复提交）

**后台操作**：
- 📡 发送 POST 请求到 `/api/feedback`
- 💾 数据保存到数据库 `feedback` 表

### 步骤2：提交成功（约1-2秒）

**界面反应**：
- ✅ 弹窗内容替换为成功消息：
  ```
  ✅
  感谢您的反馈！
  您的意见将帮助我们改进系统
  [关闭按钮]
  ```
- ✅ 3秒后自动关闭弹窗

**数据保存**：
- ✅ 反馈数据已保存到数据库
- ✅ 包含：评分、反馈文本、chartId、时间戳等

### 步骤3：数据用途

**短期用途**：
- 📊 管理员可以查看反馈统计
- 📈 分析用户满意度趋势
- 🔍 识别需要改进的功能

**长期用途**：
- 🤖 用于训练机器学习模型
- ⚙️ 优化算法权重参数
- 📉 提升预测准确度

---

## 🔍 如何验证反馈是否成功

### 方法1：查看浏览器控制台

打开开发者工具（F12），应该看到：

```
[feedback-widget] 点击提交按钮, selectedRating: 5
[feedback-widget] 提交反馈: {chartId: "...", rating: 5, feedbackText: "..."}
[feedback-widget] 反馈提交成功
```

**如果看到错误**：
```
[feedback-widget] Submit error: ...
```
说明提交失败，需要检查网络或API。

### 方法2：查看网络请求

在开发者工具的 Network 标签：
1. 找到 `feedback` 请求
2. 查看状态码：
   - ✅ `200` = 成功
   - ❌ `400/500` = 失败
3. 查看响应内容：
   ```json
   {
     "ok": true,
     "id": "feedback-uuid"
   }
   ```

### 方法3：查询数据库（管理员）

```sql
-- 查看最近的反馈
SELECT * FROM feedback 
ORDER BY created_at DESC 
LIMIT 10;

-- 查看满意度统计
SELECT 
  satisfaction_rating,
  COUNT(*) as count
FROM feedback
WHERE satisfaction_rating IS NOT NULL
GROUP BY satisfaction_rating
ORDER BY satisfaction_rating DESC;
```

---

## 🎯 预期行为总结

### ✅ 正常情况

| 操作 | 预期反应 | 时间 |
|------|---------|------|
| 点击星星 | 星星变黄色，提交按钮启用 | 立即 |
| 输入文本 | 文本正常显示 | 立即 |
| 点击提交 | 按钮变"提交中..." | 立即 |
| 提交成功 | 显示成功消息 | 1-2秒 |
| 自动关闭 | 弹窗关闭 | 3秒后 |

### ❌ 异常情况

| 问题 | 可能原因 | 解决方法 |
|------|---------|---------|
| 星星点击无反应 | 事件未绑定 | 刷新页面 |
| 文本无法输入 | CSS样式问题 | 检查控制台错误 |
| 提交无反应 | API错误 | 查看Network标签 |
| 提交失败 | 网络问题/API错误 | 检查错误信息 |

---

## 📊 反馈数据示例

### 数据库中保存的数据

```json
{
  "id": "uuid",
  "created_at": "2026-02-04T10:30:00Z",
  "chart_id": "chart-123",
  "feedback_type": "satisfaction",
  "satisfaction_rating": 5,
  "satisfaction_category": "overall",
  "feedback_text": "整体体验很好，预测很准确",
  "source": "web"
}
```

---

## 🔄 后续处理流程

### 1. 数据收集阶段（当前）

- ✅ 收集用户反馈
- ✅ 存储到数据库
- ✅ 记录时间戳和上下文

### 2. 数据分析阶段（未来）

- 📊 定期分析反馈数据
- 📈 计算平均满意度
- 🔍 识别常见问题

### 3. 模型优化阶段（未来）

- 🤖 使用反馈数据训练ML模型
- ⚙️ 调整算法参数
- 📉 提升预测准确度

---

## 💡 提示

1. **反馈是匿名的**：不会收集个人信息
2. **反馈是自愿的**：可以选择"稍后再说"
3. **反馈很重要**：帮助我们改进系统
4. **可以多次反馈**：每次计算后都可以反馈

---

## 🐛 故障排查

如果反馈没有正常反应：

1. **检查控制台**：查看是否有错误信息
2. **检查网络**：确认API请求是否成功
3. **刷新页面**：清除可能的缓存问题
4. **检查数据库**：确认迁移是否执行

---

**最后更新**: 2026-02-04
