<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UI æ‹†åˆ†æµ‹è¯•é¡µé¢</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #1e293b;
      color: #e2e8f0;
    }
    .test-section {
      background: #334155;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border: 1px solid #475569;
    }
    .test-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #fbbf24;
    }
    .test-result {
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
    }
    .success {
      background: #065f46;
      color: #6ee7b7;
    }
    .error {
      background: #7f1d1d;
      color: #fca5a5;
    }
    .info {
      background: #1e3a8a;
      color: #93c5fd;
    }
    button {
      background: #f59e0b;
      color: #1e293b;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover {
      background: #fbbf24;
    }
    #testOutput {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª UI æ‹†åˆ†åŠŸèƒ½æµ‹è¯•</h1>
  
  <div class="test-section">
    <div class="test-title">1. æ¨¡å—åŠ è½½æ£€æŸ¥</div>
    <div id="moduleCheck" class="test-result info">æ£€æŸ¥ä¸­...</div>
  </div>

  <div class="test-section">
    <div class="test-title">2. å·¥å…·å‡½æ•°å¯ç”¨æ€§</div>
    <div id="functionCheck" class="test-result info">æ£€æŸ¥ä¸­...</div>
  </div>

  <div class="test-section">
    <div class="test-title">3. åŠŸèƒ½æµ‹è¯•</div>
    <button onclick="testAnimateValue()">æµ‹è¯• animateValue</button>
    <button onclick="testRenderBar()">æµ‹è¯• renderBar</button>
    <button onclick="testRenderRadar()">æµ‹è¯• renderRadarChart</button>
    <div id="functionTest" class="test-result info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•åŠŸèƒ½</div>
  </div>

  <div class="test-section">
    <div class="test-title">4. æµ‹è¯•è¾“å‡º</div>
    <div id="testOutput"></div>
  </div>

  <!-- åŠ è½½å¿…è¦çš„ä¾èµ– -->
  <script src="js/utils.js"></script>
  <script src="js/config.js"></script>
  <script src="js/state.js"></script>
  <script src="js/calc/constants.js"></script>
  <script src="js/calc/helpers.js"></script>
  <script src="js/calc/ziweiPipeline.js"></script>
  <script src="js/calc/ziweiOutput.js"></script>
  <script src="js/calc/baziCore.js"></script>
  <script src="js/calc/tactics.js"></script>
  <script src="js/strategyConfig.js"></script>
  <script src="js/calc.js"></script>
  
  <!-- UI å·¥å…·æ¨¡å— -->
  <script src="js/ui/utils/dom-helpers.js"></script>
  <script src="js/ui/utils/render-helpers.js"></script>

  <script>
    function log(message, type = 'info') {
      const output = document.getElementById('testOutput');
      const div = document.createElement('div');
      div.className = `test-result ${type}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      output.appendChild(div);
      output.scrollTop = output.scrollHeight;
    }

    // 1. æ¨¡å—åŠ è½½æ£€æŸ¥
    function checkModules() {
      const moduleCheck = document.getElementById('moduleCheck');
      const checks = [];
      
      if (window.UiDomHelpers) {
        checks.push('âœ… window.UiDomHelpers å·²åŠ è½½');
        log('window.UiDomHelpers å·²åŠ è½½', 'success');
      } else {
        checks.push('âŒ window.UiDomHelpers æœªæ‰¾åˆ°');
        log('window.UiDomHelpers æœªæ‰¾åˆ°', 'error');
      }
      
      if (window.UiRenderHelpers) {
        checks.push('âœ… window.UiRenderHelpers å·²åŠ è½½');
        log('window.UiRenderHelpers å·²åŠ è½½', 'success');
      } else {
        checks.push('âŒ window.UiRenderHelpers æœªæ‰¾åˆ°');
        log('window.UiRenderHelpers æœªæ‰¾åˆ°', 'error');
      }
      
      if (window.Calc) {
        checks.push('âœ… window.Calc å·²åŠ è½½');
        log('window.Calc å·²åŠ è½½', 'success');
      } else {
        checks.push('âš ï¸ window.Calc æœªæ‰¾åˆ°ï¼ˆæŸäº›åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨ï¼‰');
        log('window.Calc æœªæ‰¾åˆ°', 'error');
      }
      
      moduleCheck.innerHTML = checks.join('<br>');
      moduleCheck.className = checks.some(c => c.includes('âŒ')) ? 'test-result error' : 'test-result success';
    }

    // 2. å·¥å…·å‡½æ•°å¯ç”¨æ€§æ£€æŸ¥
    function checkFunctions() {
      const functionCheck = document.getElementById('functionCheck');
      const checks = [];
      
      if (!window.UiDomHelpers || !window.UiRenderHelpers) {
        functionCheck.innerHTML = 'âŒ æ¨¡å—æœªåŠ è½½ï¼Œæ— æ³•æ£€æŸ¥å‡½æ•°';
        functionCheck.className = 'test-result error';
        return;
      }
      
      const domFunctions = [
        'animateValue', 'getCurrentAge', 'syncAgeSliderDisplay',
        'flashPeek', 'openPalaceSheet', 'closePalaceSheet', 'setMobileSheetContent'
      ];
      
      const renderFunctions = [
        'getSihuaForPalace', 'renderBar', 'toneClass', 'wrapForMobile',
        'renderRadarChart', 'renderFiveElementComment', 'getColorFromCode',
        'getBorderColorClass', 'getBgColorClass', 'getTextColorClass',
        'getStarRating', 'renderStars', 'getMutagenBadgeHtml', 'starWithBadgeHtml'
      ];
      
      domFunctions.forEach(fn => {
        if (typeof window.UiDomHelpers[fn] === 'function') {
          checks.push(`âœ… UiDomHelpers.${fn}`);
        } else {
          checks.push(`âŒ UiDomHelpers.${fn} æœªæ‰¾åˆ°`);
        }
      });
      
      renderFunctions.forEach(fn => {
        if (typeof window.UiRenderHelpers[fn] === 'function') {
          checks.push(`âœ… UiRenderHelpers.${fn}`);
        } else {
          checks.push(`âŒ UiRenderHelpers.${fn} æœªæ‰¾åˆ°`);
        }
      });
      
      functionCheck.innerHTML = checks.join('<br>');
      const hasErrors = checks.some(c => c.includes('âŒ'));
      functionCheck.className = hasErrors ? 'test-result error' : 'test-result success';
      
      if (!hasErrors) {
        log('æ‰€æœ‰å·¥å…·å‡½æ•°æ£€æŸ¥é€šè¿‡', 'success');
      }
    }

    // 3. åŠŸèƒ½æµ‹è¯•
    function testAnimateValue() {
      const testDiv = document.getElementById('functionTest');
      if (!window.UiDomHelpers || !window.UiDomHelpers.animateValue) {
        testDiv.innerHTML = 'âŒ animateValue ä¸å¯ç”¨';
        testDiv.className = 'test-result error';
        return;
      }
      
      const testEl = document.createElement('div');
      testEl.textContent = '0';
      testEl.style.fontSize = '24px';
      testEl.style.fontWeight = 'bold';
      testDiv.innerHTML = 'æµ‹è¯• animateValue: ';
      testDiv.appendChild(testEl);
      testDiv.className = 'test-result info';
      
      window.UiDomHelpers.animateValue(testEl, 100, { duration: 1000, decimals: 0 });
      log('animateValue æµ‹è¯•æ‰§è¡Œä¸­ï¼ˆåº”è¯¥ä» 0 åŠ¨ç”»åˆ° 100ï¼‰', 'info');
    }

    function testRenderBar() {
      const testDiv = document.getElementById('functionTest');
      if (!window.UiRenderHelpers || !window.UiRenderHelpers.renderBar) {
        testDiv.innerHTML = 'âŒ renderBar ä¸å¯ç”¨';
        testDiv.className = 'test-result error';
        return;
      }
      
      // åˆ›å»ºæµ‹è¯•å®¹å™¨
      const container = document.createElement('div');
      container.id = 'testBarContainer';
      container.style.marginTop = '10px';
      testDiv.innerHTML = 'æµ‹è¯• renderBar: ';
      testDiv.appendChild(container);
      testDiv.className = 'test-result info';
      
      const testData = { æœ¨: 2.5, ç«: 3.0, åœŸ: 2.0, é‡‘: 3.5, æ°´: 2.8 };
      window.UiRenderHelpers.renderBar('testBarContainer', testData, 4, {
        strongest: 'é‡‘',
        weakest: 'åœŸ'
      });
      log('renderBar æµ‹è¯•æ‰§è¡Œï¼ˆåº”è¯¥æ˜¾ç¤ºäº”è¡Œèƒ½é‡æ¡ï¼‰', 'info');
    }

    function testRenderRadar() {
      const testDiv = document.getElementById('functionTest');
      if (!window.UiRenderHelpers || !window.UiRenderHelpers.renderRadarChart) {
        testDiv.innerHTML = 'âŒ renderRadarChart ä¸å¯ç”¨';
        testDiv.className = 'test-result error';
        return;
      }
      
      if (!window.Calc) {
        testDiv.innerHTML = 'âš ï¸ window.Calc æœªåŠ è½½ï¼ŒrenderRadarChart éœ€è¦å®ƒ';
        testDiv.className = 'test-result error';
        return;
      }
      
      // åˆ›å»ºæµ‹è¯•å®¹å™¨
      const container = document.createElement('div');
      container.id = 'testRadarContainer';
      container.style.width = '220px';
      container.style.height = '220px';
      container.style.marginTop = '10px';
      testDiv.innerHTML = 'æµ‹è¯• renderRadarChart: ';
      testDiv.appendChild(container);
      testDiv.className = 'test-result info';
      
      const testData = { æœ¨: 2.5, ç«: 3.0, åœŸ: 2.0, é‡‘: 3.5, æ°´: 2.8 };
      window.UiRenderHelpers.renderRadarChart('testRadarContainer', testData);
      log('renderRadarChart æµ‹è¯•æ‰§è¡Œï¼ˆåº”è¯¥æ˜¾ç¤ºäº”è¡Œé›·è¾¾å›¾ï¼‰', 'info');
    }

    // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæ£€æŸ¥
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        checkModules();
        checkFunctions();
      }, 100);
    });
  </script>
</body>
</html>
